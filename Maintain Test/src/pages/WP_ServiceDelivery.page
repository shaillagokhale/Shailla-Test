<!--*******************************************************************************
* VisualForce {Page}: {WP_ServiceDelivery}
----------------------------------------------------------------------------------
* Modified version of WP page used for tracking delivery of services
* Created: 18 Dec 2013
----------------------------------------------------------------------------------
********************************************************************************-->

<apex:page id="page" standardController="LFA_Work_Plan__c" sidebar="false" extensions="ctrlWPNegotiation" cache="false">
<apex:includeScript value="{!URLFOR($Resource.ScrollJS,'Scrolljs/jquery.min.js')}" />
<apex:includeScript value="{!URLFOR($Resource.ScrollJS,'Scrolljs/jquery.nicescroll.min.js')}" />
<!--<apex:includeScript value="{!$Resource.JS182}"/>
<apex:includeScript value="{!$Resource.BrowserDetect}"/>-->

<!--<script > $j = jQuery.noConflict();</script>-->
<apex:includeScript value="/soap/ajax/15.0/connection.js" />
<apex:includeScript value="/soap/ajax/15.0/apex.js" />
    <script>
       
        /*$j(document).ready(function(){
            
            if (bowser.msie && bowser.version == 9) {
               
                $j('.box_TGF').css({'margin-right': '0px'});
                
            }    
        });*/
        function RemoveStatusValues()
        {
           /* var x = document.getElementById("page:frm:pBlock:pbsec:SecItem:statusEditable");
            for(i=0;i<x.length;i++)
            { 
                if(x[i].value=='LFA Change Request'){
                    x.remove(i);
                }
                
                if(x[i].value=='Scheduled'){
                    x.remove(i);
                }
                
                if(x[i].value=='Completed'){
                    x.remove(i);
                }
                
                
                if(x[i].value=='Not Started'){
                    x.remove(i);
                }
                 
                  
                if(x[i].value=='Delivered'){
                    x.remove(i);
                }
                  
                if(x[i].value=='Closed'){
                    x.remove(i);
                }
                  
                if(x[i].value=='Cancelled'){
                    x.remove(i);
                }
                   
                if(x[i].value=='Pre-Delivery'){
                    x.remove(i);
                }
                  
                if(x[i].value=='Proposed'){
                    x.remove(i);
                }
                if(x[i].value=='TGF Counter-Proposal'){
                    x.remove(i);
                }
                if(x[i].value=='LFA Counter-Proposal'){
                    x.remove(i);
                }
            }*/
        }
        
        function SubmitProposal(){
             if(!confirm('Are you sure you want to submit this proposal to TGF? This will lock the work plan while your proposal is being reviewed.')){
                 return false;
             }else{
               /* sforce.connection.sessionId = '{!$Api.Session_ID}';
                var WpId = "{!LFA_Work_Plan__c.Id}"; 
                var WpName = "{!LFA_Work_Plan__c.Name}"; 
                var FullName = "{!$User.Full_Name__c}ABC"; 
              //  alert(WpName +"__"+FullName );
                var response = sforce.apex.execute("PostContentAsPDF","postPDFContentToChatter",{Id:WpId,WpName:WpName,UserFullName:FullName}); 
               // alert(1);
                if(response != '' && response != null){ 
                  // alert(response); 
                }else{
                              //  alert(2);
                                } */
                    
                afBackToWorkPlanAndSaveStage();
                return false;
             }   
        }
    </script>
    <style>
        .errorClass {
            background-color: red;
        }
        .normalClass {
            background-color: green;
        }
  </style>
    <style>
        /*#pageB .bPageBlock .pbTitle{
            width:0%;
        }*/
       
        .searchBox{
            height: 300px;
            overflow: scroll !important;
            display: inline-block;
            width:100%;
        }
        .odd:hover, .even:hover{
            background-color: #E3F3FF !important;
        }
        body .bRelatedList .pbBody table.list, body .apexp .pbBody table.list {
            border: 0px solid #000000;
            padding:0px;
        }
        .headerRowUpperCE{
            border:1px solid #E0E3E5 !important;
            font-weight:bold;
            background-color:#7f7f7f !important;
            color:white !important;
        }
        .headerRowUpper{
            border:1px solid #E0E3E5 !important;
            font-weight:bold;
            background-color:#7f7f7f !important;
            color:white !important;
        }
        
        th.headerRowLower{
            border:1px solid #E0E3E5 !important;
            font-weight:bold;
            background-color:#0066BB !important;
            color:white !important;
            white-space: normal !important;
        }
        .headerRowResource{
            border:1px solid #E0E3E5 !important;
            font-weight:bold;
            background-color:orange !important;
        }
        .totalRow{
            border-top:1px;
            font-weight:bold !important;
        }
        .totalRowMinMaxAvg{
            border-top:1px;
            text-align:right;
            padding-right:10px;
        }
        .noBorder ,table.noBorder tr td,table.noBorder td{
            border: 0px !important;
            padding: 0px;
        }
        .headerColor{
            background-color:#4f81bd !important;
            color:white !important;
            font-weight:bold;
        }
        .headerColorSearchGrid{
            background-color:#4f81bd !important;
            border:1px solid #E0E3E5 !important;
            background-color:#558ed5 !important;
            color:white !important;
            font-weight:bold;
            white-space: pre-wrap !important;
        }
        .resourcetTable{
            vertical-align:top;
        }
        .blankCell{
            width:5px;
        }
        .picklist{
            width:200px !important;
        }
        .yearPicklist{
            width:70px;
        }
        .AddLink{
            padding-left:18px;
        }
        .Image{
            cursor:pointer;
            padding-left:8px;
            height:13px;
            width:13px;
            vertical-align:middle;
        }
        .ImageResource{
            cursor:pointer;
            padding-bottom: 5px;
            padding-left: 4px;
            height:13px;
            width:13px;
        }
        a.white{
            color:white;
        }
        .ImageSearch{
            cursor:pointer;
            float:left;
            height:13px;
            width:13px;
            vertical-align:middle;
        }
        .CollapseExpandAllText{
            font-size: 12px;
            font-weight: normal;
            vertical-align:top;
        }
        .CollapseExpandAllImage{
            cursor:pointer;
            height:20px;
            width:20px;
        }
        .HeaderFreez{  
            position:relative ;   
            top:expression(this.offsetParent.scrollTop);  
            z-index: 10;  
        }
        .box_rotate {          
            -moz-transform: rotate(90deg);  /* FF3.5+ */
            -o-transform: rotate(90deg);  /* Opera 10.5 */
            -webkit-transform: rotate(90deg);  /* Saf3.1+, Chrome */
            filter:  progid:DXImageTransform.Microsoft.BasicImage(rotation=1.083);  /* IE6,IE7 */
            -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=1.083)"; /* IE8 */
            transform: rotate(90deg);
        } 
        .box_CT {
            margin-left: -63px;
            margin-right: -64px;
            background-color: #7f7f7f;
            color:white !important;
            margin-top: 63px;
            padding: 5px;
            white-space: nowrap;
            width: 140px;
        }
        .box_TGF{
            margin-left: -63px;
            margin-right: -64px;
            background-color: #7f7f7f;
            color:white !important;
            margin-top: 63px;
            padding: 5px;
            white-space: nowrap;
            width: 140px;
            display:table;
        }
        .DescPopup { 
            /*width:230px; 
            height:160px; */
            padding:10px;
            background: white; 
            border: 4px solid #c2e1f5; 
            z-index: 97;   
            position: absolute; 
            left:10%;
            margin-left: -160px;
            margin-top: -73px;
        } 
        .DescPopup:after, .DescPopup:before { 
            top: 100%; border: solid transparent; content: " "; 
            height: 0; width: 0; position: absolute; pointer-events: none;
        } 
        .DescPopup:after { border-color: rgba(136, 183, 213, 0); border-top-color: white; 
            border-width: 30px; left: 50%; margin-left: -30px; } 
        .DescPopup:before { border-color: rgba(194, 225, 245, 0); 
            border-top-color: #c2e1f5; border-width: 36px; left: 50%; margin-left: -36px; 
        }
         .DescServicePopupClone { 
            padding:10px;
            background: #FFF4DB; 
            border: 4px solid #c2e1f5; 
            z-index: 97;   
            position: absolute; 
            left:10%;
            margin-left: 20px;
            margin-top: -73px;
        } 
        .DescServicePopupClone:after, .DescServicePopupClone:before { 
            top: 100%; border: solid transparent; content: " "; 
            height: 0; width: 0; position: absolute; pointer-events: none;
        } 
        .DescServicePopupClone:after { border-color: rgba(136, 183, 213, 0); border-top-color: #FFF4DB; 
            border-width: 30px; left: 50%; margin-left: -30px; } 
        .DescServicePopupClone:before { border-color: rgba(194, 225, 245, 0); 
            border-top-color: #c2e1f5; border-width: 36px; left: 50%; margin-left: -36px; 
        }
        
        .DescServicePopupHasResource { 
            padding:10px;
            background: #FFF4DB; 
            border: 4px solid #c2e1f5; 
            z-index: 97;   
            position: absolute; 
            left:10%;
            margin-left: 60px;
            margin-top: -73px;
        } 
        .DescServicePopupHasResource:after, .DescServicePopupHasResource:before { 
            top: 100%; border: solid transparent; content: " "; 
            height: 0; width: 0; position: absolute; pointer-events: none;
        } 
        .DescServicePopupHasResource:after { border-color: rgba(136, 183, 213, 0); border-top-color: #FFF4DB; 
            border-width: 30px; left: 50%; margin-left: -30px; } 
        .DescServicePopupHasResource:before { border-color: rgba(194, 225, 245, 0); 
            border-top-color: #c2e1f5; border-width: 36px; left: 50%; margin-left: -36px; 
        }
        .DescServicePopupLOE { 
            padding:10px;
            background: #FFF4DB; 
            border: 4px solid #c2e1f5; 
            z-index: 97;   
            position: absolute; 
            left:10%;
            margin-left: 27px;
            margin-top: -73px;
        } 
        .DescServicePopupLOE:after, .DescServicePopupLOE:before { 
            top: 100%; border: solid transparent; content: " "; 
            height: 0; width: 0; position: absolute; pointer-events: none;
        } 
        .DescServicePopupLOE:after { border-color: rgba(136, 183, 213, 0); border-top-color: #FFF4DB; 
            border-width: 30px; left: 50%; margin-left: -30px; } 
        .DescServicePopupLOE:before { border-color: rgba(194, 225, 245, 0); 
            border-top-color: #c2e1f5; border-width: 36px; left: 50%; margin-left: -36px; 
        }
       
    </style>
    
    <script>

</script>
    <apex:sectionHeader title="" subtitle="{!LFA_Work_Plan__c.Name}"/>
    <apex:outputpanel id="chatterHomePanel" ><!--rendered="{!lstshare[0].HasEditAccess}"-->
        <chatter:feedWithFollowers id="chatterFeed" entityId="{!LFA_Work_Plan__c.ID}"/>
    </apex:outputpanel><!-- if(blnHasChild==true,lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Id, -->
    <!--
        <apex:outputtext rendered="{!if(lstshare[0].HasEditAccess = true,false,true)}" value="You do not have edit access to this work plan."/><br/>
        <a href="{!if($Profile.Name=='LFA Portal User','/LFA','')}/{!LFA_Work_Plan__c.Id}" style="display:{!if(lstshare[0].HasEditAccess = true,'none','')}">Back to Work Plan Overview</a>
    -->
    <apex:form id="frm" ><!--rendered="{!lstshare[0].HasEditAccess}"-->
        <apex:inputhidden value="{!intTemp}" id="hdnintTemp"/>
        
        <apex:actionfunction name="afBackToWorkPlanAndSaveStage" action="{!BackToWorkPlanAndSaveStage}"/>
        <apex:actionfunction name="afFillContactsOnChangeRole" action="{!FillContactsOnChangeRole}" reRender="PanelEdit" status="Processing">
            <apex:param value="" name="ResourceIndex" id="ResourceIndex"/>
        </apex:actionfunction>
         <apex:actionfunction name="AddEditFillContactsOnChangeRole" action="{!FillContactsOnChangeRole}" reRender="Panel" status="Processing">
            <apex:param value="" name="ResourceIndex" id="ResourceIndex1"/>
        </apex:actionfunction>
        
        <apex:actionfunction name="actFillRateOnChangeContact" action="{!FillRateOnChangeContact}" reRender="PanelEdit" status="Processing">
            <apex:param value="" name="ResourceIndexForRate" id="ResourceIndexForRate1"/>
        </apex:actionfunction>
        <apex:actionfunction name="afFillRateOnChangeContact" action="{!FillRateOnChangeContact}" reRender="Panel" status="Processing">
            <apex:param value="" name="ResourceIndexForRate" id="ResourceIndexForRate"/>
        </apex:actionfunction>
        <apex:actionfunction name="actEditableResourcePopup" action="{!EditableResourcePopup}" reRender="frm" status="Processing"/>
        <apex:actionfunction name="actCollepseAllServiceType" action="{!CollepseAllServiceType}" reRender="frm" status="Processing"/>
        <apex:actionfunction name="actExapndAllServiceType" action="{!ExapndAllServiceType}" reRender="frm" status="Processing"/>
        
        <apex:actionfunction name="actShowAllServiceTypeWithNoLoE" action="{!ShowAllServiceTypeWithNoLoE}" reRender="frm" status="Processing"/>
        <apex:actionfunction name="actHideAllServiceTypeWithNoLoE" action="{!HideAllServiceTypeWithNoLoE}" reRender="frm" status="Processing"/>
        <apex:actionfunction name="actShowCancelled" action="{!ShowCancelled}" reRender="frm" status="Processing"/>
        <apex:actionfunction name="actHideCancelled" action="{!HideCancelled}" reRender="frm" status="Processing"/>        
        <!--<apex:actionfunction name="actrerenderaction" action="{!rerenderaction}" status="Processing"/>-->
        <apex:actionfunction name="actSaveResources" action="{!SaveResources}" status="Processing" reRender="frm"/>
        <apex:inputHidden value="{!intIndex}" id="hdnIndex"/>
        <apex:inputHidden value="{!intIndexST}" id="hdnIndexST"/>
        <apex:inputHidden value="{!blnShowCTPlanned}" id="hdnblnShowCTPlanned"/>
        <apex:inputHidden value="{!blnShowTGF}" id="hdnblnShowTGF"/>
        <apex:inputHidden value="{!blnShowRisk}" id="hdnblnShowRisk"/>
        <apex:inputHidden value="{!blnShowStatus}" id="hdnblnShowStatus"/>
        <apex:inputHidden value="{!strErrorMsg}" id="hdnstrErrorMsg"/>
        <apex:inputHidden value="{!blnShowPOLFAprop}" id="hdnblnShowPOTGF"/>
        <apex:inputHidden value="{!blnShowLFAprop}" id="hdnblnShowLFAprop"/> 
        <!-- <apex:inputHidden value="{!blnShowLFAprop}" id="hdnblnShowLFAprop"/> -->
        <apex:inputHidden value="{!intOffsetHeight}" id="hdnintOffsetTop"/>
        <apex:inputHidden value="{!intHeight}" id="hdnsetTop"/>
        <apex:actionFunction action="{!DeleteService}" name="callDeleteService" reRender="frm" status="Processing">
            <apex:param name="DeleteIndex" value="" id="DeleteIndex"/>
            <apex:param name="DeleteSTIndex" value="" id="DeleteSTIndex"/>
        </apex:actionFunction>
        <!--<apex:actionFunction action="{!DeleteResource}" name="callDeleteResource"  reRender="Panel" status="Processing" >
            <apex:param name="DeleteResourceIndex" value="" id="DeleteResourceIndex"/>
        </apex:actionFunction>-->
        <apex:actionFunction action="{!EditService}" name="callEditService" reRender="frm" status="Processing" oncomplete="setPopupheight();">
            <apex:param name="EditIndex" value="" id="EditIndex"/>
            <apex:param name="EditSTIndex" value="" id="EditSTIndex"/>
        </apex:actionFunction>
        
        <apex:actionFunction action="{!SaveServiceAndAddResources}" reRender="frm" name="actSaveServiceAndAddResources" status="Processing" oncomplete="setPopupheightSave();">
            <apex:param value="" name="SaveServiceIndex" id="SaveServiceIndex"/>
            <apex:param value="" name="SaveServiceTypeIndex" id="SaveServiceTypeIndex"/>
        </apex:actionFunction>
        <apex:pageBlock id="pageB" title="" >
            
            <apex:pageBlockButtons location="top" >
                <div style="margin-left:-44% !important;">
                    <apex:image styleClass="CollapseExpandAllImage" url="{!$Resource.ExpandAll1}" title="Hide all lines with no LoE" onclick="actHideAllServiceTypeWithNoLoE();" rendered="{!blnShowLinesWithNoLoE}" />
                    <apex:outputText styleClass="CollapseExpandAllText" value="Hide all Resources with No LoE" rendered="{!blnShowLinesWithNoLoE}" ></apex:outputText>
                    <apex:image styleClass="CollapseExpandAllImage" url="{!$Resource.CollapseAll1}" title="Show lines with no LoE" onclick="actShowAllServiceTypeWithNoLoE();" rendered="{!blnHideAllLinesWithNoLoE}" />
                    <apex:outputText styleClass="CollapseExpandAllText" value="Show all Resources with No LoE" rendered="{!blnHideAllLinesWithNoLoE}" ></apex:outputText>
                    &nbsp;&nbsp;&nbsp;&nbsp;
                    <apex:image styleClass="CollapseExpandAllImage" url="{!$Resource.ExpandAll1}" title="Hide Cancelled" onclick="actHideCancelled();" rendered="{!blnShowCancelled}"/>
                    <apex:outputText styleClass="CollapseExpandAllText" value="Hide all Services with No LoE" rendered="{!blnShowCancelled}"></apex:outputText>
                    <apex:image styleClass="CollapseExpandAllImage" url="{!$Resource.CollapseAll1}" title="Show Cancelled" onclick="actShowCancelled();" rendered="{!blnHideCancelled}"/>
                    <apex:outputText styleClass="CollapseExpandAllText" value="Show all Services with No LoE" rendered="{!blnHideCancelled}"></apex:outputText>
                    <apex:commandButton id="ReturnId" value="Return to Work Plan Overview" action="{!BackToWorkPlan}" style="margin-left: 22%;"/> 

                    <a href="{!if($Profile.Name=='LFA Portal User','/LFA','')}/apex/WP_service_pdf?id={!LFA_Work_Plan__c.Id}" target="_blank" style="padding-right:10px">PDF</a>
                    <a href="{!if($Profile.Name=='LFA Portal User','/LFA','')}/00Og0000000ScBJ?pv0={!LFA_Work_Plan__c.Name}" target="_blank" style="padding-right:15px">Summary Report</a>
                    <a href="{!if($Profile.Name=='LFA Portal User','/LFA','')}/00Og0000000ScBT?pv0={!LFA_Work_Plan__c.Name}" target="_blank" style="padding-right:15px">LOE by Contact</a>
                </div>
            </apex:pageBlockButtons>
            
            <table>           
                <tr>
                    <td width="140px">
                        <apex:outputtext value="Filter Services: " style="font-weight:bold"/>
                    </td>
                    <td>
                        <!--<apex:selectList styleClass="picklist" size="1" value="{!SelectedServiceTypeMain}">
                            <apex:selectOptions value="{!ServiceTypeOptions}"></apex:selectOptions>
                        </apex:selectList>-->                        
                        <apex:inputField id="ServiceType" style="picklist" value="{!objServiceForType.Service_Type__c}"/>
                    </td>
                    <td class="blankCell"></td>
                    <td>
                        <apex:inputField id="ServiceSubType" value="{!objServiceForType.Service_Sub_Type__c}"/>
                        <!--<apex:selectList styleClass="picklist" size="1" value="{!SelectedServiceSubTypeMain}">
                            <apex:selectOptions value="{!ServiceSubTypeFilterOptions}"></apex:selectOptions>
                        </apex:selectList>-->
                    </td>
                    <td class="blankCell"></td>
                    <td>
                        <apex:selectList styleClass="picklist" size="1" value="{!SelectedGrantMain}">
                            <apex:selectOptions value="{!GrantOptions}"></apex:selectOptions>
                        </apex:selectList>
                    </td>
                    <td class="blankCell"></td>
                    <td>
                        <apex:selectList id="StatusList" styleClass="picklist" size="1" value="{!SelectedStatus}">
                            <apex:selectOptions value="{!StatusOptions}"></apex:selectOptions>
                        </apex:selectList>
                    </td>
                    <td class="blankCell"></td>
                    <td class="blankCell"></td>
                    <td>
                        <apex:commandButton id="btnAnalyseMain" value="Filter" action="{!AnalyseMainGrid}" reRender="frm" status="Processing" />
                    </td>
                    
                    <td>
                        <apex:commandButton id="btnClearFilter" value="Clear Filter" action="{!ClearFilterMainGrid}" reRender="frm" status="Processing" />
                    </td>
                    <td width="200px">
                    </td>
                    <td style="text-align:right;width:140px;">
                        <b>Budgeted ODC :</b> 
                    </td>  
                    <td style="text-align:left;width:150px;padding-left: 3px;">
                        <apex:outputtext value="" rendered="{!if($Profile.Name=='LFA Portal User',false,true)}"/>
                        <apex:outputField value="{!lstWorkPlanToUpdate[0].budgeted_ODC__C}"/>
                    </td>                                     
                 </tr>
                 <tr>
                 
                 </tr>
            <!--<tr>
                    <td colspan="9">
                    </td>
                    <td style="text-align:right;width:500px;font-weight:bold;">
                            <apex:outputText value="Budgeted Labor : "></apex:outputText>
                         </td>
                         <td style="text-align:left;padding-left: 3px;">
                             <apex:outputField value="{!lstWorkPlanToUpdate[0].Budgeted_Labor__c}"/>
                         </td>                    
                </tr>
                <tr>
                    <td colspan="9">
                    </td>
                        <td style="text-align:right;width:500px;font-weight:bold;">
                            <apex:outputText value="Total Budget : "></apex:outputText>
                        </td>
                        <td style="text-align:left;padding-left: 3px;">
                            <apex:outputField value="{!lstWorkPlanToUpdate[0].Total_Budget__c}"/>
                        </td>
                </tr>-->
            </table>
            <br/>
            
            <table width="100%" cellspacing="0" cellpadding="0" border="0"><tr><td valign="top">
            <table width="100%" id="ServiceTable" cellspacing="0" cellpadding="0" border="0" class="list">
                <thead class="rich-table-thead">
                    <tr class="headerRow">
                        <th style="background-color:#F8F8F8;border-bottom:0px;" colspan="3">
                            <apex:image styleClass="CollapseExpandAllImage" url="{!$Resource.ExpandAll1}" title="Expand All" onclick="actExapndAllServiceType();" rendered="{!blnCollapseAll}"/>
                            <apex:outputText styleClass="CollapseExpandAllText" value="Expand all" rendered="{!blnCollapseAll}"></apex:outputText>
                            <apex:image styleClass="CollapseExpandAllImage" url="{!$Resource.CollapseAll1}" title="Collapse All" onclick="actCollepseAllServiceType();" rendered="{!blnExpandAll}"/>
                            <apex:outputText styleClass="CollapseExpandAllText" value="Collapse all" rendered="{!blnExpandAll}"></apex:outputText>
                            <!--
                            <apex:image styleClass="CollapseExpandAllImage" url="{!$Resource.ExpandAll1}" title="Hide all lines with no LoE" onclick="actHideAllServiceTypeWithNoLoE();" rendered="{!blnShowLinesWithNoLoE}"/>
                            <apex:outputText styleClass="CollapseExpandAllText" value="Hide all lines with no LoE" rendered="{!blnShowLinesWithNoLoE}"></apex:outputText>
                            <apex:image styleClass="CollapseExpandAllImage" url="{!$Resource.CollapseAll1}" title="Show lines with no LoE" onclick="actShowAllServiceTypeWithNoLoE();" rendered="{!blnHideAllLinesWithNoLoE}"/>
                            <apex:outputText styleClass="CollapseExpandAllText" value="Show lines with no LoE" rendered="{!blnHideAllLinesWithNoLoE}"></apex:outputText>
                            
                            <apex:image styleClass="CollapseExpandAllImage" url="{!$Resource.ExpandAll1}" title="Hide Cancelled" onclick="actHideCancelled();" rendered="{!blnShowCancelled}"/>
                            <apex:outputText styleClass="CollapseExpandAllText" value="Hide Cancelled" rendered="{!blnShowCancelled}"></apex:outputText>
                            <apex:image styleClass="CollapseExpandAllImage" url="{!$Resource.CollapseAll1}" title="Show Cancelled" onclick="actShowCancelled();" rendered="{!blnHideCancelled}"/>
                            <apex:outputText styleClass="CollapseExpandAllText" value="Show Cancelled" rendered="{!blnHideCancelled}"></apex:outputText> -->
                        </th>
                       <th id="RiskExpand" class="headerRowUpper" colspan="3" style="display:{!if($Profile.Name != 'LFA',if(blnShowRisk == true,'','none'),'none')};border-bottom:0px !important;text-align:center;">
                           Risks
                           <apex:image styleClass="Image" url="{!$Resource.Expand}" onclick="ColumnExpandCollepse('Risktd','Riskth','RiskExpand','RiskCollepsed','{!$Component.hdnblnShowRisk}','false');" title="Collapse"/>
                       </th>
                        <th id="StatusExpand" class="headerRowUpper"  style="border-bottom:0px !important;text-align:center;">
                            <apex:commandLink action="{!sortDataMainGrid}"  value="Service Status{!IF(sortExpressionMainGrid == 'Status__c',IF(sortExpressionMainGrid =='ASC','?','?'),'')}" status="Processing" reRender="frm" styleclass="white">
                                <apex:param value="Status__c" name="column" assignTo="{!sortExpressionMainGrid}"></apex:param>
                            </apex:commandLink>
                            <apex:image styleClass="Image" url="{!$Resource.Expand}" onclick="ColumnExpandCollepse('Statustd','Statusth','StatusExpand','StatusCollepsed','{!$Component.hdnblnShowStatus}','false');" title="Collapse"/>
                        </th>
                        <th id="TGFExpand" class="headerRowUpper" colspan="2" style="display:{!if($Profile.Name != 'LFA',if(blnShowTGF == true,'','none'),'none')};border-bottom:0px !important;text-align:center;">
                         Actual
                          <apex:image styleClass="Image" url="{!$Resource.Expand}" onclick="ColumnExpandCollepse('TGFtd','TGFth','TGFExpand','TGFCollepsed','{!$Component.hdnblnShowTGF}','false');" title="Collapse"/>
                        </th>
                        <th id="LFAExpand" class="headerRowUpper" colspan="2" style="display:{!if($Profile.Name != 'LFA',if(blnShowLFAprop == true,'','none'),'none')};border-bottom:0px !important;text-align:center;">
                         Budgeted
                          <apex:image styleClass="Image" url="{!$Resource.Expand}" onclick="ColumnExpandCollepse('LFAtd','LFAth','LFAExpand','LFACollepsed','{!$Component.hdnblnShowLFA}','false');" title="Collapse"/>
                        </th>
                        <th id="POExpand" class="headerRowUpper" colspan="2" style="display:{!if($Profile.Name != 'LFA',if(blnShowPOLFAprop == true,'','none'),'none')};border-bottom:0px !important;text-align:center;">
                         Approved
                          <apex:image styleClass="Image" url="{!$Resource.Expand}" onclick="ColumnExpandCollepse('POtd','POth','POExpand','POCollepsed','{!$Component.hdnblnShowPOTGF}','false');" title="Collapse"/>
                        </th>
                        <!--<th id="TGFExpand" class="headerRowUpper" colspan="2" style="display:{!if($Profile.Name != 'LFA',if(blnShowTGF == true,'','none'),'none')};border-bottom:0px !important;text-align:center;">
                         Actual
                          <apex:image styleClass="Image" url="{!$Resource.Expand}" onclick="ColumnExpandCollepse('TGFtd','TGFth','TGFExpand','TGFCollepsed','{!$Component.hdnblnShowTGF}','false');" title="Collapse"/>
                        </th> -->                    
                    </tr>  
                    <tr class="headerRow">
                        <th width="7%" class="headerRowLower"></th>
                        <th width="13%" class="headerRowLower" style="border-left:0px !important;">
                            <apex:commandLink action="{!sortDataMainGrid}"  value="Service{!IF(sortExpressionMainGrid == 'Name',IF(sortExpressionMainGrid =='ASC','?','?'),'')}" status="Processing" reRender="frm" styleclass="white">
                                <apex:param value="Name" name="column" assignTo="{!sortExpressionMainGrid}"></apex:param>
                            </apex:commandLink>
                        </th>
                        <th width="10%" class="headerRowLower" style="border-left:0px !important;border-right:0px !important;">
                            <apex:commandLink action="{!sortDataMainGrid}"  value="Grant{!IF(sortExpressionMainGrid == 'Grant__c',IF(sortExpressionMainGrid =='ASC','?','?'),'')}" status="Processing" reRender="frm" styleclass="white">
                                <apex:param value="Grant__c" name="column" assignTo="{!sortExpressionMainGrid}"></apex:param>
                            </apex:commandLink>
                        </th>
                        <th id="Riskth" width="6%" class="headerRowLower">
                            <apex:commandLink action="{!sortDataMainGrid}"  value="Financial & Fiduciary{!IF(sortExpressionMainGrid == 'Grant__r.Financial_and_Fiduciary_Risks__c',IF(sortExpressionMainGrid =='ASC','?','?'),'')}" status="Processing" reRender="frm" styleclass="white">
                                <apex:param value="Grant__r.Financial_and_Fiduciary_Risks__c" name="column" assignTo="{!sortExpressionMainGrid}"></apex:param>
                            </apex:commandLink>
                        </th>
                        <th id="Riskth" width="6%" class="headerRowLower">
                            <apex:commandLink action="{!sortDataMainGrid}"  value="Programmatic & Performance{!IF(sortExpressionMainGrid == 'Grant__r.Programmatic_and_Performance_Risks__c',IF(sortExpressionMainGrid =='ASC','?','?'),'')}" status="Processing" reRender="frm" styleclass="white">
                                <apex:param value="Grant__r.Programmatic_and_Performance_Risks__c" name="column" assignTo="{!sortExpressionMainGrid}"></apex:param>
                            </apex:commandLink>
                        </th>
                        <th id="Riskth" width="6%" class="headerRowLower">
                            <apex:commandLink action="{!sortDataMainGrid}"  value="Health Services & Products{!IF(sortExpressionMainGrid == 'Grant__r.Health_Services_and_Products_Risks__c',IF(sortExpressionMainGrid =='ASC','?','?'),'')}" status="Processing" reRender="frm" styleclass="white">
                                <apex:param value="Grant__r.Health_Services_and_Products_Risks__c" name="column" assignTo="{!sortExpressionMainGrid}"></apex:param>
                            </apex:commandLink>
                        </th>
                        <th id="Statusth" width="10%" class="headerRowLower"></th>
                        <!-- Before Sorting
                        <th id="LFAth" width="8%" class="headerRowLower" style="display:{!if($Profile.Name != 'LFA',if(blnShowLFAprop == true,'','none'),'none')};border-left:0px !important;"> LOE</th>
                        <th id="LFAth" width="8%" class="headerRowLower" style="display:{!if($Profile.Name != 'LFA',if(blnShowLFAprop == true,'','none'),'none')};border-left:0px !important;">Cost</th>
                        
                        <th id="POth" width="8%" class="headerRowLower" style="display:{!if($Profile.Name != 'LFA',if(blnShowPOLFAprop == true,'','none'),'none')};border-left:0px !important;"> LOE</th>
                        <th id="POth" width="8%" class="headerRowLower" style="display:{!if($Profile.Name != 'LFA',if(blnShowPOLFAprop == true,'','none'),'none')};border-left:0px !important;">Cost</th>
                        -->
                        <th id="LFAth" width="7%" class="headerRowLower" style="display:{!if($Profile.Name != 'LFA',if(blnShowLFAprop == true,'','none'),'none')};border-left:0px !important;">
                            <apex:commandLink action="{!sortDataMainGrid}"  value="LOE{!IF(sortExpressionMainGrid == 'Actual_LOE__c',IF(sortExpressionMainGrid =='ASC','?','?'),'')}" status="Processing" reRender="frm" styleclass="white">
                                <apex:param value="Actual_LOE__c" name="column" assignTo="{!sortExpressionMainGrid}"></apex:param>
                            </apex:commandLink>  
                        </th>
                        <th id="LFAth" width="7%" class="headerRowLower" style="display:{!if($Profile.Name != 'LFA',if(blnShowLFAprop == true,'','none'),'none')};border-left:0px !important;">
                            <apex:commandLink action="{!sortDataMainGrid}"  value="Cost{!IF(sortExpressionMainGrid == 'Actual_Cost__c',IF(sortExpressionMainGrid =='ASC','?','?'),'')}" status="Processing" reRender="frm" styleclass="white">
                                <apex:param value="Actual_Cost__c" name="column" assignTo="{!sortExpressionMainGrid}"></apex:param>
                            </apex:commandLink>
                        </th>
                        <th id="TGFth" width="7%" class="headerRowLower" style="display:{!if($Profile.Name != 'LFA',if(blnShowTGF == true,'','none'),'none')};border-left:0px !important;">
                            <apex:commandLink action="{!sortDataMainGrid}"  value="LOE{!IF(sortExpressionMainGrid == 'LOE__c',IF(sortExpressionMainGrid =='ASC','?','?'),'')}" status="Processing" reRender="frm" styleclass="white">
                                <apex:param value="LOE__c" name="column" assignTo="{!sortExpressionMainGrid}"></apex:param>
                            </apex:commandLink>  
                        </th>
                        <th id="TGFth" width="7%" class="headerRowLower" style="display:{!if($Profile.Name != 'LFA',if(blnShowTGF == true,'','none'),'none')};border-left:0px !important;">
                            <apex:commandLink action="{!sortDataMainGrid}"  value="Cost{!IF(sortExpressionMainGrid == 'Cost__c',IF(sortExpressionMainGrid =='ASC','?','?'),'')}" status="Processing" reRender="frm" styleclass="white">
                                <apex:param value="Cost__c" name="column" assignTo="{!sortExpressionMainGrid}"></apex:param>
                            </apex:commandLink>
                        </th>
                        
                        <th id="POth" width="7%" class="headerRowLower" style="display:{!if($Profile.Name != 'LFA',if(blnShowPOLFAprop == true,'','none'),'none')};border-left:0px !important;">
                            <apex:commandLink action="{!sortDataMainGrid}"  value="LOE{!IF(sortExpressionMainGrid == 'PO_LOE__c',IF(sortExpressionMainGrid =='ASC','?','?'),'')}" status="Processing" reRender="frm" styleclass="white">
                                <apex:param value="PO_LOE__c" name="column" assignTo="{!sortExpressionMainGrid}"></apex:param>
                            </apex:commandLink>  
                        </th>
                        <th id="POth" width="7%" class="headerRowLower" style="display:{!if($Profile.Name != 'LFA',if(blnShowPOLFAprop == true,'','none'),'none')};border-left:0px !important;">
                            <apex:commandLink action="{!sortDataMainGrid}"  value="Cost{!IF(sortExpressionMainGrid == 'PO_Cost__c',IF(sortExpressionMainGrid =='ASC','?','?'),'')}" status="Processing" reRender="frm" styleclass="white">
                                <apex:param value="PO_Cost__c" name="column" assignTo="{!sortExpressionMainGrid}"></apex:param>
                            </apex:commandLink>
                        </th>
                        <!--
                        <th id="LFAth" width="8%" class="headerRowLower" style="display:{!if($Profile.Name != 'LFA',if(blnShowLFAprop == true,'','none'),'none')};border-left:0px !important;">
                            <apex:commandLink action="{!sortDataMainGrid}"  value="LOE{!IF(sortExpressionMainGrid == 'Actual_LOE__c',IF(sortExpressionMainGrid =='ASC','?','?'),'')}" status="Processing" reRender="frm" >
                                <apex:param value="Actual_LOE__c" name="column" assignTo="{!sortExpressionMainGrid}"></apex:param>
                            </apex:commandLink>  
                        </th>
                        <th id="LFAth" width="8%" class="headerRowLower" style="display:{!if($Profile.Name != 'LFA',if(blnShowLFAprop == true,'','none'),'none')};border-left:0px !important;">
                            <apex:commandLink action="{!sortDataMainGrid}"  value="Cost{!IF(sortExpressionMainGrid == 'Actual_Cost__c',IF(sortExpressionMainGrid =='ASC','?','?'),'')}" status="Processing" reRender="frm" >
                                <apex:param value="Actual_Cost__c" name="column" assignTo="{!sortExpressionMainGrid}"></apex:param>
                            </apex:commandLink>
                        </th>-->                                                                        
                        <!--<th id="CTth" width="8%" class="headerRowLower" style="display:{!if($Profile.Name != 'LFA',if(blnShowCTPlanned == true,'','none'),'none')};border-left:0px !important;">LOE</th>
                        <th id="CTth" width="8%" class="headerRowLower" style="display:{!if($Profile.Name != 'LFA',if(blnShowCTPlanned == true,'','none'),'none')};border-left:0px !important;">Cost</th>                       
                        <!--<th id="TGFth" width="7%" class="headerRowLower" style="display:{!if($Profile.Name != 'LFA',if(blnShowTGF == true,'','none'),'none')};border-left:0px !important;">LOE</th>
                        <th id="TGFth" width="7%" class="headerRowLower" style="display:{!if($Profile.Name != 'LFA',if(blnShowTGF == true,'','none'),'none')};border-left:0px !important;">Cost</th>-->
                    </tr>  
                </thead>
                <apex:variable var="CountST" value="{!0}" />  
<!----REPEAT THE SERVICES---->              
                <apex:repeat id="repeatUpper" value="{!lstwrapServicesType}" var="wrapST">
                    <tr class="totalRow">
                        <th class="totalRow">
                            <apex:inputHidden id="CollapseStatus" value="{!wrapST.blnExpandSection}" />
                            <apex:outputpanel id="collapseimage" style="display:{!if(wrapST.blnExpandSection == true,'none','')};" rendered="{!if(wrapST.lstwrapServices.size > 0,true,false)}">
                                <apex:image styleClass="Image" url="{!$Resource.Collepse}" onclick="switchMenu('inlinetablesec{!CountST}','{!$Component.Expandimage}','{!$Component.collapseimage}','{!$Component.CollapseStatus}','true')" title="Expand"/>
                            </apex:outputpanel>
                            <apex:outputpanel id="Expandimage" style="display:{!if(wrapST.blnExpandSection == true,'','none')};" rendered="{!if(wrapST.lstwrapServices.size > 0,true,false)}">
                                  <apex:image styleClass="Image" url="{!$Resource.Expand}" onclick="switchMenu('inlinetablesec{!CountST}','{!$Component.collapseimage}','{!$Component.Expandimage}','{!$Component.CollapseStatus}','false')" title="Collapse"/>
                            </apex:outputpanel>
                            <apex:commandLink styleClass="AddLink" action="{!AddService}" id="cmdAdd" value="Add" reRender="frm" status="Processing">
                                <apex:param name="AddIndex" value="{!CountST}" id="AddIndex"/>
                            </apex:commandLink>
                        </th>
                        <th class="totalRow " colspan="2">
                            <apex:outputText value="{!wrapST.ServiceType}" styleClass="white"/>
                        </th>
                        <th id="Riskth" class="totalRow " colspan="3">
                            
                        </th>
                         <th id="Statusth" class="totalRow">
                            
                        </th>
                        <th id="TGFth" class="totalRow " style="display:{!if(blnShowTGF == true,'','none')};">
                            <apex:outputText value="{!wrapST.TotalCurrentLOE}" rendered="{!if(wrapST.TotalCurrentLOE != null && wrapST.TotalCurrentLOE != 0,true,false)}"></apex:outputText>
                        </th>
                        <th id="TGFth" class="totalRow " style="display:{!if(blnShowTGF == true,'','none')};"> 
                            
                            <apex:outputText value="USD {0, number,###,###,##0}" rendered="{!if(wrapST.TotalCurrentCost != null && wrapST.TotalCurrentCost != 0,true,false)}">
                                <apex:param value="{!wrapST.TotalCurrentCost}"/>
                            </apex:outputText>
                        </th>
                        <th id="LFAth" class="totalRow " style="display:{!if($Profile.Name != 'LFA',if(blnShowLFAprop == true,'','none'),'none')};">
                            <apex:outputText value="{!wrapST.TotalLFAProposedLOE}" rendered="{!if(wrapST.TotalLFAProposedLOE != null && wrapST.TotalLFAProposedLOE != 0,true,false)}"></apex:outputText>
                        </th>
                        <th id="LFAth" class="totalRow " style="display:{!if($Profile.Name != 'LFA',if(blnShowLFAprop == true,'','none'),'none')};">
                            <apex:outputText value="USD {0, number,###,###,##0}" rendered="{!if(wrapST.TotalLFAProposedCost != null && wrapST.TotalLFAProposedCost != 0,true,false)}">
                                <apex:param value="{!wrapST.TotalLFAProposedCost}"/>
                            </apex:outputText>
                        </th>
                        <th id="POth" class="totalRow " style="display:{!if($Profile.Name != 'LFA',if(blnShowPOLFAprop == true,'','none'),'none')};">
                            <apex:outputText value="{!wrapST.TotalPOLOE}" rendered="{!if(wrapST.TotalPOLOE  != null && wrapST.TotalPOLOE != 0,true,false)}"></apex:outputText>
                        </th>
                        <th id="POth" class="totalRow " style="display:{!if($Profile.Name != 'LFA',if(blnShowPOLFAprop == true,'','none'),'none')};">
                            <apex:outputText value="USD {0, number,###,###,##0}" rendered="{!if(wrapST.TotalPOCost != null && wrapST.TotalPOCost != 0,true,false)}">
                                <apex:param value="{!wrapST.TotalPOCost}"/>
                            </apex:outputText>
                        </th><!-- display:{!if($Profile.Name != 'LFA',if(blnShowTGF == true,'','none'),'none')}; -->
                        <!--<th id="TGFth" class="totalRow " style="display:{!if(blnShowTGF == true,'','none')};">
                            <apex:outputText value="{!wrapST.TotalCurrentLOE}" rendered="{!if(wrapST.TotalCurrentLOE != null && wrapST.TotalCurrentLOE != 0,true,false)}"></apex:outputText>
                        </th>
                        <th id="TGFth" class="totalRow " style="display:{!if(blnShowTGF == true,'','none')};"> 
                            
                            <apex:outputText value="USD {0, number,###,###,##0}" rendered="{!if(wrapST.TotalCurrentCost != null && wrapST.TotalCurrentCost != 0,true,false)}">
                                <apex:param value="{!wrapST.TotalCurrentCost}"/>
                            </apex:outputText>
                        </th>-->
                        
                        <!--<th id="CTth" class="totalRow " style="display:{!if($Profile.Name != 'LFA',if(blnShowCTPlanned == true,'','none'),'none')};">
                            <apex:outputText value="{!wrapST.TotalTGFProposedLOE}" rendered="{!if(wrapST.TotalTGFProposedLOE != null && wrapST.TotalTGFProposedLOE != 0,true,false)}"></apex:outputText>
                        </th>
                        <th id="CTth" class="totalRow " style="display:{!if($Profile.Name != 'LFA',if(blnShowCTPlanned == true,'','none'),'none')};">
                            <apex:outputText value="USD {0, number,###,###,##0}" rendered="{!if(wrapST.TotalTGFProposedCost != null && wrapST.TotalTGFProposedCost != 0,true,false)}">
                                <apex:param value="{!wrapST.TotalTGFProposedCost}"/>
                            </apex:outputText>
                        </th>-->
                    </tr>
                    <tbody id="inlinetablesec{!CountST}" style="display:{!if(wrapST.blnExpandSection == true,'','none')};">
                        <apex:variable var="Count" value="{!0}" />
                        <apex:repeat id="repeat" value="{!wrapST.lstwrapServices}" var="Service">   
                            <tr>
                                <td class="dataCell" style="white-space: nowrap;border-top:1px solid #838282;border-left:1px solid #E0E3E5;">
                                    <apex:image style="cursor:pointer;display:{!if(($Profile.Name == 'Country Team' || $Profile.Name == 'Management') && lstWorkPlanToUpdate[0].Country_Team_can_edit__c == false,'none','')};" value="{!$Resource.EditImage}" height="20" width="25" onclick="EditResource(this,'{!Count}','{!CountST}');" rendered="{!if(Service.objService.id != null,true,false)}" title="Edit"/>
                                    <apex:image style="cursor:pointer;display:{!if(($Profile.Name == 'Country Team' || $Profile.Name == 'Management') && lstWorkPlanToUpdate[0].Country_Team_can_edit__c == false,'none','')};" value="{!$Resource.DeleteImage}" height="20" width="25" rendered="{!if(Service.objService.id == null,true,false)}" onclick="DeleteService('{!Count}','{!CountST}');"  title="Delete"/>
                                    <apex:inputHidden id="CollapseStatusResource" value="{!Service.blnExpandResourceSection}" />
                                    <apex:outputpanel id="collapseimageResource" style="display:{!if(Service.blnExpandResourceSection == true,'none','')};" rendered="{!if(Service.lstwrapResource.size > 0,true,false)}">
                                        <apex:image styleClass="ImageResource" url="{!$Resource.Collepse}" onclick="switchMenuResource('inlinetablesecResource{!CountST}{!Count}','ResourceHeader{!CountST}{!Count}','{!$Component.ExpandimageResource}','{!$Component.collapseimageResource}','{!$Component.CollapseStatusResource}','true')" title="Expand"/>
                                    </apex:outputpanel>
                                    <apex:outputpanel id="ExpandimageResource" style="display:{!if(Service.blnExpandResourceSection == true,'','none')};" rendered="{!if(Service.lstwrapResource != null,true,false)}">
                                          <apex:image styleClass="ImageResource" url="{!$Resource.Expand}" onclick="switchMenuResource('inlinetablesecResource{!CountST}{!Count}','ResourceHeader{!CountST}{!Count}','{!$Component.collapseimageResource}','{!$Component.ExpandimageResource}','{!$Component.CollapseStatusResource}','false')" title="Collapse"/>
                                    </apex:outputpanel> &nbsp;
                                    <apex:image style="cursor:pointer;display:{!if(($Profile.Name == 'Country Team' ||  $Profile.Name == 'Management') && lstWorkPlanToUpdate[0].Country_Team_can_edit__c == false,'none','')};" value="/resource/1371464181000/GraphicsPack/16/fatcow/farmfresh/information.png" height="20" width="22"  rendered="{!if(Service.objService.id != null,if(Service.blnServCommentFeed,true,false),false)}" title="Chatter Feed : Last Modified - {!Service.ServCommentLM_date}"/>
                                    <!--<apex:inputHidden value="Status" id="hdnSecStatus"/>
                                    <apex:inputHidden value="LastmodifiedDate" id="hdnLastmodifiedDate"/>
                                    <apex:inputHidden value="LastmodifiedBy" id="hdnLastmodifiedBy"/>-->
                                </td>
                                <td class="dataCell" style="border-top:1px solid #838282;">
                                    <apex:outputField value="{!Service.objService.Name}" rendered="{!if(Service.objService.id != null,true,false)}" style="float:left;"/>
                                    
                                    <!--<apex:Image style="cursor:pointer;float:right;" height="20" width="20" value="{!$Resource.InformationFlagOrange}" rendered="{!if(Service.objService.id != null && Service.objService.Alert_check_grant__c  == true,true,false)}" onmouseout="toggleDescService('{!$Component.DescPopup}')" onmouseover="toggleDescService('{!$Component.DescPopup}')"/>
                                    <apex:Image style="cursor:pointer;float:right;" height="20" width="20" value="{!$Resource.InformationFlagRed}" rendered="{!if(Service.objService.id != null && Service.objService.num_resources__c=0,true,false)}" onmouseout="toggleDescService('{!$Component.DescPopupHasResource}')" onmouseover="toggleDescService('{!$Component.DescPopupHasResource}')"/>
                                    <apex:Image style="cursor:pointer;float:right;" height="20" width="20" value="{!$Resource.InformationFlagBlue}" rendered="{!if(Service.objService.id != null && Service.objService.Has_TBD_Contact__c != null && Service.objService.Has_TBD_Contact__c>0,true,false)}" onmouseout="toggleDescService('{!$Component.DescPopupLOE}')" onmouseover="toggleDescService('{!$Component.DescPopupLOE}')"/>-->
                                    <apex:outputpanel styleClass="DescServicePopupClone" id="DescPopup" style="display:none;">
                                        <apex:outputText value="Please view and confirm the resource details for this cloned service." rendered="{!if(Service.objService.Alert_check_grant__c  == true,true,false)}"/>
                                    </apex:outputpanel>
                                    <apex:outputpanel styleClass="DescServicePopupHasResource" id="DescPopupHasResource" style="display:none;">
                                        <apex:outputText value="You must assign at least one resource to this service." rendered="{!if(Service.objService.num_resources__c=0,true,false)}"/>
                                    </apex:outputpanel>
                                    <apex:outputpanel styleClass="DescServicePopupLOE" id="DescPopupLOE" style="display:none;">
                                        <apex:outputText value="There is a TBD resource on this service with LOE assigned." rendered="{!if(Service.objService.id != null && Service.objService.Has_TBD_Contact__c != null && Service.objService.Has_TBD_Contact__c>0,true,false)}"/>
                                    </apex:outputpanel>
                                                                                                               
                                                                                                               
                                    <!--<apex:Image url="{!URLFOR($Resource.GraphicsPack, '16/fatcow/farmfresh/flag_2.png')}" rendered="{!if(Service.objService.id != null && Service.objService.Alert_check_grant__c == true,true,false)}" style="float:right;"/>-->
                                    <apex:inputField value="{!Service.objService.Service_Type__c}" style="display:none;"/>
                                    <apex:inputField id="ServiceSubtype" value="{!Service.objService.Service_Sub_Type__c}" rendered="{!if(Service.objService.id == null,true,false)}"/>
                                    <!--<table cellspacing="0" cellpadding="0" border="0" class="noBorder">
                                        <tr>
                                            <td>
                                                <apex:selectList value="{!Service.objService.Service_Sub_Type__c}" style="width:200px;" size="1" rendered="{!if(Service.objService.id == null,true,false)}" >
                                                    <apex:selectOptions value="{!ServiceSubTypeOptions}"></apex:selectOptions>
                                                </apex:selectList>
                                            </td>
                                        </tr>
                                    </table>-->
                                </td>
                                <td class="dataCell" style="border-top:1px solid #838282;">                                    
                                    <apex:outputLink target="_Blank" value="/{!Service.objService.Grant__c}" rendered="{!if(Service.objService.id != null && Service.objService.Grant__c != null,true,false)}">
                                        <apex:outputField value="{!Service.objService.Grant__c}"/>                                
                                    </apex:outputLink>                               
                                    <apex:outputtext value="Multiple Grants" rendered="{!if(Service.objService.id != null && Service.objService.Grant__c == null,true,false)}"/>
                                    <apex:selectList value="{!SelectedGrant}" style="width:100px;"  rendered="{!if(Service.objService.id == null,true,false)}" size="1">
                                        <apex:selectOptions value="{!GrantOptions}"></apex:selectOptions>
                                    </apex:selectList>
                                </td>
                                
                                <td id="Risktd" colspan="{!if(Service.objService.id == null,'3','1')}" class="dataCell" style="border-right:{!if(Service.objService.id == null,'0px !important','')};border-top:1px solid #838282;background-color:{!if(Service.objService.Grant__r.Financial_and_Fiduciary_Risks__c == 'High','red',if(Service.objService.Grant__r.Financial_and_Fiduciary_Risks__c == 'Medium','yellow',if(Service.objService.Grant__r.Financial_and_Fiduciary_Risks__c == 'Low','lightgreen','')))}">
                                    <apex:outputField value="{!Service.objService.Grant__r.Financial_and_Fiduciary_Risks__c}" rendered="{!if(Service.objService.id != null,true,false)}"/>
                                    <apex:commandLink id="cmdLinksave" value="Save service and add Resources" rendered="{!if(Service.objService.id == null,true,false)}" action="{!SaveServiceAndAddResources}" onclick="return validate('{!$Component.ServiceSubtype}','{!Count}','{!CountST}',this,event);setFocus();"/>
                                </td>  
                                <td id="Risktd" class="dataCell" style="border-top:1px solid #838282;display:{!if(Service.objService.id == null,'none','')};background-color:{!if(Service.objService.Grant__r.Programmatic_and_Performance_Risks__c == 'High','red',if(Service.objService.Grant__r.Programmatic_and_Performance_Risks__c == 'Medium','yellow',if(Service.objService.Grant__r.Programmatic_and_Performance_Risks__c == 'Low','lightgreen','')))}">
                                    <apex:outputField value="{!Service.objService.Grant__r.Programmatic_and_Performance_Risks__c}" rendered="{!if(Service.objService.id != null,true,false)}"/>
                                </td>  
                                <td id="Risktd" class="dataCell" style="border-top:1px solid #838282;display:{!if(Service.objService.id == null,'none','')};background-color:{!if(Service.objService.Grant__r.Health_Services_and_Products_Risks__c == 'High','red',if(Service.objService.Grant__r.Health_Services_and_Products_Risks__c == 'Medium','yellow',if(Service.objService.Grant__r.Health_Services_and_Products_Risks__c == 'Low','lightgreen','')))}">
                                    <apex:outputField value="{!Service.objService.Grant__r.Health_Services_and_Products_Risks__c}" rendered="{!if(Service.objService.id != null,true,false)}"/>
                                </td>
                            <!--    <td id="Statustd" class="dataCell" style="border:{!if(Service.objService.id == null && Service.objService.Status__c == 'Service Addition In-Process','0px !important','' )};border-top:1px solid #838282;display:;background-color:green" styleClass="border:{!IF(Service.objService.Status__c == 'Service Addition In-Process','0px !important','' )};border-top:1px solid #838282;display:;background-color:Orange"> -->
                                <!--   <td id="Risktd" class="dataCell" style="border-top:1px solid #838282;display:{!if(Service.objService.id == null,'0px !important','' )};background-color:{!if(Service.objService.Status__c == 'Completed','orange',if(Service.objService.Status__c == 'Ongoing','orange',if(Service.objService.Status__c == 'Service Addition In-Process','orange','')))}">  -->
                                  <td id="Statustd" class="dataCell" style="border-top:1px solid #838282;display:{!if(Service.objService.id == null,'0px !important','' )};background-color:{!if((Service.objService.Status__c == 'Cancellation Request' || Service.objService.Status__c == 'Service Addition' || Service.objService.Status__c == 'LFA Change Request' || Service.objService.Status__c == 'LFA Counterproposal' || Service.objService.Status__c == 'Completed' ),'orange',if(Service.objService.Status__c == 'Completed','orange',if(Service.objService.Status__c == 'LFA Counter-Proposal','orange','')))}">

                                  <apex:outputField value="{!Service.objService.Status__c}" rendered="{!if(Service.objService.id != null,true,false)}"/>
                                </td>
                                <!--<td id="LFAtd" class="dataCell" style="border:{!if(Service.objService.id == null,'0px !important','')};border-top:1px solid #838282;display:{!if($Profile.Name != 'LFA',if(blnShowLFAprop == true,'','none'),'none')}">
                                    <apex:outputField value="{!Service.objService.LFA_Proposed_LOE__c}" rendered="{!if(Service.objService.id != null && Service.objService.LFA_Proposed_LOE__c != 0,true,false)}"/>
                                </td>
                                <td id="LFAtd" class="dataCell" style="border:{!if(Service.objService.id == null,'0px !important','')};border-top:1px solid #838282;display:{!if($Profile.Name != 'LFA',if(blnShowLFAprop == true,'','none'),'none')}">
                                    <apex:outputField value="{!Service.objService.LFA_Proposed_Cost__c}" rendered="{!if(Service.objService.id != null && Service.objService.LFA_Proposed_Cost__c != 0,true,false)}"/>
                                </td>-->
                                <td id="TGFtd" class="dataCell" style="border-top:1px solid #838282;border:{!if(Service.objService.id == null,'0px !important','')};display:{!if($Profile.Name != 'LFA',if(blnShowTGF == true,'','none'),'none')}">
                                    <apex:outputField value="{!Service.objService.Actual_LOE__c}" rendered="{!if(Service.objService.id != null && Service.objService.LOE__c != 0,true,false)}"/>
                                </td>
                                
                                <td id="TGFtd" class="dataCell" style="border-top:1px solid #838282;border:{!if(Service.objService.id == null,'0px !important','')};display:{!if($Profile.Name != 'LFA',if(blnShowTGF == true,'','none'),'none')};">
                                    <apex:outputField value="{!Service.objService.Actual_Cost__c}" rendered="{!if(Service.objService.id != null && Service.objService.Cost__c != 0,true,false)}"/>                                    
                                </td>
                                <td id="LFAtd" class="dataCell" style="border:{!if(Service.objService.id == null,'0px !important','')};border-top:1px solid #838282;display:{!if($Profile.Name != 'LFA',if(blnShowLFAprop == true,'','none'),'none')};background-color:#ededed;">
                                    <apex:outputField value="{!Service.objService.LOE__c}" rendered="{!if(Service.objService.id != null && Service.objService.LOE__c != 0,true,false)}"/>
                                </td>
                                <td id="LFAtd" class="dataCell" style="border:{!if(Service.objService.id == null,'0px !important','')};border-top:1px solid #838282;display:{!if($Profile.Name != 'LFA',if(blnShowLFAprop == true,'','none'),'none')};background-color:#ededed;">
                                    <apex:outputField value="{!Service.objService.Cost__c}" rendered="{!if(Service.objService.id != null && Service.objService.Cost__c != 0,true,false)}"/>
                                </td>
                                <td id="POtd" class="dataCell" style="border:{!if(Service.objService.id == null,'0px !important','')};border-top:1px solid #838282;display:{!if($Profile.Name != 'LFA',if(blnShowPOLFAprop == true,'','none'),'none')}">
                                    <apex:outputField value="{!Service.objService.PO_LOE__c}" rendered="{!if(Service.objService.id != null && Service.objService.PO_LOE__c != 0,true,false)}"/>
                                </td>
                                <td id="POtd" class="dataCell" style="border:{!if(Service.objService.id == null,'0px !important','')};border-top:1px solid #838282;display:{!if($Profile.Name != 'LFA',if(blnShowPOLFAprop == true,'','none'),'none')}">
                                    <apex:outputField value="{!Service.objService.PO_Cost__c}" rendered="{!if(Service.objService.id != null && Service.objService.PO_Cost__c != 0,true,false)}"/>
                                </td>
                                <!--<td id="TGFtd" class="dataCell" style="border-top:1px solid #838282;border:{!if(Service.objService.id == null,'0px !important','')};display:{!if($Profile.Name != 'LFA',if(blnShowTGF == true,'','none'),'none')}">
                                    <apex:outputField value="{!Service.objService.LOE__c}" rendered="{!if(Service.objService.id != null && Service.objService.LOE__c != 0,true,false)}"/>
                                </td>
                                <td id="TGFtd" class="dataCell" style="border-top:1px solid #838282;border:{!if(Service.objService.id == null,'0px !important','')};display:{!if($Profile.Name != 'LFA',if(blnShowTGF == true,'','none'),'none')}" >
                                    <apex:outputField value="{!Service.objService.Cost__c}" rendered="{!if(Service.objService.id != null && Service.objService.Cost__c != 0,true,false)}"/>                                    
                                </td>
                                -->
                                <!--<td id="TGFtd" class="dataCell" style="border-top:1px solid #838282;border:{!if(Service.objService.id == null,'0px !important','')};display:{!if($Profile.Name != 'LFA',if(blnShowTGF == true,'','none'),'none')}">
                                    <apex:outputField value="{!Service.objService.Actual_LOE__c}" rendered="{!if(Service.objService.id != null && Service.objService.LOE__c != 0,true,false)}"/>
                                </td>
                                
                                <td id="TGFtd" class="dataCell" style="border-top:1px solid #838282;border:{!if(Service.objService.id == null,'0px !important','')};display:{!if($Profile.Name != 'LFA',if(blnShowTGF == true,'','none'),'none')}" >
                                    <apex:outputField value="{!Service.objService.Actual_Cost__c}" rendered="{!if(Service.objService.id != null && Service.objService.Cost__c != 0,true,false)}"/>                                    
                                </td>-->
                                
                                <!--<td id="CTtd" class="dataCell" style="border:{!if(Service.objService.id == null,'0px !important','')};border-top:1px solid #838282;display:{!if($Profile.Name != 'LFA',if(blnShowCTPlanned == true,'','none'),'none')}">
                                    <apex:outputField value="{!Service.objService.Initial_TGF_Proposed_LOE__c}" rendered="{!if(Service.objService.id != null && Service.objService.Initial_TGF_Proposed_LOE__c != 0,true,false)}"/>
                                </td>
                                <td id="CTtd" class="dataCell" style="border-top:1px solid #838282;border-left:{!if(Service.objService.id == null,'0px !important','')};border-right:1px solid #E0E3E5;display:{!if($Profile.Name != 'LFA',if(blnShowCTPlanned == true,'','none'),'none')}"> 
                                    <apex:outputField value="{!Service.objService.Initial_TGF_Proposed_Cost__c}" rendered="{!if(Service.objService.id != null && Service.objService.Initial_TGF_Proposed_Cost__c != 0,true,false)}"/>
                                </td>-->
                                
                            </tr>
<!----RESOURCES SUB-TABLE---->
                            <tr id="ResourceHeader{!CountST}{!Count}" style="display:{!if(Service.blnExpandResourceSection == true,'','none')};">
                                <th style="border:none"></th>
                                <th class="headerRowResource" colspan="2">Role</th>
                                <th id="Riskth" class="headerRowResource" colspan="3">Person</th>
                                <th id="Statusth" class="headerRowResource">Current Rate</th>
                                <th id="TGFth" class="headerRowResource" style="display:{!if(blnShowTGF == true,'','none')}">LOE</th>
                                <th id="TGFth" class="headerRowResource" style="display:{!if(blnShowTGF == true,'','none')}">Cost</th>
                                <th id="LFAth" class="headerRowResource" style="display:{!if(blnShowLFAprop == true,'','none')}">LOE</th>
                                <th id="LFAth" class="headerRowResource" style="display:{!if(blnShowLFAprop == true,'','none')}">Cost</th>
                                <th id="POth" class="headerRowResource" style="display:{!if(blnShowPOLFAprop == true,'','none')}">LOE</th>
                                <th id="POth" class="headerRowResource" style="display:{!if(blnShowPOLFAprop == true,'','none')}">Cost</th>
                                <!--<th id="TGFth" class="headerRowResource" style="display:{!if(blnShowTGF == true,'','none')}">LOE</th>
                                <th id="TGFth" class="headerRowResource" style="display:{!if(blnShowTGF == true,'','none')}">Cost</th>-->
                               
                                <!--<th id="CTth" class="headerRowResource" style="display:{!if(blnShowCTPlanned == true,'','none')}">LOE</th>
                                <th id="CTth" class="headerRowResource" style="display:{!if(blnShowCTPlanned == true,'','none')}">Cost</th>-->                            
                            </tr>
                            <apex:repeat value="{!Service.lstwrapResource}" var="ServiceResource">
                                <tr id="inlinetablesecResource{!CountST}{!Count}" style="display:{!if(Service.blnExpandResourceSection == true,'','none')};">
                                    <td class="dataCell" style="border:none;">
                                    </td>
                                    <td class="dataCell" colspan="2" style="border-bottom:1px solid #E0E3E5;">
                                        <apex:outputText value="{!ServiceResource.RoleName}" />
                                    </td>
                                    <td id="Risktd" class="dataCell" colspan="3" style="border-bottom:1px solid #E0E3E5;">
                                        <apex:outputText value="{!ServiceResource.ContactName}" />
                                    </td>
                                    <td id="Statustd" class="dataCell" style="border-bottom:1px solid #E0E3E5;">
                                        <apex:outputField value="{!ServiceResource.objResource.Rate__c}" />
                                    </td>
                                    <!--<td id="LFAtd" style="display:{!if(blnShowLFAprop == true,'','none')}">
                                        <apex:outputField value="{!ServiceResource.objResource.LFA_Proposed_LOE__c}"/>
                                    </td>
                                    <td id="LFAtd" style="display:{!if(blnShowLFAprop == true,'','none')}">
                                        <apex:outputField value="{!ServiceResource.objResource.LFA_Proposed_Cost__c}" style="display:{!if(ServiceResource.objResource.LFA_Proposed_Cost__c>0,'','none')}"/>
                                    </td>-->
                                    <td id="TGFtd" class="dataCell" style="display:{!if(blnShowTGF == true,'','none')};border-bottom:1px solid #E0E3E5;">
                                        <apex:outputField value="{!ServiceResource.objResource.Actual_LOE__c}"/>
                                    </td>                                    
                                    <td id="TGFtd" class="dataCell" style="display:{!if(blnShowTGF == true,'','none')};border-bottom:1px solid #E0E3E5;">
                                        <apex:outputField value="{!ServiceResource.objResource.Actual_Cost__c}"/>
                                    </td> 
                                    <td id="LFAtd" style="display:{!if(blnShowLFAprop == true,'','none')}">
                                        <apex:outputField value="{!ServiceResource.objResource.LOE__c}"/>
                                    </td>
                                    <td id="LFAtd" style="display:{!if(blnShowLFAprop == true,'','none')}">
                                        <apex:outputField value="{!ServiceResource.objResource.Cost__c}" style="display:{!if(ServiceResource.objResource.LFA_Proposed_Cost__c>0,'','none')}"/>
                                    </td>
                                    <td id="POtd" style="display:{!if(blnShowPOLFAprop == true,'','none')}">
                                        <apex:outputField value="{!ServiceResource.objResource.PO_LOE__c}"/>
                                    </td>
                                    <td id="POtd" style="display:{!if(blnShowPOLFAprop == true,'','none')}">
                                        <apex:outputField value="{!ServiceResource.objResource.PO_Cost__c}" style="display:{!if(ServiceResource.objResource.PO_Cost__c >0,'','none')}"/>
                                    </td>
                                    <!--<td id="TGFtd" class="dataCell" style="display:{!if(blnShowTGF == true,'','none')};border-bottom:1px solid #E0E3E5;">
                                        <apex:outputField value="{!ServiceResource.objResource.Actual_LOE__c}"/>
                                    </td>                                    
                                    <td id="TGFtd" class="dataCell" style="display:{!if(blnShowTGF == true,'','none')};border-bottom:1px solid #E0E3E5;">
                                        <apex:outputField value="{!ServiceResource.objResource.Actual_Cost__c}"/>
                                    </td>-->                                     
                                    <!--<td id="CTtd" style="display:{!if(blnShowCTPlanned == true,'','none')}">
                                        <apex:outputField value="{!ServiceResource.objResource.Initial_TGF_Proposed_LOE__c}"/>
                                    </td>
                                    <td id="CTtd" style="display:{!if(blnShowCTPlanned == true,'','none')}">
                                        <apex:outputField value="{!ServiceResource.objResource.Initial_TGF_Proposed_Cost__c}" style="display:{!if(ServiceResource.objResource.Initial_TGF_Proposed_Cost__c>0,'','none')}"/>
                                    </td>-->
                                </tr>
                            </apex:repeat>                           
                            <tr id="ResourceHeader{!CountST}{!Count}" style="display:{!if(Service.blnExpandResourceSection == true,'','none')};">
                                <td style="border:none"></td>
                                <td class="headerRowResource" style="border:none;background-color:peachpuff !important;word-wrap: break-word;" colspan="5">
                                    <div style="word-wrap: break-word;width:450px;">
                                        <b>Service Details:</b>&nbsp;{!Service.objService.Comments__c}
                                    </div>
                                </td>
                                <td id="CTth" class="headerRowResource" style="display:{!if($Profile.Name != 'LFA',if(blnShowCTPlanned == true,'','none'),'none')};"></td>
                                <td id="CTth" class="headerRowResource" style="display:{!if($Profile.Name != 'LFA',if(blnShowCTPlanned == true,'','none'),'none')};"></td>
                            </tr>
                            <!--<tr><td id="drawline" colspan="12" style="border-bottom:1px solid #838282;padding:0px;"></td></tr>-->
                            <apex:variable var="Count" value="{!Count+1}" />
                        </apex:repeat>
                    </tbody>
                    <apex:variable var="CountST" value="{!CountST+1}" />                    
                </apex:repeat>
                <tfoot>
                    <tr class="totalRow">
                        <th class="totalRow"></th>
                        <th class="totalRow" >
                            <!--<apex:commandLink action="{!AddService}" id="cmdAdd" value="Add" reRender="frm" status="Processing"/>-->
                        </th>
                        
                        <th class="totalRow"></th>
                        <th id="Riskth" class="totalRow"></th>
                        <th id="Riskth" class="totalRow"></th>
                        <th id="Riskth" class="totalRow"></th>
                        <th id="Statusth" class="totalRow">
                            <apex:outputText value="Total"></apex:outputText>
                        </th>
                        <th id="TGFth" class="totalRow" style="display:{!if($Profile.Name != 'LFA',if(blnShowTGF == true,'','none'),'none')};">
                            <apex:outputText value="{!CurrentLOE}" rendered="{!if(CurrentLOE != 0,true,false)}"></apex:outputText>
                        </th>
                        <th id="TGFth" class="totalRow" style="display:{!if($Profile.Name != 'LFA',if(blnShowTGF == true,'','none'),'none')};">
                            <apex:outputText value="USD {0, number,###,###,##0}" rendered="{!if(CurrentCost != 0,true,false)}">
                                <apex:param value="{!CurrentCost}"/>
                            </apex:outputText>
                        </th>
                        <th id="LFAth" class="totalRow" style="display:{!if($Profile.Name != 'LFA',if(blnShowLFAprop == true,'','none'),'none')};">
                            <apex:outputText value="{!LFAProposedLOE}" rendered="{!if(LFAProposedLOE != 0,true,false)}"></apex:outputText>
                        </th>
                        <th id="LFAth" class="totalRow" style="display:{!if($Profile.Name != 'LFA',if(blnShowLFAprop == true,'','none'),'none')};">
                            <apex:outputText value="USD {0, number,###,###,##0}" rendered="{!if(LFAProposedCost != 0,true,false)}">
                                <apex:param value="{!LFAProposedCost}"/>
                            </apex:outputText>
                            
                        </th>
                        <th id="POth" class="totalRow" style="display:{!if($Profile.Name != 'LFA',if(blnShowPOLFAprop == true,'','none'),'none')};">
                            <apex:outputText value="{!POLOE}" rendered="{!if(POLOE != 0,true,false)}"></apex:outputText>
                        </th>
                        <th id="POth" class="totalRow" style="display:{!if($Profile.Name != 'LFA',if(blnShowPOLFAprop == true,'','none'),'none')};">
                            <apex:outputText value="USD {0, number,###,###,##0}" rendered="{!if(POCost != 0,true,false)}">
                                <apex:param value="{!POCost}"/>
                            </apex:outputText>
                        </th>
                        <!--<th id="TGFth" class="totalRow" style="display:{!if($Profile.Name != 'LFA',if(blnShowTGF == true,'','none'),'none')};">
                            <apex:outputText value="{!CurrentLOE}" rendered="{!if(CurrentLOE != 0,true,false)}"></apex:outputText>
                        </th>
                        <th id="TGFth" class="totalRow" style="display:{!if($Profile.Name != 'LFA',if(blnShowTGF == true,'','none'),'none')};">
                            <apex:outputText value="USD {0, number,###,###,##0}" rendered="{!if(CurrentCost != 0,true,false)}">
                                <apex:param value="{!CurrentCost}"/>
                            </apex:outputText>
                        </th>-->
                        
                        <!--<th id="CTth" class="totalRow" style="display:{!if($Profile.Name != 'LFA',if(blnShowCTPlanned == true,'','none'),'none')};">
                            <apex:outputText value="{!TGFProposedLOE}" rendered="{!if(TGFProposedLOE != 0,true,false)}"></apex:outputText>
                        </th>
                        <th id="CTth" class="totalRow" style="display:{!if($Profile.Name != 'LFA',if(blnShowCTPlanned == true,'','none'),'none')};">
                            <apex:outputText value="USD {0, number,###,###,##0}" rendered="{!if(TGFProposedCost != 0,true,false)}">
                                <apex:param value="{!TGFProposedCost}"/>
                            </apex:outputText>
                        </th>-->
                        
                    </tr>
                </tfoot>
            </table>
            </td>
          
            
            <td valign="top">
                <div id="RiskCollepsed" class="box_rotate box_TGF" style="display:{!if($Profile.Name != 'LFA',if(blnShowRisk != true,'','none'),'none')};">
                    <apex:image styleClass="Image" url="{!$Resource.Collepse}" onclick="ColumnExpandCollepse('Risktd','Riskth','RiskExpand','RiskCollepsed','{!$Component.hdnblnShowRisk}','true');" title="Expand"/>
                   Risks
                   <br/>
                </div>
                <div id="StatusCollepsed" class="box_rotate box_TGF" style="display:{!if($Profile.Name != 'LFA',if(blnShowStatus != true,'','none'),'none')};">
                    <apex:image styleClass="Image" url="{!$Resource.Collepse}" onclick="ColumnExpandCollepse('Statustd','Statusth','StatusExpand','StatusCollepsed','{!$Component.hdnblnShowStatus}','true');" title="Expand"/>
                   Service Status
                   <br/>
                </div>
                <div id="LFACollepsed" class="box_rotate box_TGF" style="display:{!if($Profile.Name != 'LFA',if(blnShowLFAprop != true,'','none'),'none')};">
                    <apex:image styleClass="Image" url="{!$Resource.Collepse}" onclick="ColumnExpandCollepse('LFAtd','LFAth','LFAExpand','LFACollepsed','{!$Component.hdnblnShowLFA}','true');" title="Expand"/>
                   Budgeted
                   <br/>
                </div>
                <div id="POCollepsed" class="box_rotate box_TGF" style="display:{!if($Profile.Name != 'LFA',if(blnShowPOLFAprop != true,'','none'),'none')};">
                    <apex:image styleClass="Image" url="{!$Resource.Collepse}" onclick="ColumnExpandCollepse('POtd','POth','POExpand','POCollepsed','{!$Component.hdnblnShowPOTGF}','true');" title="Expand"/>
                   Approved
                   <br/>
                </div>
                <div id="TGFCollepsed" class="box_rotate box_TGF" style="display:{!if($Profile.Name != 'LFA',if(blnShowTGF != true,'','none'),'none')};">
                    <apex:image styleClass="Image" url="{!$Resource.Collepse}" onclick="ColumnExpandCollepse('TGFtd','TGFth','TGFExpand','TGFCollepsed','{!$Component.hdnblnShowTGF}','true');" title="Expand"/>
                   Actual
                </div>
                
            </td>
            <!-- PO -->
            
           <!-- <td valign="top">
                <div id="POCollepsed" class="box_rotate box_TGF" style="display:{!if($Profile.Name != 'LFA',if(blnShowPOLFAprop != true,'','none'),'none')};">
                    <apex:image styleClass="Image" url="{!$Resource.Collepse}" onclick="ColumnExpandCollepse('POtd','POth','POExpand','POCollepsed','{!$Component.hdnblnShowPOTGF}','true');" title="Expand"/>
                   Approved
                </div>
            </td> -->
            <!-- Actual -->
            <!-- <td valign="top">
                <div id="LFACollepsed" class="box_rotate box_TGF" style="display:{!if($Profile.Name != 'LFA',if(blnShowLFAprop != true,'','none'),'none')};">
                    <apex:image styleClass="Image" url="{!$Resource.Collepse}" onclick="ColumnExpandCollepse('LFAtd','LFAth','LFAExpand','LFACollepsed','{!$Component.hdnblnShowLFA}','true');" title="Expand"/>
                   Actual
                </div>
            </td> -->
            
            </tr>
            </table>
        </apex:pageBlock>
        
<!-----POP-UP------>
        <apex:outputPanel id="tstpopup">
            <apex:outputPanel id="popupBackground" styleClass="popupBackground" rendered="{!blnHasChild}"/>
            <apex:outputPanel id="custPopup" styleClass="custPopup"  rendered="{!blnHasChild}">            

                <table cellspacing="0" cellpadding="0" border="0" width="100%">
                    <tr>
                        <td width="50%" class="resourcetTable">
                            <apex:pageBlock id="pBlock" title="{!if(strSelectedstatus == 'Completed','Review and Submit','Add/Edit Resources')}" helpTitle="{!if($Profile.Name=='LFA Portal User','','Benchmarking')}" helpurl="if($Profile.Name=='LFA Portal User','','/apex/ServiceBenchmarking?id='lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Id)}">
                                <apex:actionFunction name="actSaveAndReturnResource" action="{!SaveAndReturnResource}" status="Processing"  reRender="frm"/>    
                                <apex:actionFunction name="actCancelServiceAddition" action="{!CancelServiceAddition}" status="Processing"  reRender="frm"/>    
                                <apex:actionFunction action="{!DeleteResource}" name="callDeleteResource"  reRender="Panel" status="Processing" >
                                    <apex:param name="DeleteResourceIndex" value="" id="DeleteResourceIndex"/>
                                </apex:actionFunction>
                                <apex:actionFunction name="actSaveAndReturnResource" action="{!SaveAndReturnResource}" status="Processing"  reRender="frm"/>    
                                
                                <apex:actionFunction name="actCompletedAction" status="Processing" reRender="pBlock" oncomplete="setStatusToCompleted();"/>
                                <apex:actionFunction name="actCancelledAction" status="Processing" reRender="tstpopup"/>
                                <apex:pageBlockButtons id="pbButton" location="bottom">
                                    <apex:commandButton value="Back" action="{!CancelResources}" status="Processing"  reRender="frm" rendered="{!!blnShowAddResourceLink}" />                                    
                                     <apex:commandButton id="btnsaveretuen" value="Save and Return" onclick="return SaveReturPage();" style="display:{!if(blnShowAddResourceLink == true || strSelectedstatus == 'Completed' || strSelectedstatus == 'Cancelled' || strSelectedstatus == 'Not Started' || strSelectedstatus == 'Ongoing','','none')}" rendered="{!if($Profile.Name == 'Finance Officer' ||  $Profile.Name == 'M&E Officer' || $Profile.Name == 'PSM Officer' || $Profile.Name == 'Legal Officer',false,true)}"/>
                                    <!--<apex:commandButton value="Save and Return" onclick="return validateActualLOE();" rendered="{!if(blnShowAddResourceLink == true || strSelectedstatus == 'Completed',true,false)}"/>-->
                                    <apex:commandButton onclick="return ConfirmServiceDeletion();" value="Cancel Service Addition"  rendered="{!blnShowAddResourceLink}" /> <!-- rendered="{!if((lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Completed' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Service Addition') && isServicePending  == true && $Profile.Name=='LFA Portal User',false,true)}"/>-->
                                    <!--<apex:commandButton id="btnSubmitChangeRequest"  value="Change Request" action="{!LFAServiceCompletionApprovalsProcess}" rendered="{!if(lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Completed' ,true,false)}" status="Processing"  reRender="frm"/>-->
                                </apex:pageBlockButtons>
                                <!--<script>
                                    setfocus();
                                    document.getElementById("txtComments").focus();
                                </script>-->
                                <div>
                                <apex:pageBlockSection id="pbsec">
                                    <apex:pageBlockSectionItem >
                                        <apex:outputLabel value="Service Type:"></apex:outputLabel>
                                        <apex:outputPanel >                                           
                                            <table>
                                                <tr>
                                                  <td>  
                                                    <apex:outputField value="{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Service_Sub_Type__c}"/>
                                                  </td>
                                                </tr>
                                                <tr>
                                                    <td>
                                                        <apex:outputText id="txtOtherSubCatagory" value="{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Other_Sub_Category__c}" style="display:{!if(lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Service_Sub_Type__c == 'Other LFA Services' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Service_Sub_Type__c == 'Other procurement related services','','none')}"/>
                                                    </td>
                                                </tr>
                                            </table>
                                        </apex:outputPanel>
                                    </apex:pageBlockSectionItem>
                                    <apex:pageBlockSectionItem >
                                        <apex:outputLabel value="Grant:"></apex:outputLabel>                                       
                                        <apex:outputText value="{!if(isnull(lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Grant__r.Name),'Multiple Grants',lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Grant__r.Name)}"/>
                                    </apex:pageBlockSectionItem>
                                    <apex:pageBlockSectionItem >
                                        <apex:outputLabel value="Country:"></apex:outputLabel>
                                        <apex:outputText value="{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.LFA_Work_Plan__r.Country__r.Name}"/>
                                    </apex:pageBlockSectionItem>
                                    <apex:pageBlockSectionItem >
                                        <apex:outputLabel value="Grant Status:" rendered="{!if(isnull(lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Grant__r.Name),false,true)}"></apex:outputLabel>
                                        <apex:outputText value="{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Grant__r.Grant_Status__c}"/>
                                    </apex:pageBlockSectionItem>
                                    <apex:pageBlockSectionItem id="SecItem" >
                                        <apex:outputLabel value="Service Status:"/>
                                      
                                        <apex:outputPanel >
                                            <table>
                                                <tr>
                                               
                                                    <td>
                                                        <apex:SelectList id="statusEditable" value="{!strSelectedstatus}" rendered="{!if($Profile.Name == 'Finance Officer' ||  $Profile.Name == 'M&E Officer' || $Profile.Name == 'PSM Officer' || $Profile.Name == 'Legal Officer',false,true)}" style="display:{!if(strSelectedstatus != 'Completed','','none')}" size="1" onchange="return statusChange();">
                                                            <apex:selectOptions value="{!SelectstatusOptions}"></apex:selectOptions>  
                                                        </apex:SelectList>
                                                        <apex:outputText id="optSelectedstatus" value="{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c}" style="display:{!if(strSelectedstatus == 'Completed' || $Profile.Name == 'Finance Officer' ||  $Profile.Name == 'M&E Officer' || $Profile.Name == 'PSM Officer' || $Profile.Name == 'Legal Officer','','none')}"/>                         
                                                    </td>
                                                </tr>
                                                
                                            </table>
                                        </apex:outputPanel>
                                     
                                    </apex:pageBlockSectionItem> 
                                   <apex:pageBlockSectionItem >
                                   </apex:pageBlockSectionItem>
                                        
                                   <apex:pageBlockSectionItem id="SecItem2">
                                       <apex:outputLabel id="optrationalLabel" value="Rationale for Cancellation:" style="display:{!if(strSelectedstatus  == 'Cancelled' && blnShowAddResourceLink != true,'','none')}"/>
                                  
                                   <apex:outputPanel >
                                            <table>
                                                <tr>
                                                   <td>
                                                   <div class="requiredInput"><div class="requiredBlock"></div>
                                                        <apex:inputField id="inServiceCancelRat" value="{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.service_cancellation_rationale__c}" style="display:{!if(strSelectedstatus  == 'Cancelled' && blnShowAddResourceLink != true,'','none')};resize:none;height: 75px;width: 325px;" onchange="isAddEditResourcesUpdated = 'True';" rendered="{!if((strSelectedstatus  == 'Cancelled' && ($Profile.Name == 'Finance Officer' ||  $Profile.Name == 'M&E Officer' || $Profile.Name == 'PSM Officer' || $Profile.Name == 'Legal Officer')),false,true)}"/> 
                                                        
                                                   </div>
                                                   <apex:outputField id="outServiceCancelRat" value="{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.service_cancellation_rationale__c}" style="display:{!if(lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Cancelled' && blnShowAddResourceLink != true,'','none')};resize:none;height: 75px;width: 325px;" rendered="{!if((strSelectedstatus  == 'Cancelled' && ($Profile.Name == 'Finance Officer' ||  $Profile.Name == 'M&E Officer' || $Profile.Name == 'PSM Officer' || $Profile.Name == 'Legal Officer')) || (isApprover == true && isServicePendingforApprove == true),true,false)}"/>
                                                   <!-- rendered="{!if(isApprover == true && isServicePendingforApprove == true,true,false)}" -->
                                                   </td>
                                                </tr>
                                            </table>
                                        </apex:outputPanel>
                                   </apex:pageBlockSectionItem>
                                     <!-- <apex:pageBlockSectionItem id="SecItem2" rendered="{!if(lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Completed',true,false)}">
                                        <apex:outputLabel value="Service Status :"/>

                                        <apex:outputText value="{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c}" />                                       
                                    </apex:pageBlockSectionItem>    -->                                                                                         
                                </apex:pageBlockSection>
                                <p></p>
                              <table align="center" style="padding-bottom:10px">                               
                                    <tr > <!-- style="display:{!if(lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Grant__c != NULL,'','none')}"> -->
                                      <td align="right">
                                         <apex:outputLabel value="Programmatic Period Covered:" style="font-weight:bold;font-color:grey;padding-right:5px;"></apex:outputLabel>
                                      </td>
                                      <td>
                                         <apex:outputfield value="{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Period_Start__c} " rendered="{!if(blnShowAddResourceLink == false && ($Profile.Name == 'Finance Officer' ||  $Profile.Name == 'M&E Officer' || $Profile.Name == 'PSM Officer' || $Profile.Name == 'Legal Officer'),true,false)}"/>
                                         <apex:inputfield id="PeriodStartMonth" value="{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Period_Start__c}" rendered="{!if((blnShowAddResourceLink == false || strSelectedstatus != 'Completed') && ($Profile.Name == 'Finance Officer' ||  $Profile.Name == 'M&E Officer' || $Profile.Name == 'PSM Officer' || $Profile.Name == 'Legal Officer'),false,true)}"/>
                                     </td>
                                     <td>
                                         <apex:outputfield value="{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Period_Start_Year__c} " rendered="{!if(blnShowAddResourceLink == false && ($Profile.Name == 'Finance Officer' ||  $Profile.Name == 'M&E Officer' || $Profile.Name == 'PSM Officer' || $Profile.Name == 'Legal Officer'),true,false)}"/>
                                         <!-- rendered="{!if(blnShowAddResourceLink == false && strSelectedstatus != 'Completed',true,false)}" -->
                                         <apex:inputfield id="PeriodStartYear" value="{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Period_Start_Year__c}" rendered="{!if((blnShowAddResourceLink == false || strSelectedstatus != 'Completed') && ($Profile.Name == 'Finance Officer' ||  $Profile.Name == 'M&E Officer' || $Profile.Name == 'PSM Officer' || $Profile.Name == 'Legal Officer'),false,true)}"/>
                                         <!-- rendered="{!if(blnShowAddResourceLink == true || strSelectedstatus == 'Completed',true,false)}" -->
                                     </td>
                                      <td>                                      
                                         <apex:outputLabel value="to"></apex:outputLabel>
                                      </td>
                                      <td>
                                         <apex:outputfield value="{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Period_End__c} " rendered="{!if(blnShowAddResourceLink == false && ($Profile.Name == 'Finance Officer' ||  $Profile.Name == 'M&E Officer' || $Profile.Name == 'PSM Officer' || $Profile.Name == 'Legal Officer'),true,false)}"/>
                                         <!-- rendered="{!if(blnShowAddResourceLink == false && strSelectedstatus != 'Completed',true,false)}" -->
                                         <apex:inputfield id="PeriodEndMonth" value="{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Period_End__c}" rendered="{!if((blnShowAddResourceLink == false || strSelectedstatus != 'Completed') && ($Profile.Name == 'Finance Officer' ||  $Profile.Name == 'M&E Officer' || $Profile.Name == 'PSM Officer' || $Profile.Name == 'Legal Officer'),false,true)}"/>
                                         <!-- rendered="{!if(blnShowAddResourceLink == true || strSelectedstatus == 'Completed',true,false)}" -->
                                     </td>
                                     <td>
                                         <apex:outputfield value="{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Period_End_Year__c} " rendered="{!if(blnShowAddResourceLink == false && ($Profile.Name == 'Finance Officer' ||  $Profile.Name == 'M&E Officer' || $Profile.Name == 'PSM Officer' || $Profile.Name == 'Legal Officer'),true,false)}"/>
                                         <!-- rendered="{!if(blnShowAddResourceLink == false && strSelectedstatus != 'Completed',true,false)}" -->
                                         <apex:inputfield id="PeriodEndYear" value="{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Period_End_Year__c}" rendered="{!if((blnShowAddResourceLink == false || strSelectedstatus != 'Completed') && ($Profile.Name == 'Finance Officer' ||  $Profile.Name == 'M&E Officer' || $Profile.Name == 'PSM Officer' || $Profile.Name == 'Legal Officer'),false,true)}"/>
                                         <!-- rendered="{!if(blnShowAddResourceLink == true || strSelectedstatus == 'Completed',true,false)}" -->
                                     </td>
                                    </tr>                               
                                    <tr>
                                      <td align="right">                  
                                        <apex:outputLabel value="Forecasted Service Delivery Period:" style="font-weight:bold;padding-right:5px;"></apex:outputLabel>
                                      </td>
                                      <td align="center" colspan="2">
                                         <apex:outputfield value="{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Forecasted_Start_Date__c}" rendered="{!if(blnShowAddResourceLink == false && ($Profile.Name == 'Finance Officer' ||  $Profile.Name == 'M&E Officer' || $Profile.Name == 'PSM Officer' || $Profile.Name == 'Legal Officer'),true,false)}"/>
                                         <!-- rendered="{!if(blnShowAddResourceLink == false && strSelectedstatus != 'Completed',true,false)}" -->
                                         <apex:inputfield id="ForcastedStartDate" value="{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Forecasted_Start_Date__c}" rendered="{!if((blnShowAddResourceLink == false || strSelectedstatus != 'Completed') && ($Profile.Name == 'Finance Officer' ||  $Profile.Name == 'M&E Officer' || $Profile.Name == 'PSM Officer' || $Profile.Name == 'Legal Officer'),false,true)}"/>
                                         <!-- rendered="{!if(blnShowAddResourceLink == true || strSelectedstatus == 'Completed',true,false)}" -->
                                      </td>
                                      <td>
                                         <apex:outputLabel value="to"></apex:outputLabel>
                                      </td>
                                      <td align="center" colspan="2">
                                          <apex:outputfield value="{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Forecasted_End_Date__c}" rendered="{!if(blnShowAddResourceLink == false && ($Profile.Name == 'Finance Officer' ||  $Profile.Name == 'M&E Officer' || $Profile.Name == 'PSM Officer' || $Profile.Name == 'Legal Officer'),true,false)}"/>
                                          <!-- rendered="{!if(blnShowAddResourceLink == false && strSelectedstatus != 'Completed',true,false)}" -->
                                          <apex:inputfield id="ForcastedEndDate" value="{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Forecasted_End_Date__c}" rendered="{!if((blnShowAddResourceLink == false || strSelectedstatus != 'Completed') && ($Profile.Name == 'Finance Officer' ||  $Profile.Name == 'M&E Officer' || $Profile.Name == 'PSM Officer' || $Profile.Name == 'Legal Officer'),false,true)}"/>
                                          <!-- rendered="{!if(blnShowAddResourceLink == true || strSelectedstatus == 'Completed',true,false)}" -->
                                      </td>
                                   </tr>
                                   <tr>
                                        <td align="right" valign="top">                  
                                            <apex:outputLabel value="Service Details:" style="font-weight:bold;padding-right:5px;"></apex:outputLabel>
                                        </td>
                                        <td colspan="5">
                                            <div style="word-wrap: break-word;width:250px;">
                                                <apex:outputfield id="txtComments1" style="resize:none; height: 75px;width: 325px;" value="{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Comments__c}" rendered="{!if(blnShowAddResourceLink == false && ($Profile.Name == 'Finance Officer' ||  $Profile.Name == 'M&E Officer' || $Profile.Name == 'PSM Officer' || $Profile.Name == 'Legal Officer'),true,false)}"/>
                                                <!-- rendered="{!if(blnShowAddResourceLink == false && strSelectedstatus != 'Completed',true,false)}" -->
                                                <apex:inputfield id="txtComments"  style="resize:none; height: 75px;width: 325px;" value="{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Comments__c}" rendered="{!if((blnShowAddResourceLink == false || strSelectedstatus != 'Completed') && ($Profile.Name == 'Finance Officer' ||  $Profile.Name == 'M&E Officer' || $Profile.Name == 'PSM Officer' || $Profile.Name == 'Legal Officer'),false,true)}"/>
                                                <!-- rendered="{!if(blnShowAddResourceLink == true || strSelectedstatus == 'Completed',true,false)}" -->
                                            </div>
                                        </td>
                                    </tr>
                               </table>
                                <p></p>                             
                                <apex:outputPanel rendered="{!if(lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Grant__c != NULL,true,false)}">
                                    <table cellpadding="5px" cellspacing="0" align="center">
                                        <tr >
                                           <td><b>Risks</b></td>
                                           <td style="border: 1px solid grey;background-color:{!if(lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Grant__r.Financial_and_Fiduciary_Risks__c == 'High','red',if(lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Grant__r.Financial_and_Fiduciary_Risks__c == 'Medium','yellow',if(lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Grant__r.Financial_and_Fiduciary_Risks__c == 'Low','lightgreen','')))}"><apex:outputtext value="Financial & Fiduciary"/></td>
                                           <td style="border: 1px solid grey;background-color:{!if(lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Grant__r.Programmatic_and_Performance_Risks__c == 'High','red',if(lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Grant__r.Programmatic_and_Performance_Risks__c == 'Medium','yellow',if(lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Grant__r.Programmatic_and_Performance_Risks__c == 'Low','lightgreen','')))}"><apex:outputtext value="Programmatic & Performance"/></td>
                                           <td style="border: 1px solid grey;background-color:{!if(lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Grant__r.Health_Services_and_Products_Risks__c == 'High','red',if(lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Grant__r.Health_Services_and_Products_Risks__c == 'Medium','yellow',if(lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Grant__r.Health_Services_and_Products_Risks__c == 'Low','lightgreen','')))}"><apex:outputtext value="Health Services & Products"/></td>
                                        </tr>
                                    </table>    
                                </apex:outputPanel>
                                </div>
                                <br/>
                                <div align="center">
                                <apex:commandButton id="btnSubmitChangeRequest" value="Submit Change Request" onclick="return EditResourceNewPopup();" title="Refresh" rendered="{!if((lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Not Started' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Ongoing' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'LFA Change Request' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'TGF Counter-Proposal' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'LFA Counter-Proposal' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Service Addition') && ($Profile.Name == 'LFA Portal User' || $Profile.Name == 'Country Team') && blnShowAddResourceLink == false && strSelectedstatus != 'Completed' && strSelectedstatus != 'Cancelled',true,false)}" style="background:{!if(isServicePending == true,'gray','')};"/>
                                <!-- <apex:image value="{!$Resource.RefreshButton}" onclick="return EditResourceNewPopup();" title="Refresh" rendered="{!if(lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Not Started' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Ongoing' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'LFA Change Request' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'TGF Counter-Proposal' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'LFA Counter-Proposal',true,false)}"/>-->
                                </div><br/>
                                
        <!---RESOURCES TABLE IN POP-UP--->
                                <apex:outputPanel id="Panel">
                                   
                                    <apex:variable id="variable" var="CountResource" value="{!0}"/>
                                    <apex:pageBlockTable width="100%" id="pbtable" headerClass="headerColor" value="{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].lstwrapResource}" var="Resource">
                                        <apex:column width="2%">
                                            <apex:image style="cursor:pointer;float:left;" value="{!$Resource.DeleteImage}" height="20" width="25" title="Delete" onclick="DeleteResource('{!CountResource}');" rendered="{!blnShowAddResourceLink}" />
                                            <apex:facet name="footer">
                                                <apex:commandLink id="AddlinkOldpopup" value="Add" reRender="Panel" status="Processing" action="{!AddResource}" 
                                                    style="display:{!if(strSelectedstatus == 'Completed' || blnShowAddResourceLink == true,'','none')};"
                                                    rendered="{!if((strSelectedstatus == 'Completed' && ($Profile.Name == 'Finance Officer' ||  $Profile.Name == 'M&E Officer' || $Profile.Name == 'PSM Officer' || $Profile.Name == 'Legal Officer')),false,true)}" >
                                                    <apex:param value="{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.id}" name="newServiceId" id="newServoceId"/>
                                                </apex:commandLink>
                                            </apex:facet> 
                                        </apex:column>
                                        <apex:column width="15%" headerValue="Role">                                            
                                            <apex:SelectList id="Rolelist" style="width:160px;display:{!if(Resource.objResource.Id == null,'','none')}" value="{!Resource.objResource.LFA_Role__c}" 
                                                onchange="AddEditFillContact('{!CountResource}');" size="1" >
                                                <apex:selectOptions value="{!RoleOptions}"></apex:selectOptions>                                            
                                            </apex:SelectList>
                                            <apex:outputText value="{!Resource.objResource.LFA_Role__r.Name}" style="display:{!if(Resource.objResource.Id != null,'','none')}"/>
                                            <apex:outputtext value="{!Resource.objResource.LFA_Role__c}" id="hdnRoleId" style="display:none;"/>

                                        </apex:column>
                                        <apex:column width="15%" headerValue="Person">
                                            <apex:outputText value="{!Resource.ContactName}" style="display:{!if(Resource.ContactName != null && Resource.objResource.Id != null,'','none')};" />
                                            <!-- rendered="{!if(Resource.objResource.Id != null,true,false)};" -->
                                            <!-- rendered="{!!isnull(Resource.objResource.Contact__r.Name)}" -->
                                            <apex:SelectList id="ContactList" style="width:160px;display:{!if(Resource.objResource.Id == null,'','none')};" value="{!Resource.ContactID}" onchange="FillRateAddEdit('{!CountResource}');" size="1" >
                                                <apex:selectOptions value="{!Resource.ContactOptions}"></apex:selectOptions>
                                            </apex:SelectList>
                                            <apex:outputtext value="{!Resource.ContactID}" id="hdnContactId" style="display:none;" />
                                        </apex:column>
                                        <apex:column width="10%" headerValue="Rate">
                                            <apex:outputField id="optRate" value="{!Resource.objResource.Rate__c}" rendered="{!if((Resource.ContactName == 'TBD' && Resource.RoleName == 'Other Professional')==true,'false','true')}" />
                                            <apex:inputField id="inpRate" style="width:50px;" value="{!Resource.objResource.Rate__c}" rendered="{!if((Resource.ContactName == 'TBD' && Resource.RoleName == 'Other Professional')==true,'true','false')}" onchange="Calculation();"/>                                           
                                            <apex:variable id="variable" var="CountResource" value="{!CountResource+1}"/> 
                                            
                                            <apex:facet name="footer">
                                                <apex:outputText value="Total"/>
                                            </apex:facet>
                                            
                                        </apex:column>
                                        <apex:column width="9%" rendered="{!if((blnShowAddResourceLink == true || strSelectedstatus == 'Cancelled') || (($Profile.Name == 'Finance Officer' ||  $Profile.Name == 'M&E Officer' || $Profile.Name == 'PSM Officer' || $Profile.Name == 'Legal Officer') && (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Ongoing' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Not Started' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Service Addition' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Service Addition In-Process')),false,true)}">
                                        <!-- rendered="{!if(blnShowAddResourceLink == true || strSelectedstatus == 'Cancelled',false,true)}" -->
                                        <!-- rendered="{!if(blnShowAddResourceLink == true,false,true)}"-->
                                            <apex:facet name="header">Actual LOE</apex:facet>
                                        <!-- rendered="{!if(blnShowAddResourceLink == true,false,true)}" style="display:{!if(blnShowAddResourceLink == false,'','none')}"-->
                                            <apex:inputField id="txtLOE" value="{!Resource.objResource.actual_LOE__c}" onchange="validateLOEForTBD(this,'{!$Component.InfoImageBlue}','{!$Component.ContactList}');"  style="width:50px;" rendered="{!if($Profile.Name == 'LFA Portal User' && (blnShowAddResourceLink == true || strSelectedstatus == 'Completed' || strSelectedstatus == 'Not Started' || strSelectedstatus == 'Ongoing' ),true,false)}"/>
                                            <!-- rendered="{!if($Profile.Name == 'LFA Portal User' && (blnShowAddResourceLink == true || strSelectedstatus == 'Completed' || strSelectedstatus == 'Not Started' || strSelectedstatus == 'Ongoing' ),true,false)}" -->
                                            <!-- rendered="{!if((lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Ongoing' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Completed') && ($Profile.Name == 'LFA Portal User') ,true,false)}" -->
                                            <!-- (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Completed' && $Profile.Name != 'LFA Portal User') || ( -->
                                            <!--<apex:outputField id="optxtLOE" value="{!Resource.objResource.actual_LOE__c}" style="width:50px;" rendered="{!if((lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Service Addition' && $Profile.Name == 'LFA Portal User') ,true,false)}"/>-->
                                            
                                            <!-- (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Completed' && $Profile.Name != 'LFA Portal User') ||  -->
                                            <apex:outputText id="optxtLOE" value="{!Resource.objResource.actual_LOE__c}" style="width:50px;" rendered="{!if(($Profile.Name == 'LFA Portal User' && (blnShowAddResourceLink == true && strSelectedstatus != 'Completed' && strSelectedstatus != 'Not Started' && strSelectedstatus != 'Ongoing')) || (($Profile.Name == 'Finance Officer' ||  $Profile.Name == 'M&E Officer' || $Profile.Name == 'PSM Officer' || $Profile.Name == 'Legal Officer') && (strSelectedstatus == 'Completed' || strSelectedstatus == 'TGF Agreed' || strSelectedstatus == 'Payment Approved' || strSelectedstatus == 'Ready to Invoice')) || strSelectedstatus == 'TGF Agreed' || strSelectedstatus == 'Invoiced' || strSelectedstatus == 'Ready to Invoice' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Invoiced',true,false)}"/>
                                            <!-- rendered="{!if(($Profile.Name == 'LFA Portal User' && (blnShowAddResourceLink == true && strSelectedstatus != 'Completed' && strSelectedstatus != 'Not Started' && strSelectedstatus != 'Ongoing')) || strSelectedstatus == 'TGF Agreed' || strSelectedstatus == 'Invoiced' || strSelectedstatus == 'Ready to Invoice' || strSelectedstatus == 'Payment Approved' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Invoiced',true,false)}" -->
                                            <!-- (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Completed' && $Profile.Name != 'LFA Portal User') || ( -->
                                            <apex:facet name="footer">
                                                <apex:outputLabel id="txtTotalLOE" value="" />
                                            </apex:facet>                                            
                                        </apex:column>                                                                                
                                        <apex:column width="9%" rendered="{!if((blnShowAddResourceLink == true || strSelectedstatus == 'Cancelled') || (($Profile.Name == 'Finance Officer' ||  $Profile.Name == 'M&E Officer' || $Profile.Name == 'PSM Officer' || $Profile.Name == 'Legal Officer') && (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Ongoing' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Not Started' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Service Addition' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Service Addition In-Process')),false,true)}">
                                        <!-- rendered="{!if(blnShowAddResourceLink == true || strSelectedstatus == 'Cancelled',false,true)}" -->
                                        <!-- rendered="{!if(blnShowAddResourceLink == true,false,true)}" -->
                                            <apex:facet name="header">Actual Cost</apex:facet>
                                        <!-- rendered="{!if(Resource.objResource.Id != null,true,false)}" -->
                                         <!--<apex:outputLabel id="inpCost" value="{!Resource.objResource.actual_Cost__c}" ></apex:outputLabel>-->
                                            <apex:outputText id="inpCost" value="{!Resource.objResource.actual_Cost__c}"></apex:outputText>
                                            <apex:facet name="footer">                                               
                                                <apex:outputLabel id="txtTotalCost" value="" />
                                            </apex:facet>   
                                                                        
                                        </apex:column>
                                        
                                        <apex:column width="10%" headerValue="Budgeted LOE" rendered="{!if((blnShowAddResourceLink == true && $Profile.Name != 'LFA Portal User') || ($Profile.Name == 'LFA Portal User' && (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Ongoing' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Not Started')) || (($Profile.Name == 'Finance Officer' ||  $Profile.Name == 'M&E Officer' || $Profile.Name == 'PSM Officer' || $Profile.Name == 'Legal Officer') && (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Ongoing' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Not Started' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Service Addition' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Service Addition In-Process')),true,false)}"> 
                                        <!-- rendered="{!if((blnShowAddResourceLink == true && $Profile.Name != 'LFA Portal User') || ($Profile.Name == 'LFA Portal User' && (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Ongoing' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Not Started')),true,false)}"  -->
                                            <apex:facet name="header">Budgeted LOE</apex:facet>
                                            <apex:inputField id="opBLOE" value="{!Resource.objResource.LOE__c}" onchange="Calculation();" rendered="{!if($Profile.Name == 'LFA Portal User' || (($Profile.Name == 'Finance Officer' ||  $Profile.Name == 'M&E Officer' || $Profile.Name == 'PSM Officer' || $Profile.Name == 'Legal Officer') && (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Ongoing' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Not Started' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Service Addition' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Service Addition In-Process')),false,true)}"/>
                                            <apex:outputText id="optBLOE" value="{!Resource.objResource.LOE__c}" rendered="{!if($Profile.Name == 'LFA Portal User' || (($Profile.Name == 'Finance Officer' ||  $Profile.Name == 'M&E Officer' || $Profile.Name == 'PSM Officer' || $Profile.Name == 'Legal Officer') && (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Ongoing' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Not Started' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Service Addition' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Service Addition In-Process')),true,false)}"/>
                                            <apex:facet name="footer">                                               
                                                <apex:outputLabel id="txtTotalBLOE" value="" />
                                            </apex:facet>   
                                                                              
                                        </apex:column>
                                        <apex:column width="10%" headerValue="Budgeted Cost" rendered="{!if((blnShowAddResourceLink == true && $Profile.Name != 'LFA Portal User') || ($Profile.Name == 'LFA Portal User' && (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Ongoing' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Not Started')) || (($Profile.Name == 'Finance Officer' ||  $Profile.Name == 'M&E Officer' || $Profile.Name == 'PSM Officer' || $Profile.Name == 'Legal Officer') && (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Ongoing' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Not Started' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Service Addition' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Service Addition In-Process')),true,false)}">
                                        <!-- rendered="{!if((blnShowAddResourceLink == true && $Profile.Name != 'LFA Portal User') || ($Profile.Name == 'LFA Portal User' && (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Ongoing' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Not Started')),true,false)}" -->
                                        <!-- rendered="{!if(blnShowAddResourceLink == true && $Profile.Name != 'LFA Portal User',true,false)}" -->
                                            <apex:facet name="header">Budgeted Cost</apex:facet>
                                            <apex:outputText id="opBCost" value="USD {0, number,###,###,##0}" >
                                                <apex:param value="{!Resource.objResource.Cost__c}"/>
                                            </apex:outputText>
                                            <apex:facet name="footer">                                               
                                                <apex:outputLabel id="txtTotalBCost" value="" />
                                            </apex:facet>   
                                            
                                        </apex:column>
                                        <apex:column width="10%"  rendered="{!if(blnShowAddResourceLink == true && $Profile.Name == 'LFA Portal User',true,false)}">
                                            <apex:facet name="header">LFA Proposed LOE</apex:facet>
                                            <apex:inputField id="inpLPLOE" value="{!Resource.objResource.Proposed_LOE__c}" onchange="Calculation();"/>
                                            <apex:facet name="footer">                                               
                                                <apex:outputLabel id="txtTotalLPL" value="" />
                                            </apex:facet>   
                                                                              
                                        </apex:column>
                                        <apex:column width="10%" rendered="{!if(blnShowAddResourceLink == true && $Profile.Name == 'LFA Portal User',true,false)}">
                                            <apex:facet name="header">LFA Proposed Cost</apex:facet>
                                            <apex:outputText id="inpLPCost" value="{!Resource.objResource.Proposed_Cost__c}"/>
                                            <apex:facet name="footer">                                               
                                                <apex:outputLabel id="txtTotalLPC" value="" />
                                            </apex:facet>   
                                                                               
                                        </apex:column>                               
                                    </apex:pageBlockTable>
                                    <script>
                                    RemoveStatusValues();
                                        function statusChange(){
                                            
                                            var objSelOption = document.getElementById('page:frm:pBlock:pbsec:SecItem:statusEditable');
                                            
                                            if(objSelOption.value=="Cancelled"){
                                                document.getElementById('page:frm:pBlock:pbsec:SecItem2:inServiceCancelRat').style.display='';
                                                document.getElementById('page:frm:pBlock:pbsec:SecItem2:optrationalLabel').style.display='';
                                                document.getElementById('page:frm:pBlock:btnSubmitChangeRequest').style.display='none';
                                                document.getElementById('page:frm:pBlock:pbButton:btnsaveretuen').style.display='';
                                                actCancelledAction();
                                                //document.getElementById(objCancelledTextbox).style.display='';
                                            }/*else{
                                                //document.getElementById(objCancelledTextbox).style.display='none';
                                                document.getElementById('page:frm:pBlock:pbsec:SecItem2:inServiceCancelRat').style.display='none';
                                                document.getElementById('page:frm:pBlock:pbsec:SecItem2:optrationalLabel').style.display='none';
                                                document.getElementById('page:frm:pBlock:btnSubmitChangeRequest').style.display='';
                                                document.getElementById('page:frm:pBlock:pbButton:btnsaveretuen').style.display='none';
                                            }*/
                                            if(objSelOption.value=="Completed"){
                                                if(confirm("You will now be directed to the service completion Review and Submit page.")){
                                                    //objSelOption.value = "Completed";
                                                    //document.getElementById('page:frm:pBlock:pbtable:AddlinkOldpopup').style.display='';
                                                    //document.getElementById('page:frm:pBlock:pbsec:SecItem:optSelectedstatus').innerHTML='Completed';
                                                    //document.getElementById('page:frm:pBlock:pbsec:SecItem:optSelectedstatus').style.display='';
                                                    //objSelOption.style.display='none';
                                                    actCompletedAction();
                                                    
                                                }else{
                                                    objSelOption.value = "Not Started";
                                                }
                                                return false;
                                            }
                                            /*if(confirm('Are you sure you want to change status to completed?')){
                                                document.getElementById('page:frm:pBlock:pbtable:AddlinkOldpopup').style.display='';
                                                document.getElementById('page:frm:pBlock:pbsec:SecItem:outputTextstatus').innerHTML='Completed';
                                                document.getElementById('page:frm:pBlock:pbsec:SecItem:outputTextstatus').style.display='';
                                                document.getElementById('page:frm:pBlock:pbsec:SecItem:statusEditable').style.display='none';
                                                
                                            }*/
                                            
                                        }
                                        function setStatusToCompleted(){
                                            document.getElementById('page:frm:pBlock:pbsec:SecItem:optSelectedstatus').innerHTML='Completed';
                                        }
                                        setFocus();
                                        function setFocus()
                                        {
                                            if(document.getElementById("page:frm:pBlock:txtComments") != null){
                                                document.getElementById("page:frm:pBlock:txtComments").focus();
                                            }
                                        }
                                        function validateActualLOE(){
                                            
                                            var size='{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].lstwrapResource.size}';
                                            var blncheckActual = false;
                                            
                                            for(var i=0;i<size;i++)
                                            {
                                                if(document.getElementById("page:frm:pBlock:pbtable:"+i+":txtLOE") != null && (document.getElementById("page:frm:pBlock:pbtable:"+i+":txtLOE").value != '' || document.getElementById("page:frm:pBlock:pbtable:"+i+":txtLOE").value != 0)){
                                                }else{
                                                    blncheckActual = true;
                                                    //alert(blncheckActual);
                                                }
                                            }
                                            if(blncheckActual == false){
                                                actSaveAndReturnResource();
                                                return false;
                                            }else{
                                                alert('Actual LOE must be entered in order to mark status as completed.');
                                                return false;
                                            }
                                        }
                                        
                                        function ConfirmServiceDeletion(){
                                            if(confirm('Are you sure that you want to cancel service addition and delete this service from the work plan?')){
                                                actCancelServiceAddition();
                                            }
                                            return false;
                                        }
                                        function DeleteResource(DeleteResourceIndex){
                                            if(confirm('Are you sure you want to delete?'))
                                            {
                                                callDeleteResource(DeleteResourceIndex);  
                                            }
                                            return false;
                                        }
                                        function validateActualLOE(ActualLOE,Index){
                                            var Final;
                                            if(ActualLOE != null){
                                                Final = ActualLOE.value;
                                            }
                                            var size='{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].lstwrapResource.size}';
                                            
                                            
                                            var Rate =0;
                                            if(document.getElementById("page:frm:pBlock:pbtable:"+Index+":inpRate") != null)
                                            {
                                                 if(document.getElementById("page:frm:pBlock:pbtable:"+Index+":inpRate").tagName == 'INPUT'){
                                                     Rate = ConvertNum(document.getElementById("page:frm:pBlock:pbtable:"+Index+":inpRate").value);
                                                 }else{
                                                     Rate = ConvertNum(document.getElementById("page:frm:pBlock:pbtable:"+Index+":inpRate").innerHTML);
                                                 }
                                            } 
                                            else if(document.getElementById("page:frm:pBlock:pbtable:"+Index+":optRate") != null)
                                            {    
                                                 Rate = ConvertNum(document.getElementById("page:frm:pBlock:pbtable:"+Index+":optRate").innerHTML);
                                            }
                                            var Cost = Final * Rate;
                                            if(Cost == 0){
                                                document.getElementById("page:frm:pBlock:pbtable:"+Index+":txtActualCost").innerHTML = '';
                                            }else{
                                                document.getElementById("page:frm:pBlock:pbtable:"+Index+":txtActualCost").innerHTML = addCommas(Cost);
                                            }
                                            
                                            var size='{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].lstwrapResource.size}';
                                            var TotalLOE = 0;
                                            var TotalCost =0;
                                            var TotalLFALOE = 0;
                                            var TotalLFACost = 0;
                                            for(var i=0;i<size;i++)
                                            {
                                                var LOE = 0;
                                                
                                                if(document.getElementById("page:frm:pBlock:pbtable:"+i+":txtActualLOE") != null){
                                                    var objTxtLOE = document.getElementById("page:frm:pBlock:pbtable:"+i+":txtActualLOE");
                                                }
                                                
                                                LOE = ConvertNum(objTxtLOE.value);
   
                                                TotalLOE += parseFloat(LOE);  
                                                var Rate =0;
                                                if(document.getElementById("page:frm:pBlock:pbtable:"+i+":inpRate") != null)
                                                {
                                                    if(document.getElementById("page:frm:pBlock:pbtable:"+i+":inpRate").tagName =='INPUT'){
                                                     Rate = ConvertNum(document.getElementById("page:frm:pBlock:pbtable:"+i+":inpRate").value);
                                                     }else{
                                                         Rate = ConvertNum(document.getElementById("page:frm:pBlock:pbtable:"+i+":inpRate").innerHTML);
                                                     }
                                                } 
                                                else if(document.getElementById("page:frm:pBlock:pbtable:"+i+":optRate") != null)
                                                {    
                                                     Rate = ConvertNum(document.getElementById("page:frm:pBlock:pbtable:"+i+":optRate").innerHTML);
                                                }
                                                
                                                var Cost = LOE * Rate;  
                                                TotalCost +=Cost;
                                                
                                                                                                          
                                            }
                                            TotalLOE = TotalLOE.toString();
                                            if(TotalLOE.indexOf(".") == -1) TotalLOE = TotalLOE+".00";
                                            if(TotalLOE == 0) var decTotalLOE = '';
                                            else var decTotalLOE  = parseFloat(TotalLOE).toFixed(2);
                                            //var decTotalLOE  = parseFloat(TotalLOE).toFixed(2);
                                            var decTotalCost = parseFloat(TotalCost).toFixed(0);
                                            if(decTotalLOE != '' && decTotalLOE != 0){
                                                document.getElementById("page:frm:pBlock:pbtable:txtTotalActualLOE").innerHTML = addCommasLOE(decTotalLOE);
                                            }else{
                                                document.getElementById("page:frm:pBlock:pbtable:txtTotalActualLOE").innerHTML = '';
                                            }
                                            if(decTotalCost != '' && decTotalCost != 0){
                                                document.getElementById("page:frm:pBlock:pbtable:txtTotalActualCost").innerHTML = addCommas(decTotalCost);
                                            }else{
                                                document.getElementById("page:frm:pBlock:pbtable:txtTotalActualCost").innerHTML = '';
                                            }
                                            
                                            
                                        }
                                        function formatDate(Date1){
                                            try{
                                                var strDate = '';
                                                var array
                                                if(Date1.lastIndexOf('/')!=-1){                                                
                                                    array = Date1.split('/');
                                                }else if(Date1.lastIndexOf('.')!=-1){                                                
                                                    array = Date1.split('.');
                                                }
                                                var dd = array[0];
                                                var mm = array[1];
                                                if(mm == '01' || mm == '1') mm = 'January';
                                                if(mm == '02' || mm == '2') mm = 'February';
                                                if(mm == '03' || mm == '3') mm = 'March';
                                                if(mm == '04' || mm == '4') mm = 'April';
                                                if(mm == '05' || mm == '5') mm = 'May';
                                                if(mm == '06' || mm == '6') mm = 'June';
                                                if(mm == '07' || mm == '7') mm = 'July';
                                                if(mm == '08' || mm == '8') mm = 'August';
                                                if(mm == '09' || mm == '9') mm = 'September';
                                                if(mm == '10' || mm == '10') mm = 'October';
                                                if(mm == '11' || mm == '11') mm = 'November';
                                                if(mm == '12' || mm == '12') mm = 'December';
                                                
                                                var yyyy = array[2];
                                                //strDate = yyyy + "-" + mm + "-" + dd;
                                                strDate = mm + " " + dd + ", " + yyyy;
                                                
                                                return strDate;
                                            }catch(err){
                                               // alert("Please enter valid date.");
                                                return null;
                                            }            
                                        }
                                        function dateFullMonth(shortMonth){
                                            var FullMonth = '';
                                            if(shortMonth == 'Jan') FullMonth = 'January';
                                            if(shortMonth == 'Feb') FullMonth = 'February';
                                            if(shortMonth == 'Mar') FullMonth = 'March';
                                            if(shortMonth == 'Apr') FullMonth = 'April';
                                            if(shortMonth == 'May') FullMonth = 'May';
                                            if(shortMonth == 'Jun') FullMonth = 'June';
                                            if(shortMonth == 'Jul') FullMonth = 'July';
                                            if(shortMonth == 'Aug') FullMonth = 'August';
                                            if(shortMonth == 'Sep') FullMonth = 'September';
                                            if(shortMonth == 'Oct') FullMonth = 'October';
                                            if(shortMonth == 'Nov') FullMonth = 'November';
                                            if(shortMonth == 'Dec') FullMonth = 'December';
                                            return FullMonth;
                                        }
                                        function SaveReturPage(){
                                            var size='{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].lstwrapResource.size}';
                                            /*if(isAddEditResourcesUpdated == "False"){
                                                alert("You have not made a change. Please click \"Back\" instead.");
                                                return false;
                                            }*/
                                            if(document.getElementById('page:frm:pBlock:PeriodStartMonth') != null)
                                                var txtPeriodStartMonth = document.getElementById('page:frm:pBlock:PeriodStartMonth');
                                            if(document.getElementById('page:frm:pBlock:PeriodStartYear') != null)
                                                var txtPeriodStartYear = document.getElementById('page:frm:pBlock:PeriodStartYear');
                                            if(document.getElementById('page:frm:pBlock:PeriodEndMonth') != null)
                                                var txtPeriodEndMonth = document.getElementById('page:frm:pBlock:PeriodEndMonth');
                                            if(document.getElementById('page:frm:pBlock:PeriodEndYear') != null)
                                                var txtPeriodEndYear = document.getElementById('page:frm:pBlock:PeriodEndYear');
                                            
                                            if(txtPeriodStartMonth != null && txtPeriodStartMonth.value != '' && txtPeriodEndMonth != null && txtPeriodEndMonth.value != '' && txtPeriodStartYear != null && txtPeriodStartYear.value != '' && txtPeriodEndYear != null && txtPeriodEndYear.value != ''){
                                                txtPeriodStartMonth = dateFullMonth(txtPeriodStartMonth.value);
                                                txtPeriodEndMonth = dateFullMonth(txtPeriodEndMonth.value);
                                                var PeriodStartDate =  Date.parse(txtPeriodStartMonth+' 01, '+ txtPeriodStartYear.value);
                                                var PeriodEndDate =  Date.parse(txtPeriodEndMonth+' 01, '+ txtPeriodEndYear.value); 
                                                if(PeriodEndDate < PeriodStartDate){
                                                    alert("Programmatic Period Covered End Date must be greater than Start Date.");
                                                    return false;
                                                }
                                            }
                                            var ForecastedStartDate = '';
                                            if(document.getElementById('page:frm:pBlock:ForcastedStartDate') != null){
                                                var txtForecastedStartDate = document.getElementById('page:frm:pBlock:ForcastedStartDate');
                                                
                                                if(txtForecastedStartDate != null && txtForecastedStartDate.value != ''){
                                                    ForecastedStartDate = formatDate(txtForecastedStartDate.value);
                                                }
                                            }
                                            var ForecastedEndDate = '';
                                            if(document.getElementById('page:frm:pBlock:ForcastedEndDate') != null){
                                                var txtForecastedEndDate = document.getElementById('page:frm:pBlock:ForcastedEndDate');
                                                
                                                if(txtForecastedEndDate.value != ''){
                                                    ForecastedEndDate = formatDate(txtForecastedEndDate.value);
                                                }
                                            }
                                            
                                            var startDate =  Date.parse(ForecastedStartDate);
                                            var EndDate =  Date.parse(ForecastedEndDate);
                                            
                                            if(ForecastedStartDate != "" && ForecastedEndDate != "" && EndDate < startDate){
                                                alert("Forecasted Service Delivery Period End Date must be greater than Start Date.");
                                                return false;
                                            }
                                            if('{!blnShowAddResourceLink}' == 'true'){
                                                var strField;
                                                
                                                if('{!$Profile.Name}' == 'LFA Portal User'){
                                                    strField = document.getElementById('page:frm:pBlock:pbtable:0:inpLPLOE');
                                                }else{
                                                    strField = document.getElementById('page:frm:pBlock:pbtable:0:opBLOE');
                                                }
                                                
                                                if(strField != null && (strField.value == 0 || strField.value == '' )){
                                                    alert('You must add resources and LOE at this time. Otherwise, select cancel service addition.');
                                                    return false;
                                                }else if(strField == null){
                                                    alert('You must add resources and LOE at this time. Otherwise, select cancel service addition.');
                                                    return false;
                                                }
                                                
                                            }
                                            for(var i=0;i<size;i++){
                                                if(document.getElementById('page:frm:pBlock:pbtable:'+i+':Rolelist') != null && document.getElementById('page:frm:pBlock:pbtable:'+i+':Rolelist').value == ''){
                                                    alert('A role must be selected for each resource.');
                                                    return false;
                                                }
                                            }
                                            if(document.getElementById('page:frm:pBlock:pbsec:SecItem:statusEditable').value == 'Completed'){
                                                if(size > 0){
                                                    var size='{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].lstwrapResource.size}';
                                                    var checkvalodate = true;
                                                    var ContactArray = new Array();
                                                    var intArrayIndex = 0;
                                                    
                                                    for(var i=0;i<size;i++){
                                                        
                                                        if(document.getElementById('page:frm:pBlock:pbtable:'+i+':ContactList') != null && document.getElementById('page:frm:pBlock:pbtable:'+i+':Rolelist') != null && document.getElementById('page:frm:pBlock:pbtable:'+i+':ContactList').style.display == '' && document.getElementById('page:frm:pBlock:pbtable:'+i+':Rolelist').style.display == ''){
                                                            if(document.getElementById('page:frm:pBlock:pbtable:'+i+':ContactList').value != 'TBD'){
                                                                ContactArray[intArrayIndex] = document.getElementById('page:frm:pBlock:pbtable:'+i+':ContactList').value +';'+document.getElementById('page:frm:pBlock:pbtable:'+i+':Rolelist').value;
                                                                intArrayIndex++;
                                                            }
                                                        }else if(document.getElementById('page:frm:pBlock:pbtable:'+i+':hdnContactId') != null && document.getElementById('page:frm:pBlock:pbtable:'+i+':hdnRoleId') != null){
                                                            if(document.getElementById('page:frm:pBlock:pbtable:'+i+':hdnContactId').innerHTML != 'TBD' && document.getElementById('page:frm:pBlock:pbtable:'+i+':hdnContactId').innerHTML != ''){
                                                                ContactArray[intArrayIndex] = document.getElementById('page:frm:pBlock:pbtable:'+i+':hdnContactId').innerHTML+';'+document.getElementById('page:frm:pBlock:pbtable:'+i+':hdnRoleId').innerHTML;
                                                                intArrayIndex++;
                                                            }
                                                        }
                                                    }
                                                    /*if(ContactArray.length > 0){
                                                        for(var j=0;j<ContactArray.length;j++){
                                                            for(var k=0;k<ContactArray.length;k++){
                                                                if(j != k && ContactArray[j] == ContactArray[k]){
                                                                   alert('Each contact can only be assigned once to a service.');
                                                                   checkvalodate = false;
                                                                   return false;
                                                                }
                                                            }
                                                        }
                                                    }*/
                                                    var blncheckActual = false;
                                                    for(var i=0;i<size;i++)
                                                    {
                                                        if(document.getElementById("page:frm:pBlock:pbtable:"+i+":txtLOE") != null && (document.getElementById("page:frm:pBlock:pbtable:"+i+":txtLOE").value != '' || document.getElementById("page:frm:pBlock:pbtable:"+i+":txtLOE").value != 0)){
                                                        }else{
                                                            blncheckActual = true;
                                                        }
                                                    }
                                                    if(blncheckActual == false){
                                                        if(confirm('Are you sure you want to submit this service completion  to the Global Fund?')) {
                                                            actSaveAndReturnResource();
                                                        }
                                                        return false;
                                                    }else{
                                                        alert('Actual LOE must be entered in order to mark status as completed.');
                                                        return false;
                                                    }
                                                    /*if(document.getElementById("page:frm:pBlock:pbtable:0:txtLOE") != null){
                                                        if(document.getElementById('page:frm:pBlock:pbtable:txtTotalLOE').innerHTML == '' ){
                                                            //alert("You must enter Actual LOE before changing the status to completed.");
                                                            //return false;
                                                        }
                                                    }*/
                                                }
                                            }
                                            if(document.getElementById('page:frm:pBlock:pbsec:SecItem:statusEditable').value == 'Cancelled'){
                                                if(document.getElementById('page:frm:pBlock:pbsec:SecItem2:inServiceCancelRat').value == "" ){
                                                    alert("Service Cancellation Rationale is Mandatory.");
                                                    return false;
                                                }
                                            }
                                            
                                           
                                            if(document.getElementById('page:frm:pBlock:pbsec:SecItem:statusEditable').value == 'Completed'){
                                                //The service will be locked and you will no longer be able to edit the Actuals.  Are you sure you have captured all Actuals values and want to report this service as complete?
                                                if(confirm("The service will be locked and you will no longer be able to edit the Actuals. Are you sure you have captured all Actuals values and want to report this service as complete? To submit this service for review by the Global Fund, click 'OK'.")) {
                                                    actSaveAndReturnResource();
                                                    return false;
                                                }else{
                                                    return false;
                                                }
                                            }else{
                                                if('{!$Profile.Name}' == 'LFA Portal User' && document.getElementById('page:frm:pBlock:pbsec:SecItem:statusEditable').value == 'Service Addition'){
                                                    if(confirm("Are you sure you wish to submit this new service for approval by the Country Team?")) {
                                                        actSaveAndReturnResource();
                                                    }
                                                    return false;
                                                }else if('{!$Profile.Name}' != 'LFA Portal User'){
                                                    if(confirm("Are you sure you wish to add this service? The LFA will be notified.")) {
                                                        actSaveAndReturnResource();
                                                    }
                                                    return false;
                                                }else{
                                                    actSaveAndReturnResource();
                                                    return false;
                                                }
                                            }
                                           
                                        }
                                        function ConvertNum(textvalue)
                                        {     
                                            //alert("undefined textvalue : "+textvalue)
                                            var ReComma = new RegExp("\\,","g");
                                            var ReQuate = new RegExp("\\'","g");
                                            textvalue= textvalue.replace(ReComma,"");
                                            textvalue= textvalue.replace(ReQuate,"");
                                            textvalue= textvalue.replace(",.",".");
                                            textvalue= textvalue.replace("'.","."); 
                                            textvalue= textvalue.replace("$", "");   
                                            
                                            /*textvalue= textvalue.replace("$", "");
                                            textvalue= textvalue.replace(/,/g, "");
                                            textvalue= textvalue.replace("'/g", "");*/
                                            var num1 = 0;
                                            if(textvalue.indexOf("USD") != -1){
                                                var indexusd = textvalue.indexOf("USD");
                                                var textvalue1 = textvalue.substring(indexusd+4,textvalue.length);
                                                for(i=0;textvalue1.length;i++)
                                                {    
                                                    if(isNaN(textvalue1[i]))
                                                    {    
                                                        break;
                                                    }
                                                    else
                                                    {   
                                                        num1+=textvalue1[i];
                                                    }
                                                }
                                            }else{
                                                num1=textvalue;
                                            }
                                            var num= parseFloat(num1);
                                            num=num.toFixed(2);
                                            if(isNaN(num)){
                                                return 0;
                                            }else{
                                                return num;
                                            }                
                                        }
                                        
                                        function validateLOEForTBD(LOEid,ImageId,contactId){
                                            if(document.getElementById(ImageId) != null && document.getElementById(contactId) != null && document.getElementById(contactId).value == 'TBD'){
                                                if(LOEid.value == 0){
                                                    document.getElementById(ImageId).style.display = 'none';
                                                }else{
                                                    document.getElementById(ImageId).style.display = 'block';
                                                }
                                            }
                                            Calculation();
                                        }
                                        function AutoFillLFALOE(){
                                            var LFALOE = 0;
                                            var LOE = 0;
                                            LOE = ConvertNum(document.getElementById("page:frm:pBlock:pbtable:"+i+":txtLOE").value);
                                            
                                            LFALOE = LOE;
                                            var decLFALOE = LFALOE.toFixed(0);
                                            document.getElementById("page:frm:pBlock:pbtable:txtLFALOE").innerHTML = addCommasLOE(decLFALOE);
                                        }
                                        function Calculation(){   
                                            //alert('Inn');                                         
                                            var size='{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].lstwrapResource.size}';
                                            
                                            var TotalLOE = 0;
                                            var TotalCost =0;
                                            var TotalLFAPLOE = 0;
                                            var TotalLFAPCost = 0;
                                            var TotalLFALOE = 0;
                                            var TotalLFACost = 0;
                                            var TotalPOLOE = 0;
                                            var TotalPOCost = 0;
                                            var TotalPLOE = 0;
                                            var TotalPCost = 0;
                                            
                                            for(var i=0;i<size;i++)
                                            {
                                                var POLOE = 0;  
                                                if(document.getElementById("page:frm:pBlockNew:pbtable:"+i+":txtPOLOE") != null){
                                                    var objTxtPOLOE = document.getElementById("page:frm:pBlock:pbtable:"+i+":opPOLOE");
                                                    
                                                    POLOE = ConvertNum(objTxtPOLOE.innerHTML);
                                                    TotalPOLOE += parseFloat(POLOE); 
                                                }
                                                //alert(1);
                                                var LOE = 0;                                                
                                                if(document.getElementById("page:frm:pBlock:pbtable:"+i+":txtLOE") != null){
                                                    if(isNaN(document.getElementById("page:frm:pBlock:pbtable:"+i+":txtLOE").value)){
                                                        alert('Please enter a valid Actual LOE value.');
                                                        return false;
                                                    }
                                                    LOE = ConvertNum(document.getElementById("page:frm:pBlock:pbtable:"+i+":txtLOE").value);
                                                    
                                                }else if(document.getElementById("page:frm:pBlock:pbtable:"+i+":optxtLOE") != null){
                                                    LOE = ConvertNum(document.getElementById("page:frm:pBlock:pbtable:"+i+":optxtLOE").innerHTML);
                                                   
                                                }
                                                                                            
                                                if(LOE !=null){
                                                    TotalLOE += parseFloat(LOE);  
                                                }else{
                                                    TotalLOE = TotalLOE;
                                                }
                                                //alert(2);
                                                var LFAPLOE = 0;                                                
                                                if(document.getElementById("page:frm:pBlock:pbtable:"+i+":inpLPLOE") != null){
                                                    if(isNaN(document.getElementById("page:frm:pBlock:pbtable:"+i+":inpLPLOE").value)){
                                                        alert('Please enter a valid Proposed LOE value.');
                                                        return false;
                                                    }
                                                    LFAPLOE = ConvertNum(document.getElementById("page:frm:pBlock:pbtable:"+i+":inpLPLOE").value);
                                                }
                                                TotalLFAPLOE += parseFloat(LFAPLOE);
                                                //alert(3);
                                                var PLOE = 0;                                  
                                                if(document.getElementById("page:frm:pBlock:pbtable:"+i+":opBLOE") != null){
                                                    if(isNaN(document.getElementById("page:frm:pBlock:pbtable:"+i+":opBLOE").value)){
                                                        alert('Please enter a valid Budgeted LOE value.');
                                                        return false;
                                                    }
                                                    var PLOE = ConvertNum(document.getElementById("page:frm:pBlock:pbtable:"+i+":opBLOE").value);
                                                }else if(document.getElementById("page:frm:pBlock:pbtable:"+i+":optBLOE") != null){
                                                    var PLOE = ConvertNum(document.getElementById("page:frm:pBlock:pbtable:"+i+":optBLOE").innerHTML);
                                                    
                                                }

                                                TotalPLOE += parseFloat(PLOE); 
                                                //alert(4);
                                                //alert(TotalPLOE);
                                                var Rate = 0;//page:frm:pBlock:pbtable:0:inpRate
                                                if(document.getElementById("page:frm:pBlock:pbtable:"+i+":inpRate") != null)
                                                {
                                                    //alert(" inpRate : "+document.getElementById("page:frm:pBlock:pbtable:"+i+":inpRate").value);
                                                    if(document.getElementById("page:frm:pBlock:pbtable:"+i+":inpRate").tagName == 'INPUT'){
                                                         Rate = ConvertNum(document.getElementById("page:frm:pBlock:pbtable:"+i+":inpRate").value);
                                                     }else{
                                                         Rate = ConvertNum(document.getElementById("page:frm:pBlock:pbtable:"+i+":inpRate").innerHTML);
                                                     }
                                                } 
                                                else if(document.getElementById("page:frm:pBlock:pbtable:"+i+":optRate") != null)
                                                {   
                                                    //alert(" optRate : "+document.getElementById("page:frm:pBlock:pbtable:"+i+":optRate").innerHTML); 
                                                     Rate = ConvertNum(document.getElementById("page:frm:pBlock:pbtable:"+i+":optRate").innerHTML);
                                                }
                                                Rate = parseFloat(Rate).toFixed(2);
                                                
                                                var LFAPCost = LFAPLOE * Rate;  
                                                var iLFACost = parseFloat(LFAPCost).toFixed(0);
                                                TotalLFAPCost = parseFloat(TotalLFAPCost) + parseFloat(iLFACost);
                                                
                                                
                                                //TotalLFAPCost +=LFAPCost;
                                                var decLFAPCost = LFAPCost.toFixed(0);
                                                
                                                var Cost = LOE * Rate;  
                                               
                                                var iCost = parseFloat(Cost).toFixed(0);
                                                TotalCost = parseFloat(TotalCost) + parseFloat(iCost) ;
                                                
                                                var decCost = Cost.toFixed(0);
                                                
                                                var POCost = POLOE * Rate; 
                                                var iPOCost = parseFloat(POCost).toFixed(0);
                                                TotalPOCost = parseFloat(TotalPOCost ) + parseFloat(iPOCost ) ;
                                                
                                                //TotalPOCost += POCost;
                                                var decPOCost = POCost.toFixed(0);
                                                var PCost = PLOE * Rate;
                                                
                                                var iPCost = parseFloat(PCost).toFixed(0);
                                                TotalPCost = parseFloat(TotalPCost ) + parseFloat(iPCost ) ;
                                                 
                                                //TotalPCost += PCost;
                                                var decPCost = PCost.toFixed(0);
                                                //alert(decPCost);

                                                if(document.getElementById("page:frm:pBlock:pbtable:"+i+":inpLPCost") != null){
                                                    if(decLFAPCost == 0){
                                                        document.getElementById("page:frm:pBlock:pbtable:"+i+":inpLPCost").innerHTML = '';
                                                    }else{
                                                        document.getElementById("page:frm:pBlock:pbtable:"+i+":inpLPCost").innerHTML = addCommas(decLFAPCost);
                                                    }
                                                }
                                                if(document.getElementById("page:frm:pBlock:pbtable:"+i+":inpCost1") != null){
                                                    if(decCost == 0){
                                                        document.getElementById("page:frm:pBlock:pbtable:"+i+":inpCost1").innerHTML = '';
                                                    }else{
                                                        document.getElementById("page:frm:pBlock:pbtable:"+i+":inpCost1").innerHTML = addCommas(decCost);
                                                    }
                                                }else if(document.getElementById("page:frm:pBlock:pbtable:"+i+":inpCost") != null){
                                                    if(decCost == 0){
                                                        document.getElementById("page:frm:pBlock:pbtable:"+i+":inpCost").innerHTML = '';
                                                    }else{
                                                        document.getElementById("page:frm:pBlock:pbtable:"+i+":inpCost").innerHTML = addCommas(decCost);
                                                    }
                                                }
                                                 if(document.getElementById("page:frm:pBlock:pbtable:"+i+":opBCost") != null){
                                                    if(decPCost == 0){
                                                        document.getElementById("page:frm:pBlock:pbtable:"+i+":opBCost").innerHTML = '';
                                                    }else{
                                                        document.getElementById("page:frm:pBlock:pbtable:"+i+":opBCost").innerHTML = addCommas(decPCost);
                                                    }
                                                } 
                                                  
                                            }
                                            
                                            TotalLOE = TotalLOE.toString();
                                            if(TotalLOE.indexOf(".") == -1) TotalLOE = TotalLOE+".00";
                                            if(TotalLOE == 0) var decTotalLOE = '';
                                            else var decTotalLOE  = parseFloat(TotalLOE).toFixed(2);
                                            //var decTotalLOE  = parseFloat(TotalLOE).toFixed(2);
                                            var decTotalCost = parseFloat(TotalCost).toFixed(0);
                                            if(document.getElementById("page:frm:pBlock:pbtable:txtTotalLOE") != null){
                                                if(decTotalLOE != '' && decTotalLOE != 0){
                                                    document.getElementById("page:frm:pBlock:pbtable:txtTotalLOE").innerHTML = addCommasLOE(decTotalLOE);
                                                }else{
                                                    document.getElementById("page:frm:pBlock:pbtable:txtTotalLOE").innerHTML = '';
                                                }
                                            }
                                            if(document.getElementById("page:frm:pBlock:pbtable:txtTotalCost") != null){
                                                if(decTotalCost != '' && decTotalCost != 0){
                                                    document.getElementById("page:frm:pBlock:pbtable:txtTotalCost").innerHTML = addCommas(decTotalCost);
                                                }else{
                                                    document.getElementById("page:frm:pBlock:pbtable:txtTotalCost").innerHTML = '';
                                                }
                                            }
                                            
                                            TotalLFAPLOE = TotalLFAPLOE.toString();
                                            if(TotalLFAPLOE.indexOf(".") == -1) TotalLFAPLOE = TotalLFAPLOE+".00";
                                            if(TotalLFAPLOE == 0) var decTotalLFAPLOE = '';
                                            else var decTotalLFAPLOE  = parseFloat(TotalLFAPLOE).toFixed(2);
                                            var decTotalLFAPCost = parseFloat(TotalLFAPCost).toFixed(0);
                                            if(document.getElementById("page:frm:pBlock:pbtable:txtTotalLPL") != null){
                                                if(decTotalLFAPLOE != '' && decTotalLFAPLOE != 0 ){
                                                    document.getElementById("page:frm:pBlock:pbtable:txtTotalLPL").innerHTML = addCommasLOE(decTotalLFAPLOE);
                                                }else{
                                                    document.getElementById("page:frm:pBlock:pbtable:txtTotalLPL").innerHTML = '';
                                                }
                                            }
                                            if(document.getElementById("page:frm:pBlock:pbtable:txtTotalLPC") != null){
                                                if(decTotalLFAPCost != '' && decTotalLFAPCost != 0){
                                                    document.getElementById("page:frm:pBlock:pbtable:txtTotalLPC").innerHTML = addCommas(decTotalLFAPCost);
                                                }else{
                                                    document.getElementById("page:frm:pBlock:pbtable:txtTotalLPC").innerHTML = '';
                                                }
                                            }
                                            
                                            
                                            TotalPLOE = TotalPLOE.toString();
                                            if(TotalPLOE.indexOf(".") == -1) TotalPLOE = TotalPLOE+".00";
                                            if(TotalPLOE == 0) var decTotalLOE = '';
                                            else var decTotalLOE  = parseFloat(TotalPLOE).toFixed(2);
                                            var decTotalPCost = parseFloat(TotalPCost).toFixed(0);
                                            
                                            if(document.getElementById("page:frm:pBlock:pbtable:txtTotalBLOE") != null){
                                                if(decTotalLOE != '' && decTotalLOE != 0){
                                                    document.getElementById("page:frm:pBlock:pbtable:txtTotalBLOE").innerHTML = addCommasLOE(decTotalLOE);
                                                }else{
                                                    document.getElementById("page:frm:pBlock:pbtable:txtTotalBLOE").innerHTML = '';
                                                }
                                            }
                                            if(document.getElementById("page:frm:pBlock:pbtable:txtTotalBCost") != null){
                                                if(decTotalPCost != '' && decTotalPCost != 0){
                                                    document.getElementById("page:frm:pBlock:pbtable:txtTotalBCost").innerHTML = addCommas(decTotalPCost);
                                                }else{
                                                    document.getElementById("page:frm:pBlock:pbtable:txtTotalBCost").innerHTML = '';
                                                }
                                            }
                                            TotalPOLOE = TotalPOLOE.toString();
                                            if(TotalPOLOE.indexOf(".") == -1) TotalPOLOE = TotalPOLOE+".00";
                                            if(TotalPOLOE == 0) var decTotalPOLOE = '';
                                            else var decTotalPOLOE  = parseFloat(TotalPOLOE).toFixed(2);
                                            var decTotalPOCost = parseFloat(TotalPOCost).toFixed(0);
                                            if(document.getElementById("page:frm:pBlock:pbtable:txtTotalPOLOE") != null){
                                                if(decTotalPOLOE != '' && decTotalPOLOE != 0){
                                                    document.getElementById("page:frm:pBlock:pbtable:txtTotalPOLOE").innerHTML = addCommasLOE(decTotalPOLOE);
                                                }else{
                                                    document.getElementById("page:frm:pBlock:pbtable:txtTotalPOLOE").innerHTML = '';
                                                }
                                            }
                                            if(document.getElementById("page:frm:pBlock:pbtable:txtTotalPOCost") != null){
                                                if(decTotalPOCost != '' && decTotalPOCost != 0){
                                                    document.getElementById("page:frm:pBlock:pbtable:txtTotalPOCost").innerHTML = addCommas(decTotalPOCost);
                                                }else{
                                                    document.getElementById("page:frm:pBlock:pbtable:txtTotalPOCost").innerHTML = '';
                                                }
                                            }
                                            /*TotalPOLOE = TotalPOLOE.toString();
                                            if(TotalPOLOE.indexOf(".") == -1) TotalPOLOE = TotalPOLOE+".00";
                                            if(TotalPOLOE == 0) var decTotalLOE = '';
                                            else var decTotalLOE  = parseFloat(TotalPOLOE).toFixed(2);
                                            if(document.getElementById("page:frm:pBlock:pbtable:txtTotalPOLOE") != null){
                                                document.getElementById("page:frm:pBlock:pbtable:txtTotalPOLOE").innerHTML = TotalPOLOE.toString();
                                            }
                                            */
                                            for(var i=0;i<size;i++)
                                            {
                                                var LFALOE = 0;
                                                var objTxtLFALOE;
                                                if(document.getElementById("page:frm:pBlock:pbtable:"+i+":txtLFALOE") != null){
                                                    objTxtLFALOE = document.getElementById("page:frm:pBlock:pbtable:"+i+":txtLFALOE");
                                                    LFALOE = ConvertNum(objTxtLFALOE.value);
                                                }else if(document.getElementById("page:frm:pBlock:pbtable:"+i+":ofLFALOE") != null){
                                                    objTxtLFALOE = document.getElementById("page:frm:pBlock:pbtable:"+i+":ofLFALOE");
                                                    LFALOE = ConvertNum(objTxtLFALOE.innerHTML);
                                                }                                                
                                                TotalLFALOE += parseFloat(LFALOE);  
                                                var Rate =0;
                                                if(document.getElementById("page:frm:pBlock:pbtable:"+i+":inpRate") != null)
                                                {
                                                    if(document.getElementById("page:frm:pBlock:pbtable:"+i+":inpRate").tagName == 'INPUT'){
                                                     Rate = ConvertNum(document.getElementById("page:frm:pBlock:pbtable:"+i+":inpRate").value);
                                                     }else{
                                                         Rate = ConvertNum(document.getElementById("page:frm:pBlock:pbtable:"+i+":inpRate").innerHTML);
                                                     }
                                                } 
                                                else if(document.getElementById("page:frm:pBlock:pbtable:"+i+":optRate") != null)
                                                {    
                                                     Rate = ConvertNum(document.getElementById("page:frm:pBlock:pbtable:"+i+":optRate").innerHTML);
                                                }
                                                var LFACost = LFALOE * Rate;  
                                                TotalLFACost +=LFACost;
                                                var decLFACost = LFACost.toFixed(0);
                                                if(document.getElementById("page:frm:pBlock:pbtable:"+i+":inpLFACost") != null){
                                                    document.getElementById("page:frm:pBlock:pbtable:"+i+":inpLFACost").innerHTML = addCommas(decLFACost); ;  
                                                }                                                      
                                            }
                                            TotalLFALOE = TotalLFALOE.toString();
                                            if(TotalLFALOE.indexOf(".") == -1) TotalLFALOE = TotalLFALOE+".00";
                                            if(TotalLFALOE == 0) TotalLFALOE = '';
                                            var decTotalLFALOE  = parseFloat(TotalLFALOE).toFixed(2);
                                            var decTotalLFACost = parseFloat(TotalLFACost).toFixed(0);
                                            if(document.getElementById("page:frm:pBlock:pbtable:txtTotalLFALOE") != null){
                                                document.getElementById("page:frm:pBlock:pbtable:txtTotalLFALOE").innerHTML = addCommasLOE(decTotalLFALOE);
                                            }
                                            if(document.getElementById("page:frm:pBlock:pbtable:txtTotalLFACost") != null){
                                                document.getElementById("page:frm:pBlock:pbtable:txtTotalLFACost").innerHTML = addCommas(decTotalLFACost );
                                            }
                                        }
                                        function addCommas(nStr)
                                        {
                                            
                                                nStr += '';
                                                x = nStr.split('.');
                                                x1 = x[0];
                                                x2 = x.length > 1 ? '.' + x[1] : '';
                                                var rgx = /(\d+)(\d{3})/;
                                                while (rgx.test(x1)) {
                                                    x1 = x1.replace(rgx, '$1' + ',' + '$2');
                                                }
                                                return 'USD ' + x1 + x2;
                                           
                                        }
                                        function addCommasLOE(nStr)
                                        {
                                            nStr += '';
                                            x = nStr.split('.');
                                            x1 = x[0];
                                            x2 = x.length > 1 ? '.' + x[1] : '';
                                            var rgx = /(\d+)(\d{3})/;
                                            while (rgx.test(x1)) {
                                                x1 = x1.replace(rgx, '$1' + ',' + '$2');
                                            }
                                            return x1 + x2;
                                        }
                                        Calculation();   
                                        function ValidateLOE(){
                                            var size='{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].lstwrapResource.size}';
                                            var WpStatus = '{!LFA_Work_Plan__c.Status__c}';
                                            var checkvalodate = true;
                                            var ContactArray = new Array();
                                            var intArrayIndex = 0;
                                            
                                            for(var i=0;i<size;i++){
                                               if(document.getElementById('page:frm:pBlock:pbtable:'+i+':txtLOE') != null && document.getElementById('page:frm:pBlock:pbtable:'+i+':txtLOE').value == 0 && WpStatus == 'CT Planning'){
                                                   alert('The LOE for a resource cannot be blank.');
                                                   checkvalodate = false;
                                                   return false;
                                               }
                                               if(document.getElementById('page:frm:pBlock:pbtable:'+i+':txtLOE') != null && document.getElementById('page:frm:pBlock:pbtable:'+i+':txtLOE').value == ''){
                                                   alert('LOE must not be null.');
                                                   checkvalodate = false;
                                                   return false;
                                               }
                                               if(document.getElementById('page:frm:pBlock:pbtable:'+i+':ContactList').value != 'TBD'){
                                                   ContactArray[intArrayIndex] = document.getElementById('page:frm:pBlock:pbtable:'+i+':ContactList').value +';'+document.getElementById('page:frm:pBlock:pbtable:'+i+':Rolelist').value;
                                                   intArrayIndex++;
                                               }
                                            }
                                            
                                            /*for(var j=0;j<ContactArray.length;j++){
                                                for(var k=0;k<ContactArray.length;k++){
                                                    if(j != k && ContactArray[j] == ContactArray[k]){
                                                       alert('Each contact can only be assigned once to a service.');
                                                       checkvalodate = false;
                                                       return false;
                                                    }
                                                }
                                            }*/
                                            if(checkvalodate == true){
                                               actSaveResources();
                                               return false;
                                            }
                                        }  
                                        function toggleDescPopup(PopUp){
                                            var el = document.getElementById(PopUp);                              
                                            if (el.style.display != 'none') {
                                                el.style.display = 'none';
                                            }
                                            else {
                                                el.style.display = '';
                                            }
                                        }                                
                                        </script>
                                </apex:outputPanel>
                            </apex:pageBlock>
                        </td>
                    </tr>
                    <tr>
                        <td class="resourcetTable">
                            <div id="boxscroll" class="chatterFeedPanel">
                                <apex:iframe id="ifResourceChatter" height="225px" scrolling="true" rendered="{!if(blnHasChild==true,true,false)}" src="{!if($Profile.Name = 'LFA Portal User','/LFA','')}/apex/ServiceChatter?ServiceId={!if(blnHasChild==true,lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Id,'')}" />
                            </div>
                        </td>
                    </tr>
                </table>
            </apex:outputPanel>
        </apex:outputPanel>        
<!-- NEW POP-UP -->
        <apex:outputPanel id="tstpopupNew" rendered="{!blnHasNewChild}">
            <apex:pagemessages ></apex:pagemessages>
            <apex:outputPanel id="popupBackgroundNew" styleClass="popupBackgroundNew" />
            <apex:outputPanel id="custPopupNew" styleClass="custPopupNew"  >
                <table cellspacing="0" cellpadding="0" border="0" width="100%">
                    <tr>
                        <td width="50%" class="resourcetTable">
                            <apex:pageBlock id="pBlockNew" title="Change Request" helpTitle="{!if($Profile.Name=='LFA Portal User','','Benchmarking')}" helpurl="if($Profile.Name=='LFA Portal User','','/apex/ServiceBenchmarking?id='lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Id)}">
                              <apex:actionFunction name="actmodifyService" action="{!ModifyService}" status="Processing"  reRender="frm"/>    
                              <apex:actionFunction name="actApprove" action="{!ApproveService}" status="Processing"  reRender="frm" oncomplete="validateOtherTGFUser();"/>    
                              <apex:actionFunction name="actReject" action="{!RejectService}" status="Processing"  reRender="frm" oncomplete="validateOtherTGFUser();"/> 
                              <apex:actionFunction name="actSubmitCounterProposal" action="{!SubmitCounterProposal}" status="Processing"  reRender="frm"/> 
                              <apex:actionFunction name="actchnageServiceStatus" status="Processing"  reRender="frm" oncomplete="statusChange();"/> 
                              <apex:actionFunction name="actSubmitChangeRequest" action="{!SubmitChangeRequest}" status="Processing"  reRender="frm"/> 
                              <apex:actionFunction name="actCancelChangeRequest" action="{!TGFCounterProposalCancel}" status="Processing"  reRender="frm"/> 
                               <apex:actionFunction action="{!DeleteResource}" name="callDeleteResource"  reRender="PanelEdit" status="Processing" >
                                    <apex:param name="DeleteResourceIndex" value="" id="DeleteResourceIndex"/>
                                </apex:actionFunction>
                               <apex:pageBlockButtons location="bottom">
                                    <apex:commandButton value="Back" action="{!CancelChangeRequest}" status="Processing" reRender="frm"/>
                                    <apex:commandButton value="Save and Return" action="{!SubmitChangeRequest}" status="Processing" rendered="{!if(lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c != 'LFA Change Request' && ($Profile.Name = 'Country Team' || $Profile.Name == 'Management' || $Profile.Name == 'LFA Portal User') && (isServicePendingforApprove == false && isApprover == false && blnShowAddResourceLink == true),true,false)}" reRender="frm"/>
                                    <apex:commandButton value="Submit Change Request" onclick="return ValidateRational();" rendered="{!if($Profile.Name == 'LFA Portal User' && (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Ongoing' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Not Started'),true,false)}"/>
                                    
                                    <apex:commandButton value="Submit CT Counter Proposal" style="float:right;" onclick="return CounterProposalService();" rendered="{!if((lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'LFA Change Request' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'LFA Counter-Proposal') && isApprover == true && isServicePending == true,true,false)}"/>
                                    <apex:commandButton value="Cancel Change Request" onclick="return CancelChangeRequest();" rendered="{!if($Profile.Name == 'LFA Portal User' && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'TGF Counter-Proposal' && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Change_Request_Approval__c == 'Rejected',true,false)}"/>                                    
                                    <apex:commandButton value="Modify Service" onclick="return modifyService();" rendered="{!isServiceNotStartedByTGF}" /> <!-- rendered="{!if(($Profile.Name !='LFA Portal User' || $Profile.Name =='Country Team' || $Profile.Name == 'Management' || $Profile.Name =='Finance Officer' || $Profile.Name =='Legal Officer' || $Profile.Name =='M&E Officer' || $Profile.Name =='PSM Officer' ||  $Profile.Name =='Legal Officer' || $Profile.Name =='LFA Coordination' || $Profile.Name =='System Administrator') && (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Ongoing'|| lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Not Started') && (isServicePendingforApprove == false && isApprover == false),true,false)}" />-->                                    
                                    <apex:commandButton value="Cancel Service Addition" onclick="return confirm('Are you sure you wish to cancel?');" action="{!CancelServiceAddOnTGFCP}" rendered="{!if($Profile.Name = 'LFA Portal User' && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'TGF Counter-Proposal' && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Addition_Approval__c == 'Rejected',true,false)}" />
                                    <apex:commandButton value="Submit Counter Proposal" style="float:{!if(lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'TGF Counter-Proposal' && $Profile.Name =='LFA Portal User','','right')};" onclick="return CounterProposalService();" rendered="{!if(((lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Service Addition' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Ongoing' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Not Started') && isApprover == true && isServicePending == true && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.cancellation_approval__c != 'Submitted' && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Completion_approval__c != 'Submitted') || (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'TGF Counter-Proposal' && $Profile.Name =='LFA Portal User'),true,false)}"/>
                                    <apex:commandButton value="Approve LFA Proposal" onclick="return ApproveService();" rendered="{!if(isApprover == true && isServicePending == true && isServiceNotStartedByTGF != true,true,false)}" />
                                    <apex:commandButton value="Reject LFA Proposal" rendered="{!if(isApprover == true  && isServicePending == true && isServiceNotStartedByTGF != true,true,false)}" onclick="return RejectService();"/>
                                    
                                    <apex:commandButton value="Accept TGF Offer" style="float:right;" onclick="return confirm('Are you sure you wish to accept?');" action="{!AcceptTGFApprovalProcess}" rendered="{!if(lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'TGF Counter-Proposal' && $Profile.Name == 'LFA Portal User' ,true,false)}"/>
                                </apex:pageBlockButtons>
                                
                                <div>
                                <apex:pageBlockSection id="secStatus">
                                    <apex:pageBlockSectionItem >
                                        <apex:outputLabel value="Service Type:"></apex:outputLabel>
                                        <apex:outputPanel >                                           
                                            <table>
                                                <tr>
                                                  <td>  
                                                    <apex:outputField value="{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Service_Sub_Type__c}"/>
                                                  </td>
                                                </tr>
                                                <tr>
                                                    <td>
                                                    <apex:outputField id="txtOtherSubCatagory" value="{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Other_Sub_Category__c}" style="display:{!if(lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Service_Sub_Type__c == 'Other LFA Services' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Service_Sub_Type__c == 'Other procurement related services','','none')}"/>
                                                       <!-- <apex:inputText id="txtOtherSubCatagory" value="{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Other_Sub_Category__c}" style="display:{!if(lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Service_Sub_Type__c == 'Other LFA Services' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Service_Sub_Type__c == 'Other procurement related services','','none')}"/>
                                                   --> </td>
                                                </tr>
                                            </table>
                                        </apex:outputPanel>
                                        <!--<apex:selectList value="{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Service_Sub_Type__c}" style="width:200px;" size="1">
                                            <apex:selectOptions value="{!ServiceSubTypeOptions}"></apex:selectOptions>
                                        </apex:selectList>-->
                                        <!--<apex:outputText value="{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Name}"/>-->
                                    </apex:pageBlockSectionItem>
                                    <apex:pageBlockSectionItem >
                                        <apex:outputLabel value="Grant:"></apex:outputLabel>                                       
                                        <apex:outputText value="{!if(isnull(lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Grant__r.Name),'Multiple Grants',lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Grant__r.Name)}"/>
                                    </apex:pageBlockSectionItem>
                                    <apex:pageBlockSectionItem >
                                        <apex:outputLabel value="Country:"></apex:outputLabel>
                                        <apex:outputText value="{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.LFA_Work_Plan__r.Country__r.Name}"/>
                                    </apex:pageBlockSectionItem>
                                    <apex:pageBlockSectionItem >
                                        <apex:outputLabel value="Grant Status:" rendered="{!if(isnull(lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Grant__r.Name),false,true)}"></apex:outputLabel>
                                        <apex:outputText value="{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Grant__r.Grant_Status__c}"/>
                                    </apex:pageBlockSectionItem>
                                    <apex:pageBlockSectionItem id="ItemStatus">
                                        <apex:outputLabel value="Service Status:"/>
                                        <apex:outputPanel >
                                            <apex:outputText value="{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c}" style="display:{!if(lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Not Started'  && ($Profile.Name == 'Country Team' || $Profile.Name == 'Finance Officer'|| $Profile.Name == 'PSM Officer'|| $Profile.Name == 'Legal Officer'|| $Profile.Name == 'M&E Officer'||$Profile.Name == 'Management' || $Profile.Name == 'LFA Coordination' || $Profile.Name == 'System Administrator'),'none','')};"/>
                                            <apex:selectList id="statusEditable" value="{!strSelectedstatus}" style="width:120px;display:{!if(lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Not Started' && ($Profile.Name == 'Country Team' || $Profile.Name == 'Management' || $Profile.Name == 'LFA Coordination' ||  $Profile.Name == 'Finance Officer'|| $Profile.Name == 'PSM Officer'|| $Profile.Name == 'Legal Officer'|| $Profile.Name == 'M&E Officer'||$Profile.Name == 'System Administrator'),'','none')}" size="1" onchange="return CheckStatusChange();">
                                                <!-- <apex:actionSupport event="onchange" reRender="tstpopupNew" status="Processing" oncomplete="statusChange();"/>-->
                                                <apex:selectOptions value="{!SelectstatusOptions}"></apex:selectOptions>                                            
                                            </apex:SelectList>
                                        </apex:outputPanel>
                                    </apex:pageBlockSectionItem>                                                                                                
                                </apex:pageBlockSection>
                                <p></p>
                                
                                <table align="center" style="padding-bottom:10px">                               
                                   <tr > <!-- rendered="{!if(lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Grant__c != NULL,true,false)}">-->
                                      <td align="right">
                                         <apex:outputLabel value="Programmatic Period Covered:" style="font-weight:bold;font-color:grey;padding-right:5px;"></apex:outputLabel>
                                      </td>
                                      <td>
                                         <apex:outputfield value="{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Period_Start__c}" rendered="{!if(blnShowAddResourceLink == false && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c != 'Ongoing' && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c != 'Not Started',true,false)}"/> <!-- rendered="{!if((lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'TGF Counter-Proposal' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Service Addition') && ($Profile.Name == 'Country Team' || $Profile.Name == 'Management' || $Profile.Name == 'LFA Portal User') && blnShowAddResourceLink == false,true,false)}"/>-->
                                         <apex:inputfield id="PeriodStartMonth" value="{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Period_Start__c}" onchange="isAddEditResourcesUpdated = 'True';" rendered="{!if((blnShowAddResourceLink == true || ($Profile.Name == 'LFA Portal User' && (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Ongoing' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Not Started'))) || isServiceNotStartedByTGF == true,true,false)}"/>
                                      </td>
                                      <td>
                                         <apex:outputfield value="{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Period_Start_Year__c}" rendered="{!if(blnShowAddResourceLink == false && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c != 'Ongoing' && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c != 'Not Started',true,false)}"/>
                                         <apex:inputfield id="PeriodStartYear" value="{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Period_Start_Year__c}" onchange="isAddEditResourcesUpdated = 'True';" rendered="{!if((blnShowAddResourceLink == true || ($Profile.Name == 'LFA Portal User' && (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Ongoing' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Not Started'))) || isServiceNotStartedByTGF == true,true,false)}"/>
                                      </td>
                                      <td>                                      
                                         <apex:outputLabel value="to"></apex:outputLabel>
                                      </td>
                                      <td>
                                         <apex:outputfield value="{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Period_End__c}" rendered="{!if(blnShowAddResourceLink == false && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c != 'Ongoing' && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c != 'Not Started',true,false)}"/>
                                         <apex:inputfield id="PeriodEndMonth" value="{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Period_End__c}" onchange="isAddEditResourcesUpdated = 'True';" rendered="{!if((blnShowAddResourceLink == true || ($Profile.Name == 'LFA Portal User' && (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Ongoing' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Not Started'))) || isServiceNotStartedByTGF == true,true,false)}"/>
                                      </td>
                                      <td>
                                      
                                         <apex:outputfield value="{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Period_End_Year__c}" rendered="{!if(blnShowAddResourceLink == false && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c != 'Ongoing' && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c != 'Not Started',true,false)}"/>
                                         <apex:inputfield id="PeriodEndYear" value="{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Period_End_Year__c}" onchange="isAddEditResourcesUpdated = 'True';" rendered="{!if((blnShowAddResourceLink == true || ($Profile.Name == 'LFA Portal User' && (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Ongoing' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Not Started'))) || isServiceNotStartedByTGF == true,true,false)}"/>
                                      
                                      </td>
                                    </tr>                               
                                    <tr>        
                                      <td align="right">                  
                                        <apex:outputLabel value="Forecasted Service Delivery Period:" style="font-weight:bold;padding-right:5px;"></apex:outputLabel>
                                      </td>
                                      <td colspan="2" align="center">
                                         <apex:outputfield value="{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Forecasted_Start_Date__c}" rendered="{!if(blnShowAddResourceLink == false && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c != 'Ongoing' && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c != 'Not Started',true,false)}"/>
                                         <apex:inputField id="ForcastedStartDate" value="{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Forecasted_Start_Date__c}" rendered="{!if((blnShowAddResourceLink == true || ($Profile.Name == 'LFA Portal User' && (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Ongoing' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Not Started'))) || isServiceNotStartedByTGF == true,true,false)}"/>
                                          
                                      </td>
                                      <td >
                                         
                                         <apex:outputLabel value="to"></apex:outputLabel>

                                      </td>
                                      <td colspan="2" align="center">
                                        <apex:outputfield value="{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Forecasted_End_Date__c}" rendered="{!if(blnShowAddResourceLink == false && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c != 'Ongoing' && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c != 'Not Started',true,false)}"/>  
                                        <apex:inputfield id="ForcastedEndDate" value="{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Forecasted_End_Date__c}" onchange="isAddEditResourcesUpdated = 'True';" rendered="{!if((blnShowAddResourceLink == true || ($Profile.Name == 'LFA Portal User' && (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Ongoing' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Not Started'))) || isServiceNotStartedByTGF == true,true,false)}"/>  
                                      </td>
                                   </tr>
                                   <tr>
                                        <td align="right" valign="top">                  
                                            <apex:outputLabel value="Service Details:" style="font-weight:bold;padding-right:5px;"></apex:outputLabel>
                                        </td>
                                        <td colspan="5">
                                            <apex:outputText id="txtComments1" style="resize:none; height: 75px;width: 325px;display:{!if(blnShowAddResourceLink == false && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c != 'Ongoing' && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c != 'Not Started','','none')}" value="{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Comments__c}" />
                                            <apex:inputfield id="txtComments" onchange="isAddEditResourcesUpdated = 'True';" style="resize:none; height: 75px;width: 325px;display:{!if((blnShowAddResourceLink == true || ($Profile.Name == 'LFA Portal User' && (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Ongoing' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Not Started'))) || isServiceNotStartedByTGF == true,'','none')}" value="{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Comments__c}"/>
                                        </td>
                                    </tr>
                                    
                                    <tr style="display:{!if((lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.status__c == 'TGF Counter-Proposal' && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Addition_Approval__c != 'Rejected') || (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Cancelled' && isApprover != true) || blnShowAddResourceLink == true || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.status__c == 'LFA Change Request' || (($Profile.Name == 'LFA Portal User' && (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'TGF Counter-Proposal' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Ongoing' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Not Started')) || isServiceNotStartedByTGF == true || (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.cancellation_approval__c == 'Submitted' && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Completion_approval__c != 'Submitted') || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Cancelled' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'LFA Counter-Proposal') && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.status__c != 'Service Addition' && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.status__c != 'Cancellation Request','','none')}">
                                        <td valign="top" colspan="4" style="display:{!if(lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Completion_approval__c != 'Submitted','','none')}">                  
                                            <apex:outputLabel id="ChangeServiceRational" value="{!if(lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.cancellation_approval__c == 'Submitted' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Cancelled','Rationale for Service Cancellation: ','Rationale for Change Request: ')}" style="display:{!if(lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Cancellation_approval__c == 'Submitted' && isApprover == true,'none','')}"></apex:outputLabel>
                                            <apex:outputLabel id="CancelServiceRational" value="Rationale for Service Cancellation: " style="display:none;"></apex:outputLabel>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan="4" style="display:{!if((lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Completion_approval__c != 'Submitted' && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.status__c != 'Service Addition' && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.status__c != 'TGF Counter-Proposal' && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.status__c != 'Cancellation Request') || (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.status__c == 'TGF Counter-Proposal' && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Addition_Approval__c != 'Rejected') || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Cancelled' || strSelectedstatus == 'Cancelled','','none')}">
                                             <div class="requiredInput" >
                                                <div class="requiredBlock"></div> <!-- style="display:{!if(isServiceNotStartedByTGF == true,'','none')}" --> 
                                                <apex:inputField id="inpRationaleChangeRequest" value="{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Change_Request_Rationale__c}" style="width:100%;resize:none; height: 75px;" rendered="{!if((blnShowAddResourceLink == true || ($Profile.Name == 'LFA Portal User' && (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Ongoing' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Not Started'))) || isServiceNotStartedByTGF == true,true,false)}"/>
                                                <apex:inputField id="inpRationaleCancelRequest" value="{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Service_Cancellation_Rationale__c}" style="width:100%;resize:none; height: 75px;display:none;"/>
                                             </div>
                                             
                                             <apex:outputField value="{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Service_Cancellation_Rationale__c}" rendered="{!if(((lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.status__c == 'Cancellation Request' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.status__c == 'Cancelled') && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.cancellation_approval__c == 'Submitted' && isApprover != true),true,false)}"/>
                                             <apex:outputField value="{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Change_Request_Rationale__c}" rendered="{!if((blnShowAddResourceLink == true || ($Profile.Name == 'LFA Portal User' && (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Ongoing' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Not Started'))) || isServiceNotStartedByTGF == true || (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.status__c == 'LFA Change Request' && (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.cancellation_approval__c == 'Submitted' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Completion_approval__c == 'Submitted')),if($Profile.Name == 'LFA Portal User' && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'TGF Counter-Proposal',true,false),true)}"/>
                                        </td>
                                    </tr>
                               </table>
                               <div>
                                   <apex:outputLabel value="The LFA has submitted this service for cancellation." style="font-weight:bold;float:left;display:{!if(lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.status__c == 'Cancellation Request' && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Cancellation_approval__c == 'Submitted' && isApprover == true,'','none')}"></apex:outputLabel><br/>
                                   <b>{!if(lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.cancellation_approval__c == 'Submitted' && isApprover == true,'Rationale: ','')}</b>
                                   <table width="100%" cellspacing="0" cellpadding="0" border="1" style="display:{!if(lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.status__c == 'Cancellation Request' && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.cancellation_approval__c == 'Submitted' && isApprover == true,'','none')};"><tr><td>
                                   <apex:outputField value="{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Service_Cancellation_Rationale__c}" rendered="{!if(lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.status__c == 'Cancellation Request' && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.cancellation_approval__c == 'Submitted' && isApprover == true,true,false)}"/>
                                   </td></tr></table>
                               </div>
                              <!-- <table align="center" width="100%">
                                    <tr>
                                        <td valign="top" align="center">
                                            <apex:outputLabel value="Rationale for Change Request:"></apex:outputLabel>
                                        </td>
                                        
                                    </tr>
                                    <tr>
                                        <td align="right">
                                            <apex:inputField id="inpRationaleChangeRequest" value="{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Change_Request_Rationale__c}" style="width:100%;height:17px;resize:none;" />
                                        </td>
                                    </tr>
                                </table>-->
                                <p></p>                             
                                <apex:outputPanel rendered="{!if(lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Grant__c != NULL,true,false)}">
                                    <table cellpadding="5px" cellspacing="0" align="center">
                                        <tr >
                                           <td><b>Risks</b></td>
                                           <td style="border: 1px solid grey;background-color:{!if(lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Grant__r.Financial_and_Fiduciary_Risks__c == 'High','red',if(lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Grant__r.Financial_and_Fiduciary_Risks__c == 'Medium','yellow',if(lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Grant__r.Financial_and_Fiduciary_Risks__c == 'Low','lightgreen','')))}"><apex:outputtext value="Financial & Fiduciary"/></td>
                                           <td style="border: 1px solid grey;background-color:{!if(lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Grant__r.Programmatic_and_Performance_Risks__c == 'High','red',if(lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Grant__r.Programmatic_and_Performance_Risks__c == 'Medium','yellow',if(lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Grant__r.Programmatic_and_Performance_Risks__c == 'Low','lightgreen','')))}"><apex:outputtext value="Programmatic & Performance"/></td>
                                           <td style="border: 1px solid grey;background-color:{!if(lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Grant__r.Health_Services_and_Products_Risks__c == 'High','red',if(lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Grant__r.Health_Services_and_Products_Risks__c == 'Medium','yellow',if(lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Grant__r.Health_Services_and_Products_Risks__c == 'Low','lightgreen','')))}"><apex:outputtext value="Health Services & Products"/></td>
                                        </tr>
                                    </table>    
                                </apex:outputPanel>
                                </div>
                                <br/>
                                
        <!---RESOURCES TABLE IN NEW POP-UP--->
                                <apex:outputPanel id="PanelEdit">
                                    <apex:variable id="variable" var="CountResource" value="{!0}"/>
                                    <apex:pageBlockTable width="100%" id="pbtable" headerClass="headerColor" value="{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].lstwrapResource}" var="Resource">
                                        
                                        <apex:column width="2%">
                                            <apex:image style="cursor:pointer;float:left;" value="{!$Resource.DeleteImage}" height="20" width="25" title="Delete" onclick="DeleteResource('{!CountResource}');" rendered="{!if(Resource.objResource.id == null,true,false)}" />
                                            <apex:facet name="footer">
                                                <apex:commandLink value="Add" reRender="PanelEdit" status="Processing" action="{!AddResource}" rendered="{!if($Profile.Name == 'LFA Portal User' && (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Ongoing' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Not Started' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'TGF Counter-Proposal') || isServiceNotStartedByTGF == true || ($Profile.Name != 'LFA Portal User' && (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'LFA Change Request' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'LFA Counter-Proposal')) || ($Profile.Name != 'LFA Portal User' && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Service Addition'),true,false)}"
                                                style="display:{!if($Profile.Name == 'Finance Officer' ||  $Profile.Name == 'M&E Officer' || $Profile.Name == 'PSM Officer' || $Profile.Name == 'Legal Officer','none','')}" >
                                                    <apex:param value="{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.id}" name="newServiceId" id="newServoceId"/>
                                                </apex:commandLink>
                                            </apex:facet> 
                                        </apex:column>
                                        <apex:column width="10%" headerValue="Role">                                         
                                            <apex:SelectList id="Rolelist" style="width:160px;display:{!if(Resource.objResource.Id == null,'','none')}" value="{!Resource.objResource.LFA_Role__c}" 
                                                onchange="isAddEditResourcesUpdated = 'True'; FillContact('{!CountResource}');" size="1" >
                                                <apex:selectOptions value="{!RoleOptions}"></apex:selectOptions>                                            
                                            </apex:SelectList>
                                            <apex:outputText value="{!Resource.objResource.LFA_Role__r.Name}" style="display:{!if(Resource.objResource.Id != null,'','none')}"/>
                                            <apex:outputtext value="{!Resource.objResource.LFA_Role__c}" id="hdnRoleId" style="display:none;"/>
                                                                                   
                                        </apex:column>
                                        <apex:column width="10%" headerValue="Person">
                                            <!--<apex:outputtext value="{!Resource.objResource.Contact__r.Name}" rendered="{!!isnull(Resource.objResource.Contact__r.Name)}"/>
                                            <apex:outputtext value="TBD" rendered="{!isnull(Resource.objResource.Contact__r.Name)}"/>-->
                                            
                                            <apex:outputtext value="{!Resource.ContactName}" style="display:{!if(Resource.objResource.Id != null,'','none')}" rendered="{!!isnull(Resource.ContactName)}"/>
                                            
                                            <apex:SelectList id="ContactList" style="width:160px;display:{!if(Resource.objResource.Id == null,'','none')}" value="{!Resource.ContactID}" onchange="isAddEditResourcesUpdated = 'True'; FillRate('{!CountResource}');" size="1">
                                                <apex:selectOptions value="{!Resource.ContactOptions}"></apex:selectOptions>
                                            </apex:SelectList>
                                           
                                            <apex:outputtext value="{!Resource.ContactID}" id="hdnContactId" style="display:none;" />
                                            
                                        </apex:column>
                                        <apex:column width="10%" headerValue="Rate">
                                            <apex:outputField id="optRate" value="{!Resource.objResource.Rate__c}" rendered="{!if((Resource.ContactName == 'TBD' && Resource.RoleName == 'Other Professional'),false,true)}"/>
                                            <apex:inputField id="inpRate" style="width:50px;" value="{!Resource.objResource.Rate__c}" rendered="{!if((Resource.ContactName == 'TBD' && Resource.RoleName == 'Other Professional'),true,false)}" onchange="isAddEditResourcesUpdated = 'True'; Calculation();calculateProposedCost('{!$Component.optRate}','{!$Component.inpRate}','{!$Component.txtProposedLOE}','{!$Component.txtProposedCost}'); "/>
                                            <!-- <apex:inputField id="inpRate" style="width:50px;" value="{!Resource.objResource.Rate__c}" onchange="Calculation(); "/> -->
                                            
                                            <apex:facet name="footer">
                                                <apex:outputText value="Total"/>
                                            </apex:facet>
                                            <apex:variable var="CountResource" value="{!CountResource+1}"/>
                                        </apex:column>
                                       <apex:column width="5%" rendered="{!if(lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Completion_approval__c == 'Submitted',true,false)}">
                                            <apex:facet name="header">Actual LOE</apex:facet>
                                            <apex:outputText id="txtPOLOE" value="{!Resource.objResource.actual_LOE__c}" style="width:50px;display:{!if($Profile.Name == 'LFA Portal User' && (blnShowAddResourceLink == true && strSelectedstatus != 'Completed'),true,false)}"/>
                                            <apex:facet name="footer">
                                                <apex:outputLabel id="txtTotalPOLOE" value="" />
                                            </apex:facet>                                            
                                        </apex:column>                                                                                
                                        <apex:column width="5%" rendered="{!if(lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Completion_approval__c == 'Submitted',true,false)}">
                                            <apex:facet name="header">Actual Cost</apex:facet>
                                            <apex:outputText id="txtPOCost" value="{!Resource.objResource.actual_Cost__c}" />
                                            <apex:facet name="footer">                                               
                                                <apex:outputLabel id="txtTotalPOCost" value="" />
                                            </apex:facet>   
                                        </apex:column>
                                        <!--<apex:column width="10%" headerValue="LOE" >
                                            <apex:inputField style="width:50px;" id="txtLOE" value="{!Resource.objResource.LFA_Proposed_LOE__c}" onchange="validateLOEForTBD(this,'{!$Component.InfoImageBlue}','{!$Component.ContactList}');" rendered="{!if(($Profile.Name=='LFA Coordination')|| ($Profile.Name=='System Administrator') || ($Profile.Name=='Country Team') || ($Profile.Name == 'Management') ||  $Profile.Name =='Legal Officer' || ($Profile.Name=='Finance Officer') || ($Profile.Name=='M&E Officer') || ($Profile.Name=='PSM Officer') || (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Ongoing')  || (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Not Started'),true,false)}"/>
                                            <apex:outputText id="otxtLOE" value="{!Resource.objResource.LFA_Proposed_LOE__c}" rendered="{!if(($Profile.Name=='LFA Coordination')|| ($Profile.Name=='System Administrator') || ($Profile.Name=='Country Team') || ($Profile.Name == 'Management') || ($Profile.Name=='Finance Officer') || ($Profile.Name=='M&E Officer') || ($Profile.Name=='PSM Officer') ||  $Profile.Name =='Legal Officer' || (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Ongoing')  || (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Not Started'),false,true)}"></apex:outputText>
                                            <apex:facet name="footer">
                                                <apex:outputLabel id="txtTotalLOE" value=""/>
                                            </apex:facet>                                             
                                        </apex:column>                                        
                                        <apex:column width="10%" headerValue="Cost">
                                            <apex:outputText id="inpCost" value="{!Resource.objResource.LFA_Proposed_Cost__c}"/>
                                            <apex:facet name="footer">                                               
                                                <apex:outputLabel id="txtTotalCost" value="" />
                                            </apex:facet>
                                        </apex:column>-->
                                        <apex:column width="10%" rendered="{!if((blnShowAddResourceLink == true && $Profile.Name != 'LFA Portal User') || ($Profile.Name == 'LFA Portal User' && (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Ongoing' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Not Started')) || (isApprover == true && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'LFA Change Request') || (isServiceNotStartedByTGF == true) || (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Cancellation_Approval__c == 'Submitted' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Completion_Approval__c == 'Submitted' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Cancelled') || (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'TGF Counter-Proposal' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'LFA Change Request' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'LFA Counter-Proposal'),true,false)}">
                                        <!-- rendered="{!if((blnShowAddResourceLink == true && $Profile.Name != 'LFA Portal User') || ($Profile.Name == 'LFA Portal User' && (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Ongoing' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Not Started')) || (isApprover == true && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'LFA Change Request') || (isServiceNotStartedByTGF == true) || (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Cancellation_Approval__c == 'Submitted' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Completion_Approval__c == 'Submitted' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Cancelled') || ((lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'TGF Counter-Proposal' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'LFA Change Request' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'LFA Counter-Proposal')) || (($Profile.Name == 'Finance Officer' ||  $Profile.Name == 'M&E Officer' || $Profile.Name == 'PSM Officer' || $Profile.Name == 'Legal Officer') && (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Service Addition' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'TGF Counter-Proposal' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'LFA Change Request' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'LFA Counter-Proposal')),true,false)}" -->
                                            <apex:facet name="header">Budgeted LOE</apex:facet>
                                            <!-- <apex:inputField style="width:50px;" id="txtLOE" value="{!Resource.objResource.LOE__c}" onchange="validateLOEForTBD(this,'{!$Component.InfoImageBlue}','{!$Component.ContactList}');" rendered="{!if(($Profile.Name=='LFA Coordination')|| ($Profile.Name=='System Administrator') || ($Profile.Name=='Country Team') || ($Profile.Name == 'Management') || ($Profile.Name=='Finance Officer') || ($Profile.Name=='M&E Officer') || ($Profile.Name=='PSM Officer') ||  $Profile.Name =='Legal Officer' || (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Ongoing')  || (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Not Started'),true,false)}"/>
                                            <apex:outputText id="otxtLOE" value="{!Resource.objResource.LOE__c}" rendered="{!if(($Profile.Name=='LFA Coordination')|| ($Profile.Name=='System Administrator') || ($Profile.Name=='Country Team') || ($Profile.Name == 'Management') || ($Profile.Name=='Finance Officer') || ($Profile.Name=='M&E Officer') || ($Profile.Name=='PSM Officer') ||  $Profile.Name =='Legal Officer' || (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Ongoing')  || (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Not Started'),false,true)}"></apex:outputText>
                                           -->
                                            <apex:inputField style="width:50px;" id="txtLOE" value="{!Resource.objResource.LOE__c}" onchange="Calculation();" rendered="{!if(isServiceNotStartedByTGF == true && strSelectedstatus != 'Cancelled' && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  != 'Ongoing' && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  != 'Not Started',true,false)}"/>
                                            <apex:outputText id="otxtLOE" value="{!Resource.objResource.LOE__c}" rendered="{!if((lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Ongoing' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Not Started' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'TGF Counter-Proposal' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'LFA Change Request' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'LFA Counter-Proposal') || (isApprover == true && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'LFA Change Request') || (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Cancellation_Approval__c == 'Submitted' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Completion_Approval__c == 'Submitted' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Cancelled' || strSelectedstatus == 'Cancelled') && isServiceNotStartedByTGF == false,true,false)}"></apex:outputText>
                                            <!-- rendered="{!if((lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Ongoing' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Not Started' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'TGF Counter-Proposal' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'LFA Change Request' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'LFA Counter-Proposal') || (($Profile.Name == 'Finance Officer' ||  $Profile.Name == 'M&E Officer' || $Profile.Name == 'PSM Officer' || $Profile.Name == 'Legal Officer') && (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Service Addition' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'TGF Counter-Proposal' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'LFA Change Request' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'LFA Counter-Proposal')) || (isApprover == true && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'LFA Change Request') || (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Cancellation_Approval__c == 'Submitted' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Completion_Approval__c == 'Submitted' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Cancelled' || strSelectedstatus == 'Cancelled') && isServiceNotStartedByTGF == false,true,false)}" -->
                                            <apex:facet name="footer">
                                                <apex:outputLabel id="txtTotalLOE" value=""/>
                                            </apex:facet>                                             
                                        </apex:column>                                        
                                        <apex:column width="10%" rendered="{!if((blnShowAddResourceLink == true && $Profile.Name != 'LFA Portal User') || ($Profile.Name == 'LFA Portal User' && (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Ongoing' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Not Started')) || (isApprover == true && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'LFA Change Request') || (isServiceNotStartedByTGF == true) || (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Cancellation_Approval__c == 'Submitted' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Completion_Approval__c == 'Submitted' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Cancelled') || (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'TGF Counter-Proposal' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'LFA Change Request' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'LFA Counter-Proposal'),true,false)}">
                                            <apex:facet name="header">Budgeted Cost</apex:facet>
                                            <apex:outputText id="inpCost" value="{!Resource.objResource.Cost__c}"/>
                                            <apex:facet name="footer">                                               
                                                <apex:outputLabel id="txtTotalCost" value="" />
                                            </apex:facet>
                                        </apex:column>
                                        <apex:column width="10%" rendered="{!if(isServiceNotStartedByTGF == false && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Cancellation_Approval__c != 'Submitted' && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Completion_Approval__c != 'Submitted' && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c != 'Cancelled' && strSelectedstatus != 'Cancelled',true,false)}">
                                        <!-- rendered="{!if(($Profile.Name=='Country Team' || $Profile.Name == 'Management') && (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Ongoing' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Not Started'),false,true)}">-->
                                            <apex:facet name="header">LFA Proposed LOE</apex:facet>
                                            <apex:inputField id="txtProposedLOE" value="{!Resource.objResource.Proposed_LOE__c}" onchange="isAddEditResourcesUpdated = 'True'; calculateProposedCost('{!$Component.optRate}','{!$Component.inpRate}','{!$Component.txtProposedLOE}','{!$Component.txtProposedCost}'); " rendered="{!if(((lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'TGF Counter-Proposal' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Ongoing' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Not Started') && $Profile.Name == 'LFA Portal User'),true,false)}"/>
                                            <apex:outputText id="otxtProposedLOE" value="{!Resource.objResource.Proposed_LOE__c}" rendered="{!if(((lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'TGF Counter-Proposal' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Ongoing' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Not Started') && $Profile.Name == 'LFA Portal User') || isServiceNotStartedByTGF == true,false,true)}" ></apex:outputText>
                                            <apex:facet name="footer">                                               
                                                <apex:outputLabel id="txtTotalProposedLOE" value="" />
                                            </apex:facet>
                                        </apex:column>
                                        
                                        <apex:column width="10%" style="word-wrap: break-word;" rendered="{!if(isServiceNotStartedByTGF == false && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Cancellation_Approval__c != 'Submitted'  && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Completion_Approval__c != 'Submitted' && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c != 'Cancelled' && strSelectedstatus != 'Cancelled',true,false)}">
                                            <apex:facet name="header">LFA Proposed Cost</apex:facet>
                                            <apex:outputText id="txtProposedCost" value="{!Resource.objResource.Proposed_Cost__c}" /><!-- rendered="{!if(lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'LFA change request' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'TGF Counter-Proposal' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Service Addition' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Ongoing' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Not Started',true,false)}"></apex:outputText>-->
                                            <apex:facet name="footer">                                               
                                                <apex:outputLabel id="txtTotalProposedCost" value="" />
                                            </apex:facet>
                                        </apex:column>
                                        
                                        <apex:column width="10%" rendered="{!if((($Profile.Name == 'LFA Portal User') && (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'LFA Change Request' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Service Addition' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Ongoing' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Not Started')) || (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Cancellation_Approval__c == 'Submitted' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Completion_Approval__c == 'Submitted') || strSelectedstatus == 'Cancelled',false,true)}">
                                            <apex:facet name="header">
                                                {!if(isServiceNotStartedByTGF == true,'New LOE','CT Proposed LOE')}
                                            </apex:facet>
                                            <apex:inputField style="width:50px;" id="txtCTProposedLOE" value="{!Resource.objResource.CT_Proposed_LOE__c}" onchange="isAddEditResourcesUpdated = 'True'; calculateProposedCost('{!$Component.optRate}','{!$Component.inpRate}','{!$Component.txtCTProposedLOE}','{!$Component.txtCTProposedCost}');" rendered="{!if((isApprover == true && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c != 'TGF Counter-Proposal') || isServiceNotStartedByTGF == true,true,false)}"/> <!-- rendered="{!if(($Profile.Name=='Country Team' || $Profile.Name == 'Management' || $Profile.Name=='Finance Officer' || $Profile.Name=='M&E Officer' || $Profile.Name=='Legal Officer' || $Profile.Name=='PSM Officer') && (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Service Addition' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'LFA Change Request' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'TGF Counter-Proposal' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'LFA Counter-Proposal'),true,false)}"/>-->
                                            <apex:outputText id="otxtCTProposedLOE" value="{!Resource.objResource.CT_Proposed_LOE__c}" rendered="{!if((isApprover == true && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c != 'TGF Counter-Proposal') || isServiceNotStartedByTGF == true,false,true)}" style="width:50px;"></apex:outputText> <!-- rendered="{!if(($Profile.Name=='Country Team' || $Profile.Name == 'Management' || $Profile.Name=='Finance Officer' || $Profile.Name=='M&E Officer' || $Profile.Name=='Legal Officer' || $Profile.Name=='PSM Officer') && (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Service Addition' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'LFA Change Request' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'TGF Counter-Proposal' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'LFA Counter-Proposal'),false,true)}" -->
                                            <apex:facet name="footer">                                               
                                                <apex:outputLabel id="txtTotalCTProposedLOE" value="" />
                                            </apex:facet>
                                        </apex:column>
                                        
                                        <apex:column width="10%" rendered="{!if((($Profile.Name == 'LFA Portal User') && (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'LFA Change Request' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Service Addition' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Ongoing' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Not Started')) || (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Cancellation_Approval__c == 'Submitted' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Completion_Approval__c == 'Submitted') || strSelectedstatus == 'Cancelled',false,true)}">
                                             <apex:facet name="header">
                                               {!if(isServiceNotStartedByTGF == true,'New Cost','CT Proposed Cost')}
                                            </apex:facet>
                                        <!-- rendered="{!if(($Profile.Name=='Country Team' || $Profile.Name == 'Management') || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'LFA Change Request' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'TGF Counter-Proposal' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'LFA Counter-Proposal',true,false)}" -->
                                            <apex:outputText id="txtCTProposedCost" value="{!Resource.objResource.CT_Proposed_Cost__c}" /> <!-- rendered="{!if(isApprover == true && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Service Addition',false,true)}" ></apex:outputText>-->
                                            
                                            <apex:facet name="footer">                                               
                                                <apex:outputLabel id="txtTotalCTProposedCost" value="" />
                                            </apex:facet>
                                        </apex:column>
                                        
                                    </apex:pageBlockTable>
                                    <br/>
                                    <table align="center" width="100%" >
                                        <tr id="dynamicTotals1" style="display:{!if(lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Cancelled' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Cancellation_Approval__c == 'Submitted' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Completion_Approval__c == 'Submitted' || ($Profile.Name != 'LFA Portal User' && (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Not Started' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Ongoing')),'none','')}">
                                            <td width="30%" colspan="3">Total Approved Work Plan Labor Value (A): </td>
                                            <td width="10%" colspan="2" style="display:{!if(lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.cancellation_approval__c == 'Submitted','','none')}"></td>
                                            <td width="20%" colspan="2" style="display:{!if((blnShowAddResourceLink == true && $Profile.Name != 'LFA Portal User') || ($Profile.Name == 'LFA Portal User' && (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Ongoing' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Not Started' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'TGF Counter-Proposal')) || (isApprover == true && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'LFA Change Request') || (isServiceNotStartedByTGF == true) || (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Cancellation_Approval__c == 'Submitted'),'','none')};"></td>
                                            <td width="10%" style="display:{!if(isServiceNotStartedByTGF == false && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Cancellation_Approval__c != 'Submitted' && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Completion_Approval__c != 'Submitted','','none')};"></td>
                                            <td width="10%" style="display:{!if(isServiceNotStartedByTGF == false && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Cancellation_Approval__c != 'Submitted' && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Completion_Approval__c != 'Submitted','','none')};">    
                                                <apex:outputText id="optPOlabor" value="USD {0, number,###,###,##0}" >
                                                    <apex:param value="{!lstWorkPlanToUpdate[0].po_value_labor_roll_up__c}"/>
                                                </apex:outputText>
                                            </td>
                                            <td width="10%" style="display:{!if(($Profile.Name == 'LFA Portal User' && (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'LFA Change Request' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Service Addition' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Ongoing' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Not Started')) || (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Cancellation_Approval__c == 'Submitted' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Completion_Approval__c == 'Submitted') || strSelectedstatus == 'Cancelled','none','')};"></td>
                                            <td width="10%" style="display:{!if(($Profile.Name == 'LFA Portal User' && (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'LFA Change Request' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Service Addition' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Ongoing' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Not Started')) || (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Cancellation_Approval__c == 'Submitted' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Completion_Approval__c == 'Submitted') || strSelectedstatus == 'Cancelled','none','')};">
                                                <apex:outputText id="optPOlaborCT" value="USD {0, number,###,###,##0}" >
                                                    <apex:param value="{!lstWorkPlanToUpdate[0].po_value_labor_roll_up__c}"/>
                                                </apex:outputText>
                                            </td>
                                            
                                        </tr>  
                                        <tr id="dynamicTotals2" style="display:{!if(lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Cancelled' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Cancellation_Approval__c == 'Submitted' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Completion_Approval__c == 'Submitted' || ($Profile.Name != 'LFA Portal User' && (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Not Started' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Ongoing')),'none','')}"> 
                                            <td width="30%" colspan="3">Total Budgeted Labor before This Service Change (B): </td>
                                            <td width="10%" colspan="2" style="display:{!if(lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.cancellation_approval__c == 'Submitted','','none')}"></td>
                                            <td width="20%" colspan="2" style="display:{!if((blnShowAddResourceLink == true && $Profile.Name != 'LFA Portal User') || ($Profile.Name == 'LFA Portal User' && (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Ongoing' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Not Started' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'TGF Counter-Proposal')) || (isApprover == true && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'LFA Change Request') || (isServiceNotStartedByTGF == true) || (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Cancellation_Approval__c == 'Submitted'),'','none')};"></td>
                                            <td width="10%" style="display:{!if(isServiceNotStartedByTGF == false && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Cancellation_Approval__c != 'Submitted' && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Completion_Approval__c != 'Submitted','','none')};"></td>
                                            <td width="10%" style="display:{!if(isServiceNotStartedByTGF == false && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Cancellation_Approval__c != 'Submitted' && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Completion_Approval__c != 'Submitted','','none')};">    
                                                <apex:outputText id="optTotalBudget" value="USD {0, number,###,###,##0}" >
                                                    <apex:param value="{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.LFA_Work_Plan__r.Budgeted_Labor__c}"/>
                                                </apex:outputText>
                                            </td>
                                            <td width="10%" style="display:{!if(($Profile.Name == 'LFA Portal User' && (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'LFA Change Request' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Service Addition' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Ongoing' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Not Started')) || (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Cancellation_Approval__c == 'Submitted' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Completion_Approval__c == 'Submitted') || strSelectedstatus == 'Cancelled','none','')};"></td>
                                            <td width="10%" style="display:{!if(($Profile.Name == 'LFA Portal User' && (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'LFA Change Request' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Service Addition' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Ongoing' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Not Started')) || (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Cancellation_Approval__c == 'Submitted' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Completion_Approval__c == 'Submitted') || strSelectedstatus == 'Cancelled','none','')};">
                                                <apex:outputText id="optTotalBudgetCT" value="USD {0, number,###,###,##0}" >
                                                    <apex:param value="{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.LFA_Work_Plan__r.Budgeted_Labor__c}"/>
                                                </apex:outputText>
                                            </td>                                            
                                        </tr>
                                        <tr id="dynamicTotals3" style="display:{!if(lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Cancelled' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Cancellation_Approval__c == 'Submitted' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Completion_Approval__c == 'Submitted' || ($Profile.Name != 'LFA Portal User' && (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Not Started' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Ongoing')),'none','')}"> 
                                            <td width="30%" colspan="3">Total Budgeted Labor after This Proposed Service Change (C): </td>
                                            <td width="10%" colspan="2" style="display:{!if(lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.cancellation_approval__c == 'Submitted','','none')}"></td>
                                            <td width="20%" colspan="2" style="display:{!if((blnShowAddResourceLink == true && $Profile.Name != 'LFA Portal User') || ($Profile.Name == 'LFA Portal User' && (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Ongoing' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Not Started' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'TGF Counter-Proposal')) || (isApprover == true && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'LFA Change Request') || (isServiceNotStartedByTGF == true) || (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Cancellation_Approval__c == 'Submitted'),'','none')};"></td>
                                            <td width="10%" style="display:{!if(isServiceNotStartedByTGF == false && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Cancellation_Approval__c != 'Submitted' && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Completion_Approval__c != 'Submitted','','none')};"></td>
                                            <td width="10%" style="display:{!if(isServiceNotStartedByTGF == false && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Cancellation_Approval__c != 'Submitted' && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Completion_Approval__c != 'Submitted','','none')};">    
                                                <apex:outputText id="optLfaPropCost" value="USD {0, number,###,###,##0}" >
                                                    <apex:param value=""/>
                                                </apex:outputText>
                                            </td>
                                            <td width="10%" style="display:{!if(($Profile.Name == 'LFA Portal User' && (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'LFA Change Request' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Service Addition' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Ongoing' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Not Started')) || (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Cancellation_Approval__c == 'Submitted' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Completion_Approval__c == 'Submitted') || strSelectedstatus == 'Cancelled','none','')};"></td>
                                            <td width="10%" style="display:{!if(($Profile.Name == 'LFA Portal User' && (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'LFA Change Request' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Service Addition' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Ongoing' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Not Started')) || (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Cancellation_Approval__c == 'Submitted' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Completion_Approval__c == 'Submitted') || strSelectedstatus == 'Cancelled','none','')};">
                                                <apex:outputText id="optLfaPropCostCT" value="USD {0, number,###,###,##0}" >
                                                    <apex:param value=""/>
                                                </apex:outputText>
                                            </td>
                                            
                                        </tr>
                                        <tr id="dynamicTotals4" style="display:{!if(lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Cancelled' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Cancellation_Approval__c == 'Submitted' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Completion_Approval__c == 'Submitted' || ($Profile.Name != 'LFA Portal User' && (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Not Started' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Ongoing')),'none','')}"> 
                                            <td width="30%" colspan="3">Total Labor over/underspend after This Proposed Service Change (C-A): </td>
                                            <td width="10%" colspan="2" style="display:{!if(lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.cancellation_approval__c == 'Submitted','','none')}"></td>
                                            <td width="20%" colspan="2" style="display:{!if((blnShowAddResourceLink == true && $Profile.Name != 'LFA Portal User') || ($Profile.Name == 'LFA Portal User' && (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Ongoing' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Not Started' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'TGF Counter-Proposal')) || (isApprover == true && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'LFA Change Request') || (isServiceNotStartedByTGF == true) || (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Cancellation_Approval__c == 'Submitted'),'','none')};"></td>
                                            <td width="10%" style="display:{!if(isServiceNotStartedByTGF == false && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Cancellation_Approval__c != 'Submitted' && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Completion_Approval__c != 'Submitted','','none')};"></td>
                                            <td width="10%" style="color:red;display:{!if(isServiceNotStartedByTGF == false && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Cancellation_Approval__c != 'Submitted' && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Completion_Approval__c != 'Submitted','','none')};">    
                                                <apex:outputText id="optFcastLfaProp" value="USD {0, number,###,###,##0}" >
                                                    <apex:param value=""/>
                                                </apex:outputText>
                                            </td>
                                            <td width="10%" style="display:{!if(($Profile.Name == 'LFA Portal User' && (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'LFA Change Request' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Service Addition' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Ongoing' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Not Started')) || (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Cancellation_Approval__c == 'Submitted' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Completion_Approval__c == 'Submitted') || strSelectedstatus == 'Cancelled','none','')};"></td>
                                            <td width="10%" style="color:red;display:{!if(($Profile.Name == 'LFA Portal User' && (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'LFA Change Request' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Service Addition' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Ongoing' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Not Started')) || (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Cancellation_Approval__c == 'Submitted' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Completion_Approval__c == 'Submitted') || strSelectedstatus == 'Cancelled','none','')};">
                                                <apex:outputText id="optFcastLfaPropCT" value="USD {0, number,###,###,##0}" >
                                                    <apex:param value=""/>
                                                </apex:outputText>
                                            </td>  
                                            
                                        </tr>
                                        <tr id="dynamicTotals5" style="display:{!if(lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Cancelled' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Cancellation_Approval__c == 'Submitted' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Completion_Approval__c == 'Submitted' || ($Profile.Name != 'LFA Portal User' && (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Not Started' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c == 'Ongoing')),'none','')}"> 
                                            <td width="30%" colspan="3">Total Amount of All Pending Change Requests (including this service): </td>
                                            <td width="10%" colspan="2" style="display:{!if(lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.cancellation_approval__c == 'Submitted','','none')}"></td>
                                            <td width="20%" colspan="2" style="display:{!if((blnShowAddResourceLink == true && $Profile.Name != 'LFA Portal User') || ($Profile.Name == 'LFA Portal User' && (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Ongoing' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Not Started' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'TGF Counter-Proposal')) || (isApprover == true && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'LFA Change Request') || (isServiceNotStartedByTGF == true) || (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Cancellation_Approval__c == 'Submitted'),'','none')};"></td>
                                            <td width="10%" style="display:{!if(isServiceNotStartedByTGF == false && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Cancellation_Approval__c != 'Submitted' && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Completion_Approval__c != 'Submitted','','none')};"></td>
                                            <td width="10%" style="color:red;display:{!if(isServiceNotStartedByTGF == false && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Cancellation_Approval__c != 'Submitted' && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Completion_Approval__c != 'Submitted','','none')};">    
                                                <apex:outputText id="AllPendingAmountPL" value="USD {0, number,###,###,##0}" >
                                                    <apex:param value=""/>
                                                </apex:outputText>
                                            </td>
                                           <!-- <td width="10%" style="display:{!if(($Profile.Name == 'LFA Portal User' && (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'LFA Change Request' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Service Addition' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Ongoing' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Not Started')) || (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Cancellation_Approval__c == 'Submitted' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Completion_Approval__c == 'Submitted') || strSelectedstatus == 'Cancelled','none','')};"></td>
                                            <td width="10%" style="color:red;display:{!if(($Profile.Name == 'LFA Portal User' && (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'LFA Change Request' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Service Addition' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Ongoing' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Status__c  == 'Not Started')) || (lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Cancellation_Approval__c == 'Submitted' || lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Completion_Approval__c == 'Submitted') || strSelectedstatus == 'Cancelled','none','')};">
                                                <apex:outputText id="AllPendingAmountCT" value="USD {0, number,###,###,##0}" >
                                                    <apex:param value=""/>
                                                </apex:outputText>
                                            </td>  -->
                                        </tr>
                                        <tr>
                                            <td width="30%" colspan="3" style="display:{!if(isApprover == true && isServiceNotStartedByTGF != true,'','none')}">Approve/Reject Comment: </td>                                            
                                            <td colspan="{!CASE(lstwrapServicesType[intIndexST].lstwrapServices[intIndex].ObjService.Status__c,'LFA Change Request',6,3)}">
                                                <apex:inputTextarea value="{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].strApproveRejectComment}" rendered="{!if(isApprover == true && isServicePending == true && isServiceNotStartedByTGF != true && lstwrapServicesType[intIndexST].lstwrapServices[intIndex].ObjService.Status__c != 'TGF Counter-Proposal',true,false)}" style="width:450px;height:70px;resize:none;"/>
                                                <apex:outputText value="{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].strApproveRejectComment}" rendered="{!!isApprover}"/>
                                            </td>
                                        </tr>                                        
                                    </table>
                                        <script>
                                        var isAddEditResourcesUpdated = 'False'; 
                                        var countCalOnload = 0;
                                        function modifyService(){
                                            var size='{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].lstwrapResource.size}';
                                            var objSelOption = document.getElementById('page:frm:pBlockNew:secStatus:ItemStatus:statusEditable');
                                            /*if(isAddEditResourcesUpdated == "False"){
                                                alert("You have not made a change. Please click \"Back\" instead.");
                                                return false;
                                            }*/
                                            if(document.getElementById('page:frm:pBlockNew:PeriodStartMonth') != null)
                                                var txtPeriodStartMonth = document.getElementById('page:frm:pBlockNew:PeriodStartMonth');
                                            if(document.getElementById('page:frm:pBlockNew:PeriodStartYear') != null)
                                                var txtPeriodStartYear = document.getElementById('page:frm:pBlockNew:PeriodStartYear');
                                            if(document.getElementById('page:frm:pBlockNew:PeriodEndMonth') != null)
                                                var txtPeriodEndMonth = document.getElementById('page:frm:pBlockNew:PeriodEndMonth');
                                            if(document.getElementById('page:frm:pBlockNew:PeriodEndYear') != null)
                                                var txtPeriodEndYear = document.getElementById('page:frm:pBlockNew:PeriodEndYear');
                                            if(txtPeriodStartMonth != null && txtPeriodStartMonth.value != '' && txtPeriodStartYear != null && txtPeriodStartYear.value != '' && txtPeriodStartYear != null && txtPeriodStartYear.value != '' && txtPeriodEndYear != null && txtPeriodEndYear.value != ''){
                                                
                                                txtPeriodStartMonth = dateFullMonth(txtPeriodStartMonth.value);
                                                txtPeriodEndMonth = dateFullMonth(txtPeriodEndMonth.value);
                                                var PeriodStartDate =  Date.parse(txtPeriodStartMonth+' 01, '+ txtPeriodStartYear.value);
                                                var PeriodEndDate =  Date.parse(txtPeriodEndMonth+' 01, '+ txtPeriodEndYear.value); 
                                                
                                                if(PeriodEndDate < PeriodStartDate){
                                                    alert("Programmatic Period Covered End Date must be greater than Start Date.");
                                                    return false;
                                                }
                                            }
                                            var ForecastedStartDate = '';
                                            if(document.getElementById('page:frm:pBlockNew:ForcastedStartDate') != null){
                                                var txtForecastedStartDate = document.getElementById('page:frm:pBlockNew:ForcastedStartDate');
                                                if(txtForecastedStartDate != null && txtForecastedStartDate.value != ''){
                                                    ForecastedStartDate = formatDate(txtForecastedStartDate.value);
                                                }
                                            }
                                            var ForecastedEndDate = '';
                                            if(document.getElementById('page:frm:pBlockNew:ForcastedEndDate') != null){
                                                var txtForecastedEndDate = document.getElementById('page:frm:pBlockNew:ForcastedEndDate');
                                                if(txtForecastedEndDate.value != ''){
                                                    ForecastedEndDate = formatDate(txtForecastedEndDate.value);
                                                }
                                            }
                                            var startDate =  Date.parse(ForecastedStartDate);
                                            var EndDate =  Date.parse(ForecastedEndDate);
                                           
                                            if(ForecastedStartDate != "" && ForecastedEndDate != "" && EndDate < startDate){
                                                alert("Forecasted Service Delivery Period End Date must be greater than Start Date.");
                                                return false;
                                            }
                                            
                                            var checkvalodate = true;
                                            var ContactArray = new Array();
                                            var intArrayIndex = 0;
                                           
                                            for(var i=0;i<size;i++){
                                                if(document.getElementById('page:frm:pBlockNew:pbtable:'+i+':ContactList') != null && document.getElementById('page:frm:pBlockNew:pbtable:'+i+':Rolelist') != null && document.getElementById('page:frm:pBlockNew:pbtable:'+i+':ContactList').style.display == '' && document.getElementById('page:frm:pBlockNew:pbtable:'+i+':Rolelist').style.display == ''){
                                                    if(document.getElementById('page:frm:pBlockNew:pbtable:'+i+':ContactList').value != 'TBD'){
                                                        ContactArray[intArrayIndex] = document.getElementById('page:frm:pBlockNew:pbtable:'+i+':ContactList').value +';'+document.getElementById('page:frm:pBlockNew:pbtable:'+i+':Rolelist').value;
                                                        intArrayIndex++;
                                                    }
                                                }else if(document.getElementById('page:frm:pBlockNew:pbtable:'+i+':hdnContactId') != null && document.getElementById('page:frm:pBlockNew:pbtable:'+i+':hdnRoleId') != null){
                                                    if(document.getElementById('page:frm:pBlockNew:pbtable:'+i+':hdnContactId').innerHTML != 'TBD' && document.getElementById('page:frm:pBlockNew:pbtable:'+i+':hdnContactId').innerHTML != ''){
                                                        ContactArray[intArrayIndex] = document.getElementById('page:frm:pBlockNew:pbtable:'+i+':hdnContactId').innerHTML+';'+document.getElementById('page:frm:pBlockNew:pbtable:'+i+':hdnRoleId').innerHTML;
                                                        intArrayIndex++;
                                                    }
                                                }
                                            }
                                            
                                           /* if(ContactArray.length > 0){
                                                for(var j=0;j<ContactArray.length;j++){
                                                    for(var k=0;k<ContactArray.length;k++){
                                                        if(j != k && ContactArray[j] == ContactArray[k]){
                                                           alert('Each contact can only be assigned once to a service.');
                                                           checkvalodate = false;
                                                           return false;
                                                        }
                                                    }
                                                }
                                            }*/
                                            if(objSelOption.value=="Cancelled" && document.getElementById('page:frm:pBlockNew:inpRationaleCancelRequest') != null && document.getElementById('page:frm:pBlockNew:inpRationaleCancelRequest').value == ''){
                                                alert('Rationale for service cancellation is mandatory');
                                                return false;
                                            }else if(objSelOption.value != "Cancelled" && document.getElementById('page:frm:pBlockNew:inpRationaleChangeRequest') != null  && document.getElementById('page:frm:pBlockNew:inpRationaleChangeRequest').value == ''){
                                                alert('Change request rationale is mandatory');
                                                return false;
                                            }else{
                                                if(confirm('Are you sure you want to submit this service modification? The LFA will be notified of any changes.'))
                                                {
                                                    actmodifyService();
                                                }
                                                return false;
                                            }
                                        }
                                        function validateOtherTGFUser(){
                                           if('{!strErrorMsg}' != ''){
                                               alert('{!strErrorMsg}');
                                           }
                                        }
                                        function CancelChangeRequest(){
                                            if(confirm('Are you sure you wish to cancel?')){
                                                actCancelChangeRequest();
                                            }
                                            return false;
                                        }
                                        function ApproveService(){
                                            /*if(document.getElementById('page:frm:pBlockNew:txtComments').value == ''){
                                                alert("Service Details is Mandatory.");
                                                return false;
                                            }else{
                                                actApprove();
                                                return false;
                                            }*/
                                            if(confirm('Are you sure you wish to approve?')){
                                                actApprove();
                                            }
                                            return false;
                                        }
                                        function RejectService(){
                                            /*if(document.getElementById('page:frm:pBlockNew:txtComments').value == ''){
                                                alert("Service Details is Mandatory.");
                                                return false;
                                            }else{
                                                actReject();
                                                return false;
                                            }*/
                                            if(confirm('Are you sure you wish to reject?')){
                                                actReject();
                                            }
                                            return false;
                                        }
                                        function CounterProposalService(){
                                            if(confirm('Are you sure you wish to submit this counter-proposal?')){
                                                actSubmitCounterProposal();
                                            }
                                            return false;
                                        }
                                        function DeleteResource(DeleteResourceIndex){
                                            if(confirm('Are you sure you want to delete?'))
                                            {
                                                callDeleteResource(DeleteResourceIndex);  
                                            }
                                            return false;
                                        }
                                        function formatDate(Date1){
                                            try{
                                                var strDate = '';
                                                var array
                                                if(Date1.lastIndexOf('/')!=-1){                                                
                                                    array = Date1.split('/');
                                                }else if(Date1.lastIndexOf('.')!=-1){                                                
                                                    array = Date1.split('.');
                                                }
                                                var dd = array[0];
                                                var mm = array[1];
                                                if(mm == '01' || mm == '1') mm = 'January';
                                                if(mm == '02' || mm == '2') mm = 'February';
                                                if(mm == '03' || mm == '3') mm = 'March';
                                                if(mm == '04' || mm == '4') mm = 'April';
                                                if(mm == '05' || mm == '5') mm = 'May';
                                                if(mm == '06' || mm == '6') mm = 'June';
                                                if(mm == '07' || mm == '7') mm = 'July';
                                                if(mm == '08' || mm == '8') mm = 'August';
                                                if(mm == '09' || mm == '9') mm = 'September';
                                                if(mm == '10' || mm == '10') mm = 'October';
                                                if(mm == '11' || mm == '11') mm = 'November';
                                                if(mm == '12' || mm == '12') mm = 'December';
                                                
                                                var yyyy = array[2];
                                                //strDate = yyyy + "-" + mm + "-" + dd;
                                                strDate = mm + " " + dd + ", " + yyyy;
                                                
                                                return strDate;
                                            }catch(err){
                                               // alert("Please enter valid date.");
                                                return null;
                                            }            
                                        }
                                        function dateFullMonth(shortMonth){
                                            
                                            var FullMonth = '';
                                            if(shortMonth == 'Jan') FullMonth = 'January';
                                            if(shortMonth == 'Feb') FullMonth = 'February';
                                            if(shortMonth == 'Mar') FullMonth = 'March';
                                            if(shortMonth == 'Apr') FullMonth = 'April';
                                            if(shortMonth == 'May') FullMonth = 'May';
                                            if(shortMonth == 'Jun') FullMonth = 'June';
                                            if(shortMonth == 'Jul') FullMonth = 'July';
                                            if(shortMonth == 'Aug') FullMonth = 'August';
                                            if(shortMonth == 'Sep') FullMonth = 'September';
                                            if(shortMonth == 'Oct') FullMonth = 'October';
                                            if(shortMonth == 'Nov') FullMonth = 'November';
                                            if(shortMonth == 'Dec') FullMonth = 'December';
                                            return FullMonth;
                                        }
                                        function ValidateRational(){
                                            var size='{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].lstwrapResource.size}';
                                            /*if(isAddEditResourcesUpdated == "False"){
                                                alert("You have not made a change. Please click \"Back\" instead.");
                                                return false;
                                            }*/
                                            if(document.getElementById('page:frm:pBlockNew:PeriodStartMonth') != null)
                                                var txtPeriodStartMonth = document.getElementById('page:frm:pBlockNew:PeriodStartMonth');
                                            if(document.getElementById('page:frm:pBlockNew:PeriodStartYear') != null)
                                                var txtPeriodStartYear = document.getElementById('page:frm:pBlockNew:PeriodStartYear');
                                            if(document.getElementById('page:frm:pBlockNew:PeriodEndMonth') != null)
                                                var txtPeriodEndMonth = document.getElementById('page:frm:pBlockNew:PeriodEndMonth');
                                            if(document.getElementById('page:frm:pBlockNew:PeriodEndYear') != null)
                                                var txtPeriodEndYear = document.getElementById('page:frm:pBlockNew:PeriodEndYear');
                                            if(txtPeriodStartMonth != null && txtPeriodStartMonth.value != '' && txtPeriodStartYear != null && txtPeriodStartYear.value != '' && txtPeriodStartYear != null && txtPeriodStartYear.value != '' && txtPeriodEndYear != null && txtPeriodEndYear.value != ''){
                                                txtPeriodStartMonth = dateFullMonth(txtPeriodStartMonth.value);
                                                txtPeriodEndMonth = dateFullMonth(txtPeriodEndMonth.value);
                                                var PeriodStartDate =  Date.parse(txtPeriodStartMonth+' 01, '+ txtPeriodStartYear.value);
                                                var PeriodEndDate =  Date.parse(txtPeriodEndMonth+' 01, '+ txtPeriodEndYear.value); 
                                                if(PeriodEndDate < PeriodStartDate){
                                                    alert("Programmatic Period Covered End Date must be greater than Start Date.");
                                                    return false;
                                                }
                                            }
                                            var ForecastedStartDate = '';
                                            if(document.getElementById('page:frm:pBlockNew:ForcastedStartDate') != null){
                                                var txtForecastedStartDate = document.getElementById('page:frm:pBlockNew:ForcastedStartDate');
                                                if(txtForecastedStartDate != null && txtForecastedStartDate.value != ''){
                                                    ForecastedStartDate = formatDate(txtForecastedStartDate.value);
                                                }
                                            }
                                            var ForecastedEndDate = '';
                                            if(document.getElementById('page:frm:pBlockNew:ForcastedEndDate') != null){
                                                var txtForecastedEndDate = document.getElementById('page:frm:pBlockNew:ForcastedEndDate');
                                                if(txtForecastedEndDate.value != ''){
                                                    ForecastedEndDate = formatDate(txtForecastedEndDate.value);
                                                }
                                            }
                                            var startDate =  Date.parse(ForecastedStartDate);
                                            var EndDate =  Date.parse(ForecastedEndDate);
                                           
                                            if(ForecastedStartDate != "" && ForecastedEndDate != "" && EndDate < startDate){
                                                alert("Forecasted Service Delivery Period End Date must be greater than Start Date.");
                                                return false;
                                            }
                                            
                                            var checkvalodate = true;
                                            var ContactArray = new Array();
                                            var intArrayIndex = 0;
                                           
                                            for(var i=0;i<size;i++){
                                                if(document.getElementById('page:frm:pBlockNew:pbtable:'+i+':ContactList') != null && document.getElementById('page:frm:pBlockNew:pbtable:'+i+':Rolelist') != null && document.getElementById('page:frm:pBlockNew:pbtable:'+i+':ContactList').style.display == '' && document.getElementById('page:frm:pBlockNew:pbtable:'+i+':Rolelist').style.display == ''){
                                                    if(document.getElementById('page:frm:pBlockNew:pbtable:'+i+':ContactList').value != 'TBD'){
                                                        ContactArray[intArrayIndex] = document.getElementById('page:frm:pBlockNew:pbtable:'+i+':ContactList').value +';'+document.getElementById('page:frm:pBlockNew:pbtable:'+i+':Rolelist').value;
                                                        intArrayIndex++;
                                                    }
                                                }else if(document.getElementById('page:frm:pBlockNew:pbtable:'+i+':hdnContactId') != null && document.getElementById('page:frm:pBlockNew:pbtable:'+i+':hdnRoleId') != null){
                                                    if(document.getElementById('page:frm:pBlockNew:pbtable:'+i+':hdnContactId').innerHTML != 'TBD' && document.getElementById('page:frm:pBlockNew:pbtable:'+i+':hdnContactId').innerHTML != ''){
                                                        ContactArray[intArrayIndex] = document.getElementById('page:frm:pBlockNew:pbtable:'+i+':hdnContactId').innerHTML+';'+document.getElementById('page:frm:pBlockNew:pbtable:'+i+':hdnRoleId').innerHTML;
                                                        intArrayIndex++;
                                                    }
                                                }
                                            }
                                            
                                           /* if(ContactArray.length > 0){
                                                for(var j=0;j<ContactArray.length;j++){
                                                    for(var k=0;k<ContactArray.length;k++){
                                                        if(j != k && ContactArray[j] == ContactArray[k]){
                                                           alert('Each contact can only be assigned once to a service.');
                                                           checkvalodate = false;
                                                           return false;
                                                        }
                                                    }
                                                }
                                            }*/
                                            
                                            for(var i=0;i<size;i++){
                                                
                                                if(document.getElementById('page:frm:pBlockNew:pbtable:'+i+':Rolelist') != null && document.getElementById('page:frm:pBlockNew:pbtable:'+i+':Rolelist').value == ''){
                                                    alert('A role must be selected for each resource.');
                                                    return false;
                                                }
                                            }
                                            if(document.getElementById('page:frm:pBlockNew:inpRationaleChangeRequest') != null && document.getElementById('page:frm:pBlockNew:inpRationaleChangeRequest').style.display == '' && document.getElementById('page:frm:pBlockNew:inpRationaleChangeRequest').value == ''){
                                                alert('Change request rationale is mandatory');
                                                return false;
                                            }else{
                                                if(confirm('Are you sure you want to submit this change request?')){
                                                    actSubmitChangeRequest();
                                                }
                                                return false;
                                            }
                                        }
                                        function statusChange(){
                                            var objSelOption = document.getElementById('page:frm:pBlockNew:secStatus:ItemStatus:statusEditable');
                                            
                                            if(objSelOption.value=="Cancelled"){
                                                document.getElementById('page:frm:pBlockNew:inpRationaleCancelRequest').style.display='';
                                                document.getElementById('page:frm:pBlockNew:inpRationaleChangeRequest').style.display='none';
                                                document.getElementById('page:frm:pBlockNew:ChangeServiceRational').style.display='none';
                                                document.getElementById('page:frm:pBlockNew:CancelServiceRational').style.display='';
                                                document.getElementById('dynamicTotals1').style.display='none';
                                                document.getElementById('dynamicTotals2').style.display='none';
                                                document.getElementById('dynamicTotals3').style.display='none';
                                                document.getElementById('dynamicTotals4').style.display='none';
                                                document.getElementById('dynamicTotals5').style.display='none';
                                                
                                            }else{
                                                document.getElementById('page:frm:pBlockNew:inpRationaleChangeRequest').style.display='';
                                                document.getElementById('page:frm:pBlockNew:inpRationaleCancelRequest').style.display='none';
                                                document.getElementById('page:frm:pBlockNew:ChangeServiceRational').style.display='';
                                                document.getElementById('page:frm:pBlockNew:CancelServiceRational').style.display='none';
                                                document.getElementById('dynamicTotals1').style.display='';
                                                document.getElementById('dynamicTotals2').style.display='';
                                                document.getElementById('dynamicTotals3').style.display='';
                                                document.getElementById('dynamicTotals4').style.display='';
                                                document.getElementById('dynamicTotals5').style.display='';
                                            }
                                            
                                            
                                        }
                                        function CheckStatusChange(){
                                            //if(confirm('You will now be directed to the service completion Review and Submit page.')){
                                                actchnageServiceStatus();
                                            //}
                                            return false;
                                        }
                                        
                                        function ConvertNum(textvalue)
                                        {       
                                            var ReComma = new RegExp("\\,","g");
                                            var ReQuate = new RegExp("\\'","g");
                                            textvalue= textvalue.replace(ReComma,"");
                                            textvalue= textvalue.replace(ReQuate,"");
                                            textvalue= textvalue.replace(",.",".");
                                            textvalue= textvalue.replace("'.","."); 
                                            textvalue= textvalue.replace("$", "");
                                            
                                            /*textvalue= textvalue.replace(/,/g, "");
                                            textvalue= textvalue.replace("'/g", "");*/
                                            var num1 = 0;
                                            if(textvalue.indexOf("USD") != -1){
                                                var indexusd = textvalue.indexOf("USD");
                                                var textvalue1 = textvalue.substring(indexusd+4,textvalue.length);
                                                for(i=0;textvalue1.length;i++)
                                                {    
                                                    if(isNaN(textvalue1[i]))
                                                    {    
                                                        break;
                                                    }
                                                    else
                                                    {   
                                                        num1+=textvalue1[i];
                                                    }
                                                }
                                            }else{
                                                num1=textvalue;
                                            }
                                            var num= parseFloat(num1);
                                            num=num.toFixed(2);
                                            if(isNaN(num)){
                                                return 0;
                                            }else{
                                                return num;
                                            }                
                                        }
                                       
                                        function validateLOEForTBD(LOEid,ImageId,contactId){
                                            if(document.getElementById(ImageId) != null && document.getElementById(contactId) != null && document.getElementById(contactId).value == 'TBD'){
                                                if(LOEid.value == 0){
                                                    document.getElementById(ImageId).style.display = 'none';
                                                }else{
                                                    document.getElementById(ImageId).style.display = 'block';
                                                }
                                            }
                                            Calculation();
                                        }
                                        function AutoFillLFALOE(){
                                            var LFALOE = 0;
                                            var LOE = 0;
                                            LOE = ConvertNum(document.getElementById("page:frm:pBlockNew:pbtable:"+i+":txtLOE").value);
                                            /*if(document.getElementById("page:frm:pBlockNew:pbtable:"+i+":txtLOE") != null)
                                                LOE = ConvertNum(document.getElementById("page:frm:pBlockNew:pbtable:"+i+":txtLOE").value);
                                            }else{
                                                LOE = ConvertNum(document.getElementById("page:frm:pBlockNew:pbtable:"+i+":txtLOE1").value);
                                            }*/
                                            LFALOE = LOE;
                                            var decLFALOE = LFALOE.toFixed(0);
                                            document.getElementById("page:frm:pBlockNew:pbtable:txtLFALOE").innerHTML = addCommasLOE(decLFALOE);
                                        }
                                         
                                        function Calculation(){       
                                            var size='{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].lstwrapResource.size}';
                                             
                                            var TotalPOLOE = 0;
                                            var TotalPOCost = 0;
                                            var TotalLOE = 0;
                                            var TotalCost =0;
                                            var TotalLFALOE = 0;
                                            var TotalLFACost = 0;
                                            var TotalCTPLOE = 0;
                                            var TotalCTPCost = 0;
                                            var TotalPLOE = 0;
                                            var TotalPCost = 0;
                                           
                                            for(var i=0;i<size;i++)
                                            {
                                                var POLOE = 0; 
                                                if(document.getElementById("page:frm:pBlockNew:pbtable:"+i+":txtPOLOE") != null){
                                                    var objTxtPOLOE = document.getElementById("page:frm:pBlockNew:pbtable:"+i+":txtPOLOE");
                                                    POLOE = ConvertNum(objTxtPOLOE.innerHTML);
                                                    TotalPOLOE += parseFloat(POLOE); 
                                                }
                                                var LOE = 0;   
                                                var objTxtLOE;                                             
                                                if(document.getElementById("page:frm:pBlockNew:pbtable:"+i+":txtLOE") != null){
                                                    if(isNaN(document.getElementById("page:frm:pBlockNew:pbtable:"+i+":txtLOE").value)){
                                                        alert('Please enter a valid Budgeted LOE value.');
                                                        return false;
                                                    }
                                                    
                                                    LOE = ConvertNum(document.getElementById("page:frm:pBlockNew:pbtable:"+i+":txtLOE").value);
                                                }else if(document.getElementById("page:frm:pBlockNew:pbtable:"+i+":otxtLOE") != null){
                                                    LOE = ConvertNum(document.getElementById("page:frm:pBlockNew:pbtable:"+i+":otxtLOE").innerHTML);
                                                }
                                                if(LOE != ''){
                                                    TotalLOE += parseFloat(LOE); 
                                                }else{
                                                    TotalLOE = TotalLOE ; 
                                                }
                                                //TotalLOE += parseFloat(LOE); 
                                                var PLOE = 0;                  
                                                var objTxtPLOE;                
                                                if(document.getElementById("page:frm:pBlockNew:pbtable:"+i+":txtProposedLOE") != null){
                                                    if(isNaN(document.getElementById("page:frm:pBlockNew:pbtable:"+i+":txtProposedLOE").value)){
                                                        alert('Please enter a valid Proposed LOE value.');
                                                        return false;
                                                    }
                                                    PLOE = ConvertNum(document.getElementById("page:frm:pBlockNew:pbtable:"+i+":txtProposedLOE").value);
                                                }else if(document.getElementById("page:frm:pBlockNew:pbtable:"+i+":otxtProposedLOE") != null){
                                                    PLOE = ConvertNum(document.getElementById("page:frm:pBlockNew:pbtable:"+i+":otxtProposedLOE").innerHTML);
                                                }
                                                  
                                                TotalPLOE += parseFloat(PLOE);
                                                var CTPLOE = 0;
                                                if(document.getElementById("page:frm:pBlockNew:pbtable:"+i+":txtCTProposedLOE") != null || document.getElementById("page:frm:pBlockNew:pbtable:"+i+":otxtCTProposedLOE") != null){
                                                    if(document.getElementById("page:frm:pBlockNew:pbtable:"+i+":txtCTProposedLOE") != null){
                                                        if(isNaN(document.getElementById("page:frm:pBlockNew:pbtable:"+i+":txtCTProposedLOE").value)){
                                                            alert('Please enter a valid CT Proposed LOE value.');
                                                            return false;
                                                        }
                                                        var CTPLOE = ConvertNum(document.getElementById("page:frm:pBlockNew:pbtable:"+i+":txtCTProposedLOE").value);
                                                    }else if(document.getElementById("page:frm:pBlockNew:pbtable:"+i+":otxtCTProposedLOE") != null){
                                                        var CTPLOE = ConvertNum(document.getElementById("page:frm:pBlockNew:pbtable:"+i+":otxtCTProposedLOE").innerHTML);
                                                    }
                                                    TotalCTPLOE += parseFloat(CTPLOE);
                                                }
                                                var Rate = 0;
                                                if(document.getElementById("page:frm:pBlockNew:pbtable:"+i+":inpRate") != null)
                                                {
                                                    if(document.getElementById("page:frm:pBlockNew:pbtable:"+i+":inpRate").tagName == 'INPUT'){
                                                         Rate = ConvertNum(document.getElementById("page:frm:pBlockNew:pbtable:"+i+":inpRate").value);
                                                     }else{
                                                         Rate = ConvertNum(document.getElementById("page:frm:pBlockNew:pbtable:"+i+":inpRate").innerHTML);
                                                     }
                                                } 
                                                else if(document.getElementById("page:frm:pBlockNew:pbtable:"+i+":optRate") != null)
                                                {    
                                                     Rate = ConvertNum(document.getElementById("page:frm:pBlockNew:pbtable:"+i+":optRate").innerHTML);
                                                }
                                                
                                                var Cost = parseFloat(LOE) * Rate; 
                                                var iCost = parseFloat(Cost).toFixed(0);
                                                TotalCost = parseFloat(TotalCost) + parseFloat(iCost) ; 
                                                
                                                //TotalCost +=Cost;
                                                var decCost = Cost.toFixed(0);
                                                
                                                
                                                var POCost = parseFloat(POLOE) * Rate; 
                                                var iPOCost = parseFloat(POCost).toFixed(0);
                                                TotalPOCost = parseFloat(TotalPOCost)  + parseFloat(iPOCost);
                                                var decPOCost = POCost.toFixed(0);
                                                
                                                
                                                var PCost = parseFloat(PLOE) * Rate;
                                                var iPCost = parseFloat(PCost).toFixed(0);
                                                TotalPCost = parseFloat(TotalPCost) + parseFloat(iPCost) ; 
                                                //TotalPCost += PCost;
                                                var decPCost = PCost.toFixed(0);
                                                
                                                var decCTPCost = 0;
                                                if(CTPLOE != 0){
                                                    var CTPCost = parseFloat(CTPLOE) * Rate; 
                                                    var iCTPCost = parseFloat(CTPCost).toFixed(0);
                                                    TotalCTPCost = parseFloat(TotalCTPCost) + parseFloat(iCTPCost) ;
                                                    //TotalCTPCost += CTPCost;
                                                    decCTPCost = CTPCost.toFixed(0);
                                                }
                                                if(document.getElementById("page:frm:pBlockNew:pbtable:"+i+":inpCost") != null){
                                                    if(decCost == 0){
                                                        document.getElementById("page:frm:pBlockNew:pbtable:"+i+":inpCost").innerHTML = '';
                                                    }else{
                                                        document.getElementById("page:frm:pBlockNew:pbtable:"+i+":inpCost").innerHTML = addCommas(decCost);
                                                    }
                                                }
                                                if(document.getElementById("page:frm:pBlockNew:pbtable:"+i+":txtPOCost") != null){
                                                    if(decPOCost == 0){
                                                        document.getElementById("page:frm:pBlockNew:pbtable:"+i+":txtPOCost").innerHTML = '';
                                                    }else{
                                                        document.getElementById("page:frm:pBlockNew:pbtable:"+i+":txtPOCost").innerHTML = addCommas(decPOCost);
                                                    } 
                                                }
                                                if(document.getElementById("page:frm:pBlockNew:pbtable:"+i+":txtProposedCost") != null){
                                                    if(decPCost == 0){
                                                        document.getElementById("page:frm:pBlockNew:pbtable:"+i+":txtProposedCost").innerHTML = '';
                                                    }else{
                                                        document.getElementById("page:frm:pBlockNew:pbtable:"+i+":txtProposedCost").innerHTML = addCommas(decPCost);
                                                    }     
                                                }
                                                if(document.getElementById("page:frm:pBlockNew:pbtable:"+i+":txtCTProposedCost") != null && decCTPCost == 0){
                                                    document.getElementById("page:frm:pBlockNew:pbtable:"+i+":txtCTProposedCost").innerHTML = '';
                                                }else if(document.getElementById("page:frm:pBlockNew:pbtable:"+i+":txtCTProposedCost") != null){
                                                    document.getElementById("page:frm:pBlockNew:pbtable:"+i+":txtCTProposedCost").innerHTML = addCommas(decCTPCost);
                                                }                                                     
                                            }
                                            if(TotalCTPLOE != 0){
                                                TotalCTPLOE = TotalCTPLOE.toString();
                                                if(TotalCTPLOE.indexOf(".") == -1) TotalCTPLOE = TotalCTPLOE+".00";
                                                if(TotalCTPLOE == 0) var decTotalCTPLOE = '';
                                                else var decTotalCTPLOE = parseFloat(TotalCTPLOE).toFixed(2);
                                                if(document.getElementById("page:frm:pBlockNew:pbtable:txtTotalCTProposedLOE") != null){
                                                    if(decTotalCTPLOE != '' && decTotalCTPLOE != 0){
                                                        document.getElementById("page:frm:pBlockNew:pbtable:txtTotalCTProposedLOE").innerHTML = addCommasLOE(decTotalCTPLOE);
                                                    }else{
                                                        document.getElementById("page:frm:pBlockNew:pbtable:txtTotalCTProposedLOE").innerHTML = '';
                                                    }
                                                }
                                            }else{
                                                if(document.getElementById("page:frm:pBlockNew:pbtable:txtTotalCTProposedLOE") != null){
                                                    document.getElementById("page:frm:pBlockNew:pbtable:txtTotalCTProposedLOE").innerHTML = '';
                                                }
                                            }
                                            
                                            if(TotalPLOE != 0){
                                                TotalPLOE = TotalPLOE.toString();
                                                if(TotalPLOE.indexOf(".") == -1) TotalPLOE = TotalPLOE+".00";
                                            }
                                            if(TotalPLOE == 0) var decTotalPLOE = '';
                                            else var decTotalPLOE = parseFloat(TotalPLOE).toFixed(2);
                                             //document.getElementById("page:frm:pBlockNew:pbtable:txtTotalProposedLOE").innerHTML = TotalPLOE.toString();
                                            if(document.getElementById("page:frm:pBlockNew:pbtable:txtTotalProposedLOE") != null){
                                                if(decTotalPLOE != '' && decTotalPLOE != 0){
                                                    document.getElementById("page:frm:pBlockNew:pbtable:txtTotalProposedLOE").innerHTML = addCommasLOE(decTotalPLOE);
                                                    
                                                }else{
                                                    document.getElementById("page:frm:pBlockNew:pbtable:txtTotalProposedLOE").innerHTML = '';
                                                    
                                                }
                                            }
                                            TotalPOLOE = TotalPOLOE.toString();
                                            if(TotalPOLOE.indexOf(".") == -1) TotalPOLOE = TotalPOLOE+".00";
                                            if(TotalPOLOE == 0) var decTotalPOLOE = '';
                                            else var decTotalPOLOE = parseFloat(TotalPOLOE).toFixed(2);
                                            
                                            if(document.getElementById("page:frm:pBlockNew:pbtable:txtTotalPOLOE") != null){
                                                if(decTotalPOLOE != '' && decTotalPOLOE != 0){
                                                    document.getElementById("page:frm:pBlockNew:pbtable:txtTotalPOLOE").innerHTML = addCommasLOE(decTotalPOLOE);
                                                }else{
                                                    document.getElementById("page:frm:pBlockNew:pbtable:txtTotalPOLOE").innerHTML = '';
                                                }
                                            }
                                            
                                            var decTotalPOCost = parseFloat(TotalPOCost).toFixed(0);

                                            if(decTotalPOCost != '' && decTotalPOCost != 0){
                                                if(countCalOnload != 0){
                                                    var WpPoValue = ConvertNum(document.getElementById("page:frm:pBlockNew:optPOlabor").innerHTML) - ConvertNum(document.getElementById("page:frm:pBlockNew:pbtable:txtTotalPOCost").innerHTML);
                                                    WpPoValue = parseFloat(WpPoValue) + parseFloat(decTotalPOCost);
                                                    document.getElementById("page:frm:pBlockNew:optPOlabor").innerHTML = addCommas(WpPoValue);
                                                    if(document.getElementById("page:frm:pBlockNew:pbtable:txtTotalCTProposedCost") != null){
                                                        document.getElementById("page:frm:pBlockNew:optPOlaborCT").innerHTML = addCommas(WpPoValue);
                                                    }
                                                }
                                                if(document.getElementById("page:frm:pBlockNew:pbtable:txtTotalPOCost") != null){
                                                    document.getElementById("page:frm:pBlockNew:pbtable:txtTotalPOCost").innerHTML = addCommas(decTotalPOCost);
                                                }
                                                //document.getElementById("page:frm:pBlockNew:optPOlabor").innerHTML = addCommas(decTotalPOCost);
                                            }else{
                                                if(document.getElementById("page:frm:pBlockNew:pbtable:txtTotalPOCost") != null){
                                                    document.getElementById("page:frm:pBlockNew:pbtable:txtTotalPOCost").innerHTML = '';
                                                }
                                                //document.getElementById("page:frm:pBlockNew:optPOlabor").innerHTML = '';
                                            }
                                            var decTotalPCost = parseFloat(TotalPCost).toFixed(0);
                                            if(decTotalPCost != '' && decTotalPCost != 0){
                                                if(document.getElementById("page:frm:pBlockNew:pbtable:txtTotalProposedCost") != null){
                                                    document.getElementById("page:frm:pBlockNew:pbtable:txtTotalProposedCost").innerHTML = addCommas(decTotalPCost);
                                                }
                                                
                                                var POBudget = 0;
                                                if(document.getElementById("page:frm:pBlockNew:optTotalBudget") != null){
                                                    POBudget = ConvertNum(document.getElementById("page:frm:pBlockNew:optTotalBudget").innerHTML);
                                                }
                                                var POLaber = 0;
                                                if(document.getElementById("page:frm:pBlockNew:optPOlabor") != null){
                                                    POLabor = ConvertNum(document.getElementById("page:frm:pBlockNew:optPOlabor").innerHTML);
                                                }
                                                var tempCost = 0;
                                                if(TotalCost != 0){
                                                    tempCost = parseFloat(TotalCost).toFixed(0);
                                                }else{
                                                    tempCost = parseFloat(ConvertNum('{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Cost__c}'));
                                                } 
                                                var finalPropCost =  parseFloat(POBudget) + parseFloat(decTotalPCost - tempCost);
                                                var finalCTCost =  parseFloat(finalPropCost) - parseFloat(POLabor);
                                                if(finalPropCost > 0){
                                                    document.getElementById("page:frm:pBlockNew:optLfaPropCost").innerHTML = addCommas(finalPropCost);
                                                }else{
                                                    document.getElementById("page:frm:pBlockNew:optLfaPropCost").innerHTML = '';
                                                }
                                                if(finalCTCost != 0){
                                                    document.getElementById("page:frm:pBlockNew:optFcastLfaProp").innerHTML = addCommas(finalCTCost);
                                                }else{
                                                    document.getElementById("page:frm:pBlockNew:optFcastLfaProp").innerHTML = '';
                                                }
                                            }else{
                                                if(document.getElementById("page:frm:pBlockNew:pbtable:txtTotalProposedCost") != null){
                                                    document.getElementById("page:frm:pBlockNew:pbtable:txtTotalProposedCost").innerHTML = '';
                                                }
                                            }

                                            if(TotalCTPCost != 0){
                                                var decTotalCTPCost = parseFloat(TotalCTPCost).toFixed(0);
                                                if(decTotalCTPCost != '' && decTotalCTPCost != 0){
                                                    var PoBudget = 0;
                                                    if(document.getElementById("page:frm:pBlockNew:optTotalBudget") != null){
                                                        PoBudget = ConvertNum(document.getElementById("page:frm:pBlockNew:optTotalBudget").innerHTML);
                                                    }
                                                    var PoLaber = 0;
                                                    if(document.getElementById("page:frm:pBlockNew:optPOlabor") != null){
                                                        POLabor = ConvertNum(document.getElementById("page:frm:pBlockNew:optPOlabor").innerHTML);
                                                    }
                                                    var tempCost = 0;
                                                    if(TotalCost != 0){
                                                        tempCost = parseFloat(TotalCost).toFixed(0);
                                                    }else{
                                                        tempCost = parseFloat(ConvertNum('{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Cost__c}'));
                                                    } 
                                                    var finalPropCost =  parseFloat(PoBudget) + parseFloat(decTotalCTPCost - tempCost);
                                                    var finalCTCost =  parseFloat(finalPropCost) - parseFloat(POLabor);
                                                    if(document.getElementById("page:frm:pBlockNew:pbtable:txtTotalCTProposedCost") != null){
                                                        document.getElementById("page:frm:pBlockNew:optLfaPropCostCT").innerHTML = addCommas(finalPropCost);
                                                        document.getElementById("page:frm:pBlockNew:optFcastLfaPropCT").innerHTML = addCommas(finalCTCost);
                                                        document.getElementById("page:frm:pBlockNew:pbtable:txtTotalCTProposedCost").innerHTML = addCommas(decTotalCTPCost);
                                                    }else{
                                                        if(document.getElementById("page:frm:pBlockNew:optLfaPropCostCT") != null){
                                                            document.getElementById("page:frm:pBlockNew:optLfaPropCostCT").innerHTML = '';
                                                        }
                                                        if(document.getElementById("page:frm:pBlockNew:optFcastLfaPropCT") != null){
                                                            document.getElementById("page:frm:pBlockNew:optFcastLfaPropCT").innerHTML = '';
                                                        }
                                                    }
                                                    
                                                }else{
                                                    if(document.getElementById("page:frm:pBlockNew:pbtable:txtTotalCTProposedCost") != null){
                                                        document.getElementById("page:frm:pBlockNew:pbtable:txtTotalCTProposedCost").innerHTML = '';
                                                    }
                                                }
                                            }else{
                                                if(document.getElementById("page:frm:pBlockNew:pbtable:txtTotalCTProposedCost") != null){
                                                    document.getElementById("page:frm:pBlockNew:pbtable:txtTotalCTProposedCost").innerHTML = '';
                                                }
                                            }
                                            TotalLOE = TotalLOE.toString();
                                            if(TotalLOE.indexOf(".") == -1) TotalLOE = TotalLOE+".00";
                                            if(TotalLOE == 0) var decTotalLOE = '';
                                            else var decTotalLOE  = parseFloat(TotalLOE).toFixed(2);
                                            //var decTotalLOE  = parseFloat(TotalLOE).toFixed(2);
                                            var decTotalCost = parseFloat(TotalCost).toFixed(0);
                                            if(document.getElementById("page:frm:pBlockNew:pbtable:txtTotalLOE") != null){
                                                if(decTotalLOE != '' && decTotalLOE != 0){
                                                    document.getElementById("page:frm:pBlockNew:pbtable:txtTotalLOE").innerHTML = addCommasLOE(decTotalLOE);
                                                }else{
                                                    document.getElementById("page:frm:pBlockNew:pbtable:txtTotalLOE").innerHTML = '';
                                                }
                                            }
                                            if(decTotalCost != '' && decTotalCost != 0){
                                                if(countCalOnload != 0){
                                                    var WpPoBudget = ConvertNum(document.getElementById("page:frm:pBlockNew:optTotalBudget").innerHTML) - ConvertNum(document.getElementById("page:frm:pBlockNew:pbtable:txtTotalCost").innerHTML);
                                                    WpPoBudget = parseFloat(WpPoBudget) + parseFloat(decTotalCost);
                                                    document.getElementById("page:frm:pBlockNew:optTotalBudget").innerHTML = addCommas(WpPoBudget);
                                                    if(document.getElementById("page:frm:pBlockNew:pbtable:txtTotalCTProposedCost") != null){
                                                        document.getElementById("page:frm:pBlockNew:optTotalBudgetCT").innerHTML = addCommas(WpPoBudget);
                                                    }
                                                }
                                                if(document.getElementById("page:frm:pBlockNew:pbtable:txtTotalCost") != null){
                                                    document.getElementById("page:frm:pBlockNew:pbtable:txtTotalCost").innerHTML = addCommas(decTotalCost);
                                                }
                                            }else{
                                                if(document.getElementById("page:frm:pBlockNew:pbtable:txtTotalCost") != null){
                                                    document.getElementById("page:frm:pBlockNew:pbtable:txtTotalCost").innerHTML = '';
                                                }
                                            }
                                            var proposedCostForDT = 0;
                                            var CTCostForDT = 0;
                                            var CostForDT = 0;
                                            var ExistproposedCostForDT = parseFloat(ConvertNum('{!ProposedCostDT}'));
                                            var ExistCTCostForDT = parseFloat(ConvertNum('{!CTProposedCostDT}'));
                                            var ExistCostForDT = parseFloat(ConvertNum('{!CostDT}'));

                                            if(document.getElementById("page:frm:pBlockNew:pbtable:txtTotalProposedCost") != null && document.getElementById("page:frm:pBlockNew:pbtable:txtTotalProposedCost").innerHTML != ''){
                                                proposedCostForDT = parseFloat(ConvertNum(document.getElementById("page:frm:pBlockNew:pbtable:txtTotalProposedCost").innerHTML));
                                            }

                                            if(document.getElementById("page:frm:pBlockNew:pbtable:txtTotalCTProposedCost") != null && document.getElementById("page:frm:pBlockNew:pbtable:txtTotalCTProposedCost").innerHTML != ''){
                                                CTCostForDT = parseFloat(ConvertNum(document.getElementById("page:frm:pBlockNew:pbtable:txtTotalCTProposedCost").innerHTML));
                                            }

                                            if(document.getElementById("page:frm:pBlockNew:pbtable:txtTotalCost") != null && document.getElementById("page:frm:pBlockNew:pbtable:txtTotalCost").innerHTML != ''){
                                                CostForDT = parseFloat(ConvertNum(document.getElementById("page:frm:pBlockNew:pbtable:txtTotalCost").innerHTML));
                                            }else{
                                                CostForDT = parseFloat(ConvertNum('{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Cost__c}'));
                                            } 
                                            if(document.getElementById("page:frm:pBlockNew:AllPendingAmountPL")!=null){
                                                document.getElementById("page:frm:pBlockNew:AllPendingAmountPL").innerHTML = addCommas((ExistproposedCostForDT + proposedCostForDT) - (ExistCostForDT + CostForDT));
                                            }

                                            if(document.getElementById("page:frm:pBlockNew:AllPendingAmountCT") !=null && (ExistCTCostForDT != 0 || CTCostForDT != 0)){
                                                document.getElementById("page:frm:pBlockNew:AllPendingAmountCT").innerHTML = addCommas((ExistCTCostForDT+CTCostForDT)- (ExistCostForDT + CostForDT));
                                            }
                                            //alert(76);
                                            countCalOnload = 1;
                                            for(var i=0;i<size;i++)
                                            {
                                                var LFALOE = 0;
                                                var objTxtLFALOE;
                                                if(document.getElementById("page:frm:pBlockNew:pbtable:"+i+":txtLFALOE") != null){
                                                    objTxtLFALOE = document.getElementById("page:frm:pBlockNew:pbtable:"+i+":txtLFALOE");
                                                    LFALOE = ConvertNum(objTxtLFALOE.value);
                                                }else if(document.getElementById("page:frm:pBlockNew:pbtable:"+i+":ofLFALOE") != null){
                                                    objTxtLFALOE = document.getElementById("page:frm:pBlockNew:pbtable:"+i+":ofLFALOE");
                                                    LFALOE = ConvertNum(objTxtLFALOE.innerHTML);
                                                }                                                
                                                TotalLFALOE += parseFloat(LFALOE);  
                                                var Rate =0;
                                                if(document.getElementById("page:frm:pBlockNew:pbtable:"+i+":inpRate") != null)
                                                {
                                                    if(document.getElementById("page:frm:pBlockNew:pbtable:"+i+":inpRate").tagName == 'INPUT'){
                                                         Rate = ConvertNum(document.getElementById("page:frm:pBlockNew:pbtable:"+i+":inpRate").value);
                                                     }else{
                                                         Rate = ConvertNum(document.getElementById("page:frm:pBlockNew:pbtable:"+i+":inpRate").innerHTML);
                                                     }
                                                } 
                                                else if(document.getElementById("page:frm:pBlockNew:pbtable:"+i+":optRate") != null)
                                                {    
                                                     Rate = ConvertNum(document.getElementById("page:frm:pBlockNew:pbtable:"+i+":optRate").innerHTML);
                                                }
                                                var LFACost = LFALOE * Rate;  
                                                TotalLFACost +=LFACost;
                                                var decLFACost = LFACost.toFixed(0);
                                                if(document.getElementById("page:frm:pBlockNew:pbtable:"+i+":inpLFACost") != null){
                                                    document.getElementById("page:frm:pBlockNew:pbtable:"+i+":inpLFACost").innerHTML = addCommas(decLFACost); ;  
                                                }
                                                                                                              
                                            }
                                            TotalLFALOE = TotalLFALOE.toString();
                                            if(TotalLFALOE.indexOf(".") == -1) TotalLFALOE = TotalLFALOE+".00";
                                            if(TotalLFALOE == 0) TotalLFALOE = '';
                                            var decTotalLFALOE  = parseFloat(TotalLFALOE).toFixed(2);
                                            var decTotalLFACost = parseFloat(TotalLFACost).toFixed(0);
                                            if(document.getElementById("page:frm:pBlockNew:pbtable:txtTotalLFALOE") != null){
                                                document.getElementById("page:frm:pBlockNew:pbtable:txtTotalLFALOE").innerHTML = addCommasLOE(decTotalLFALOE);
                                            }
                                            if(document.getElementById("page:frm:pBlockNew:pbtable:txtTotalLFACost") != null){
                                                document.getElementById("page:frm:pBlockNew:pbtable:txtTotalLFACost").innerHTML = addCommas(decTotalLFACost);
                                            }
                                            
                                        }
                                        function addCommas(nStr)
                                        {
                                            
                                                nStr += '';
                                                x = nStr.split('.');
                                                x1 = x[0];
                                                x2 = x.length > 1 ? '.' + x[1] : '';
                                                var rgx = /(\d+)(\d{3})/;
                                                while (rgx.test(x1)) {
                                                    x1 = x1.replace(rgx, '$1' + ',' + '$2');
                                                }
                                                return 'USD ' + x1 + x2;
                                           
                                        }
                                        function addCommasLOE(nStr)
                                        {
                                            nStr += '';
                                            x = nStr.split('.');
                                            x1 = x[0];
                                            x2 = x.length > 1 ? '.' + x[1] : '';
                                            var rgx = /(\d+)(\d{3})/;
                                            while (rgx.test(x1)) {
                                                x1 = x1.replace(rgx, '$1' + ',' + '$2');
                                            }
                                            return + x1 + x2;
                                        }
                                        /*function number_format(input_){
                                            if(input_>0){
                                                var input_string=input_.toString();
                                                var rebuild='';
                                                var rebuild_remaining=input_string;
                                                var loop_='no';
                                                for(i=0; rebuild_remaining.length>3; i++){
                                                    loop_='yes';
                                                    rebuild = rebuild_remaining.substr((rebuild_remaining.length-3),3)+','+rebuild;
                                                    rebuild_remaining=rebuild_remaining.substr(0,(rebuild_remaining.length-3));
                                                }
                                                if(loop_==='yes'){
                                                    rebuild = rebuild_remaining+','+rebuild;
                                                    rebuild = rebuild.substr(0,(rebuild.length-1));
                                                }else{
                                                    rebuild=input_string;
                                                }
                                                rebuild= rebuild.replace(",.",".");
                                                return 'USD '+rebuild;
                                            }else{
                                                return '';
                                            }            
                                        }*/
                                        
                                        Calculation(); 
                                        
                                        
                                        function ValidateLOE(){
                                            var size='{!lstwrapServicesType[intIndexST].lstwrapServices[intIndex].lstwrapResource.size}';
                                            var WpStatus = '{!LFA_Work_Plan__c.Status__c}';
                                            var checkvalodate = true;
                                            var ContactArray = new Array();
                                            var intArrayIndex = 0;
                                            
                                            for(var i=0;i<size;i++){
                                               if(document.getElementById('page:frm:pBlockNew:pbtable:'+i+':txtLOE') != null && document.getElementById('page:frm:pBlockNew:pbtable:'+i+':txtLOE').value == 0 && WpStatus == 'CT Planning'){
                                                   alert('The LOE for a resource cannot be blank.');
                                                   checkvalodate = false;
                                                   return false;
                                               }
                                               if(document.getElementById('page:frm:pBlockNew:pbtable:'+i+':txtLOE') != null && document.getElementById('page:frm:pBlockNew:pbtable:'+i+':txtLOE').value == ''){
                                                   alert('LOE must not be null.');
                                                   checkvalodate = false;
                                                   return false;
                                               }
                                               if(document.getElementById('page:frm:pBlockNew:pbtable:'+i+':ContactList').value != 'TBD'){
                                                   ContactArray[intArrayIndex] = document.getElementById('page:frm:pBlockNew:pbtable:'+i+':ContactList').value +';'+document.getElementById('page:frm:pBlockNew:pbtable:'+i+':Rolelist').value;
                                                   intArrayIndex++;
                                               }
                                            }
                                            
                                           /* for(var j=0;j<ContactArray.length;j++){
                                                for(var k=0;k<ContactArray.length;k++){
                                                    if(j != k && ContactArray[j] == ContactArray[k]){
                                                       alert('Each contact can only be assigned once to a service.');
                                                       checkvalodate = false;
                                                       return false;
                                                    }
                                                }
                                            }*/
                                            if(checkvalodate == true){
                                               actSaveResources();
                                               return false;
                                            }
                                        }  
                                        function toggleDescPopup(PopUp){
                                            var el = document.getElementById(PopUp);                              
                                            if (el.style.display != 'none') {
                                                el.style.display = 'none';
                                            }
                                            else {
                                                el.style.display = '';
                                            }
                                        }      
                                                 
                                        </script>
                                        <style>
                                             .datePicker{
                                                position:absolute;
                                                z-index: 999;
                                            }
                                        </style>
                                </apex:outputPanel>
                                    
                                        
                            </apex:pageBlock>
                        </td>
                    </tr>
                    <tr>
                        <td class="resourcetTable">
                            <div id="boxscroll" class="chatterFeedPanel">
                                <apex:iframe id="ResourceChatter" height="225px" scrolling="true" rendered="{!if(blnHasNewChild==true,true,false)}" src="{!if($Profile.Name = 'LFA Portal User','/LFA','')}/apex/ServiceChatter?ServiceId={!if(blnHasNewChild==true,lstwrapServicesType[intIndexST].lstwrapServices[intIndex].objService.Id,'')}" />
                            </div>
                        </td>
                    </tr>
                </table>
            </apex:outputPanel>
        </apex:outputPanel>
        <style>
        .ProcessingBackground
        {
            background-color: black;
            opacity: 0.50;
            filter: alpha(opacity = 50);
            width: 100%;
            height: 100%;
            position: fixed;
            z-index: 9999;
            top:0;
            left:0;
        }
        .Processing
        {
            z-index: 9999;
            left: 50%;
            top: 50%;
            text-align: center;
            position: fixed;
        }        
        </style>
        <div id="divProcessing" style="display:none;">
            <div class="ProcessingBackground"></div>
            <div class="Processing">
                <apex:image alt="Processing" url="{!$Resource.LoadingCircle}" />
            </div>
        </div>  
        <apex:actionStatus id="Processing" onstart="document.getElementById('divProcessing').style.display = '';" onstop="document.getElementById('divProcessing').style.display = 'none';">                            
        </apex:actionStatus> 
        
    <script type="text/javascript">  
        alternate();
        function CheckAll(CheckAllId){
            var TotalRows = '{!lstServiceForSearch.size}';
            for(var i=0;i<TotalRows;i++){
                if(CheckAllId.checked == true){
                    document.getElementById('page:frm:pbSearch:repSearch:'+i+':inpCheck').checked = true;
                }else{
                    document.getElementById('page:frm:pbSearch:repSearch:'+i+':inpCheck').checked = false;
                }   
            }
        }
        function uncheckAll(CheckAllId){
            var TotalRows = '{!lstServiceForSearch.size}';
            Count = 0;
            for(var i=0;i<TotalRows;i++){
                if(document.getElementById('page:frm:pbSearch:repSearch:'+i+':inpCheck').checked == true){
                    Count ++;
                }
            }
            if(Count == TotalRows){
                document.getElementById(CheckAllId).checked = true;
            }else{
                document.getElementById(CheckAllId).checked = false;
            }
        }
        
         function setPopupheight(){
            var strmsg = '{!strMessage}';
            if(strmsg != ''){
                alert(strmsg);
                return false;
            }
            var offsetheight = document.getElementById('page:frm:hdnintOffsetTop').value;
            offsetheight -= 350;
           
            document.getElementById('page:frm:custPopup').style.top = offsetheight + 'px';
        }   
        function setPopupheightSave(){
            var offsetheight = document.getElementById('page:frm:hdnsetTop').value;
            offsetheight -= 150;
            document.getElementById('page:frm:custPopup').style.top = '50%';//offsetheight+'px';
        }   
        function alternate(){ 
            if(document.getElementsByTagName){  
                var table = document.getElementById("ServiceTable");   
                var rows = table.getElementsByTagName("tr"); 
                for(i = 0; i < rows.length; i++){    
                    if(i == rows.length-1){
                        //rows[i].className = "footer"; 
                    }else{
                        if(i % 2 == 0){ 
                                rows[i].className = rows[i].className + " even "; 
                           
                        }else{ 
                            rows[i].className = rows[i].className + " odd "; 
                        }  
                    }     
                } 
            } 
        }
        function abc(){
            
        }
        $(document).ready(abc);       
      
    </script>
        
    </apex:form>
    
    <style type="text/css">
         .custPopup{
            background-color: white;
            border-width: 0px;
            border-radius:10px;
            border-style: solid;
            /*z-index: 9999;*/
            z-index: 51;
            left: 10%;
            padding:10px;
            position: absolute;
            top:50%;
            width:80%;
        }
        .popupBackground{
            background-color:black;
            opacity: 0.20;
            filter: alpha(opacity = 20);
            position: absolute;
            width: 100%;
            height: 100%;
            /*z-index: 9998;*/
            z-index: 50;
            top: 0;
            left: 0;
           
        }
        .custPopupNew{
            background-color: white;
            border-width: 0px;
            border-radius:10px;
            border-style: solid;
            /*z-index: 9999;*/
            z-index: 101;
            left: 10%;
            padding:10px;
            position: absolute;
            top:15%;
            width:80%;
        }
        .popupBackgroundNew{
            background-color:black;
            opacity: 0.20;
            filter: alpha(opacity = 20);
            position: absolute;
            width: 100%;
            height: 100%;
            /*z-index: 9998;*/
            z-index: 100;
            top: 0;
            left: 0;
           
        }
         .chatterFeedPanel{
            height: 225px !important;
        }      
    </style>
    <script>
        /*window.onload = winLoad();
        
        var hidden1;
        var hidden2;
        function winLoad(){
           hidden1 = document.getElementById('page:frm:pageB:hdnblnShowCTPlanned');
           hidden2 = document.getElementById('page:frm:pageB:hdnblnShowTGF')
        }*/
        
        function DeleteService(DeleteIndex,DeleteSTIndex){
            
            if(confirm('Are you sure you want to delete?'))
            {
                callDeleteService(DeleteIndex,DeleteSTIndex);  
            }
            return false;
        }
        function DeleteResource(DeleteResourceIndex){
            if(confirm('Are you sure you want to delete?'))
            {
                callDeleteResource(DeleteResourceIndex);  
            }
            return false;
        }
        
        
        function EditResource(editid,EditIndex,EditSTIndex){
            var offsetTrail = editid;
            var offsetTop = 0;
            while (offsetTrail) {
                offsetTop += offsetTrail.offsetTop;
                offsetTrail = offsetTrail.offsetParent;
            }
            document.getElementById('page:frm:hdnintOffsetTop').value = offsetTop;
            document.getElementById('page:frm:hdnIndex').value = EditIndex;
            document.getElementById('page:frm:hdnIndexST').value = EditSTIndex;
            
            callEditService(EditIndex,EditSTIndex);
            
        }
        function EditResourceNewPopup(){
            //var Popup = document.getElementById('page:frm:tstpopup');
            //Popup.style.display = 'none';
            
            //var newPopup = document.getElementById('page:frm:tstpopupNew');
            //newPopup.style.display = '';
            
            actEditableResourcePopup();
            return false;
        }
        function FillContact(ResourceIndex){
            //alert(ResourceIndex);
            afFillContactsOnChangeRole(ResourceIndex);
        }
        function AddEditFillContact(ResourceIndex){
            //alert(ResourceIndex);
            AddEditFillContactsOnChangeRole(ResourceIndex);
        }
        
        function FillRateAddEdit(ResourceIndexForRate){
            
            afFillRateOnChangeContact(ResourceIndexForRate);
        }
        function FillRate(ResourceIndexForRate){
            
            actFillRateOnChangeContact(ResourceIndexForRate);
        }
        function calculateProposedCost(ORate,IRate,PropLOE,PropCost){
            Calculation();
        }
        /*function calculateProposedCost(ORate,IRate,PropLOE,PropCost){
            var OutputRate;
            var InputRate;
            var ProposedLOE;
            if(document.getElementById(ORate) != null){
                OutputRate = document.getElementById(ORate); 
            }
            if(document.getElementById(IRate) != null){
                InputRate = document.getElementById(IRate);
            }
            if(document.getElementById(PropLOE) != null){
                ProposedLOE = document.getElementById(PropLOE);
            }
            var ProposedCost = document.getElementById(PropCost);
            
            if((OutputRate.innerHTML != '' || InputRate.value != '') && ProposedLOE.value != ''){
                if(OutputRate.innerHTML != '') {
                    if(!isNaN(ProposedLOE.value)){
                        var indexRate = OutputRate.innerHTML.indexOf(" ");
                        var finalRate = OutputRate.innerHTML.substring(indexRate,OutputRate.innerHTML.length);
                        ProposedCost.innerHTML = Number(ProposedLOE.value * finalRate);
                    }else{
                        ProposedLOE.value = '';
                        ProposedCost.innerHTML = 0;
                    }
                }
                else if(InputRate.value != ''){
                    if(!isNaN(ProposedLOE.value) || !isNaN(InputRate.value)){
                        ProposedCost.innerHTML = Number(ProposedLOE.value * InputRate.value);
                    }else{
                        ProposedLOE.value = '';
                        ProposedCost.innerHTML = 0;
                    }
                }
            } 
        }*/
        function switchMenu(obj,obj1,obj2,hdn,val) 
        {   
            document.getElementById(hdn).value=val; 
            var el = document.getElementById(obj); 
                            
            if(el.style.display != 'none' ) {
                el.style.display = 'none';
            }
            else {
                el.style.display = '';
            }
            var e2 = document.getElementById(obj1);                                       
            if ( e2.style.display != 'none' ) {
                e2.style.display = 'none';
            }
            else {
                e2.style.display = '';
            }
            var e3 = document.getElementById(obj2);                                       
            if ( e2.style.display != 'none' ) {
                e3.style.display = 'none';
            }
            else {
                e3.style.display = '';
            }
        }
        function switchMenuResource(obj,HeaderId,obj1,obj2,hdn,val) 
        {   
            document.getElementById(hdn).value=val; 
            
            var el = document.getElementById(obj); 
            if(el.style.display != 'none' ) {
                var node = el.parentNode.childNodes;
                for (var i = 0; i < node.length;  i++){
                    if(node[i].id == el.id){
                        node[i].style.display = 'none';
                    }
                }
            }else{
                var node = el.parentNode.childNodes;
                for (var i = 0; i < node.length;  i++){
                    if(node[i].id == el.id){
                        node[i].style.display = '';
                    }
                }
            } 
            
            var header = document.getElementById(HeaderId); 
            if(header.style.display != 'none' ) {
                var node = header.parentNode.childNodes;
                for (var i = 0; i < node.length;  i++){
                    if(node[i].id == header.id){
                        node[i].style.display = 'none';
                    }
                }
            }else{
                var node = header.parentNode.childNodes;
                for (var i = 0; i < node.length;  i++){
                    if(node[i].id == header.id){
                        node[i].style.display = '';
                    }
                }
            } 
            
            var e2 = document.getElementById(obj1);                                       
            if ( e2.style.display != 'none' ) {
                e2.style.display = 'none';                
            }
            else {
                e2.style.display = '';
            }
            var e3 = document.getElementById(obj2);                                       
            if ( e2.style.display != 'none' ) {
                e3.style.display = 'none';
            }
            else {
                e3.style.display = '';
            }
            
        }
        function validate(SubTypeId,SaveServiceIndex,SaveServiceTypeIndex,editid,e){
            //alert(1);
            if(document.getElementById(SubTypeId).value == ''){
                alert('Service Type must not blank');
                return false;
            }else{
                /*var offsetTrail = editid;
                var offsetTop = 0;
                while (offsetTrail){
                    offsetTop += offsetTrail.offsetTop;
                    offsetTrail = offsetTrail.offsetParent;
                }*/
                //document.getElementById('page:frm:hdnsetTop').value = offsetTop;
                document.getElementById('page:frm:hdnsetTop').value = e.clientY + document.body.scrollTop + document.documentElement.scrollTop;
                //alert("SaveServiceIndex = "+SaveServiceIndex);
                //alert("SaveServiceTypeIndex = "+SaveServiceTypeIndex);
                actSaveServiceAndAddResources(SaveServiceIndex,SaveServiceTypeIndex);
                //alert(111);
                return false;
            }
        }
    
        function ColumnExpandCollepse(tdId,thId,Mainth,sideTh,hdn,Status){
            var AllTD = document.getElementsByTagName("td");
            var AllTH = document.getElementsByTagName("th");
            
            if(tdId == 'CTtd')
                document.getElementById('page:frm:hdnblnShowCTPlanned').value = Status;
            if(tdId == 'TGFtd')
                document.getElementById('page:frm:hdnblnShowTGF').value = Status;
            if(tdId == 'POtd')
                document.getElementById('page:frm:hdnblnShowPOTGF').value = Status;
             if(tdId == 'LFAtd')
                document.getElementById('page:frm:hdnblnShowLFAprop').value = Status;    
            for(var i=0;i<AllTD.length;i++){
                if(AllTD[i].id == tdId){
                    if(Status == 'false'){
                        AllTD[i].style.display = 'none';
                    }else{
                        AllTD[i].style.display = '';
                    }
                }
            }
            for(var i=0;i<AllTH.length;i++){
                if(AllTH[i].id == thId){
                    if(Status == 'false'){
                        AllTH[i].style.display = 'none';
                    }else{
                        AllTH[i].style.display = '';
                    }
                }
            }
            if(Status == 'false'){
                document.getElementById(Mainth).style.display = 'none';
                document.getElementById(sideTh).style.display = '';
            }else{
                document.getElementById(sideTh).style.display = 'none';
                document.getElementById(Mainth).style.display = '';
            }
        }
        function toggleDescService(PopUp){
            var el = document.getElementById(PopUp);                              
            if (el.style.display != 'none') {
                el.style.display = 'none';
            }
            else {
                el.style.display = '';
            }
        }
        //winLoad();
        function winLoad(){
            alert(document.getElementById('page:frm:pageB:ServiceType').childNodes[0].label);
            document.getElementById('page:frm:pageB:ServiceType').childNodes[0].label = 'All Service Types';
            alert(document.getElementById('page:frm:pageB:ServiceType').childNodes[0].label);
        }

    </script>
<script>
 //document.getElementById('page:frm:pageB:j_id19:SaveReturnId').focus();
    
</script>
   <style type="text/css">
        span.dateInput span.dateFormat{
            display:none;
        }
    </style>
    
</apex:page>